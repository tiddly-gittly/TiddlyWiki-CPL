{"title":"$:/plugins/oeyoews/markdown-it-mermaid","description":"markdown-it-mermaid","author":"oeyoews","version":"2.0.0","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"markdown-it-mermaid","meat#disabled":"yes","qrcode":"yes","created":"2024-01-28","updated":"2024-08-25","parent-plugin":"$:/plugins/oeyoews/markdown-extensions-startup","dependents":"$:/plugins/oeyoews/mermaid-lib","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/markdown-it-mermaid\":{\"title\":\"$:/plugins/oeyoews/markdown-it-mermaid\",\"text\":\"<!-- https://mermaid.js.org/config/usage.html -->\\n[[文档|https://neotw.vercel.app/docs/plugins/markdown-it-mermaid]]\\n\\n```mermaid\\ngraph TB;\\nb[mermaid-widget]\\nc[markdown-it-mermaid]\\na(Mermaid-lib)\\na--> b & c\\n```\"},\"$:/config/markdown-it-mermaid/rendertype\":{\"title\":\"$:/config/markdown-it-mermaid/rendertype\",\"text\":\"svg\"},\"$:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\":{\"title\":\"$:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\\ntype: application/javascript\\nmodule-type: markdownit\\n\\n@see-also https://talk.tiddlywiki.org/t/zoomin-info-messes-with-svg-rendering-somehow/4095/13\\n\\\\*/\\nError;const e={securityLevel:\\\"loose\\\",theme:\\\"default\\\",startOnLoad:!1,htmlLabels:!0},t=$tw.wiki.getTiddlerText(\\\"$:/config/markdown-it-mermaid/rendertype\\\");\\n//   $tw.modules.types.library.hasOwnProperty(vanilaMermaid);\\nlet r;try{r=require(\\\"mermaid.min.js\\\"),r.initialize(e),document.addEventListener(\\\"mermaidReady\\\",(({detail:e})=>async function(e){try{if(!await r.parse(e.text,{suppressErrors:!1}))return;const{svg:i}=await r.render(\\\"fake_\\\"+e.id,e.text);if(\\\"png\\\"===t){const t=document.createElement(\\\"img\\\");t.src=`data:image/svg+xml,${encodeURIComponent(i)}`,t.style.cssText=(n=i,(new DOMParser).parseFromString(n,\\\"image/svg+xml\\\").querySelector(\\\"svg\\\").style.cssText),t.className=\\\"spotlight\\\",document.getElementById(e.id).outerHTML=`<div style=\\\"text-align:center;\\\" id=\\\"${e.id}\\\"></div>`,document.getElementById(e.id).append(t)}else el.outerHTML=i}catch(t){const r=document.getElementById(e.id);if(r){const n=`<pre><code>${e.text}</code>\\\\n<code style=\\\"color:red\\\">${t.message}</code></pre>`;r.outerHTML=n}else console.warn(t)}var n}(e)))}catch(e){console.warn(e)}module.exports=e=>{const t=e.renderer.rules.fence;e.renderer.rules.fence=(e,n,i={},a,o)=>{const s=e[n],d=s.content.trim();let[m,c,...l]=s.info.split(\\\" \\\");const u=d.split(/\\\\n/)[0].trim();if((\\\"gantt\\\"===u||\\\"sequenceDiagram\\\"===u||u.match(/^graph(?: (TB|BT|RL|LR|TD))?(;)?$/))&&(m=\\\"mermaid\\\"),\\\"mermaid\\\"!==m.trim())return t(e,n,{},a,o);if(\\\"mermaid\\\"===m.trim()){const e=\\\"mermaid_99\\\"+Array.from({length:5},(()=>\\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\\\".charAt(Math.floor(62*Math.random())))).join(\\\"\\\");return r?(function(e,t){const r=new CustomEvent(\\\"mermaidReady\\\",{detail:{id:e,text:t}});document.dispatchEvent(r)}(e,d),`<pre style=\\\"opacity:0;\\\" id=\\\"${e}\\\">${d}</pre>`):`<pre style=\\\"color:red;\\\">${d}\\\\n Maybe you forget install a mermaid library plugin.</pre>`}}};\",\"type\":\"application/javascript\",\"module-type\":\"markdownit\"}}}"}