{"title":"$:/plugins/oeyoews/markdown-it-mermaid","description":"markdown-it-mermaid","author":"oeyoews","version":"2.0.0","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"markdown-it-mermaid","meat#disabled":"yes","qrcode":"yes","created":"2024-01-28","updated":"2024-08-25","parent-plugin":"$:/plugins/oeyoews/markdown-extensions-startup","dependents":"$:/plugins/oeyoews/mermaid-lib","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/markdown-it-mermaid\":{\"title\":\"$:/plugins/oeyoews/markdown-it-mermaid\",\"text\":\"<!-- https://mermaid.js.org/config/usage.html -->\\n[[文档|https://neotw.vercel.app/docs/plugins/markdown-it-mermaid]]\\n\\n```mermaid\\ngraph TB;\\nb[mermaid-widget]\\nc[markdown-it-mermaid]\\na(Mermaid-lib)\\na--> b & c\\n```\"},\"$:/config/markdown-it-mermaid/rendertype\":{\"title\":\"$:/config/markdown-it-mermaid/rendertype\",\"text\":\"svg\"},\"$:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\":{\"title\":\"$:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/markdown-it-mermaid/markdown-it-mermaid.js\\ntype: application/javascript\\nmodule-type: markdownit\\n\\n@see-also https://talk.tiddlywiki.org/t/zoomin-info-messes-with-svg-rendering-somehow/4095/13\\n\\\\*/\\nError;const e={securityLevel:\\\"loose\\\",startOnLoad:!1,htmlLabels:!0},t=$tw.wiki.getTiddlerText(\\\"$:/config/markdown-it-mermaid/rendertype\\\");\\n//   $tw.modules.types.library.hasOwnProperty(vanilaMermaid);\\nlet r;try{r=require(\\\"mermaid.min.js\\\"),document.addEventListener(\\\"mermaidReady\\\",(async({detail:e})=>{try{if(!await r.parse(e.text,{suppressErrors:!1}))return;const{svg:i}=await r.render(\\\"fake_\\\"+e.id,e.text);if(\\\"png\\\"===t){const t=document.createElement(\\\"img\\\");t.src=`data:image/svg+xml,${encodeURIComponent(i)}`,t.style.cssText=(n=i,(new DOMParser).parseFromString(n,\\\"image/svg+xml\\\").querySelector(\\\"svg\\\").style.cssText),t.className=\\\"spotlight\\\",document.getElementById(e.id).outerHTML=`<div style=\\\"text-align:center;\\\" id=\\\"${e.id}\\\"></div>`,document.getElementById(e.id).append(t)}else el.outerHTML=i}catch(t){const r=document.getElementById(e.id),n=`<pre><code>${e.text}</code>\\\\n<code style=\\\"color:red\\\">${t.message}</code></pre>`;r.outerHTML=n}var n}))}catch(e){console.warn(e)}module.exports=t=>{const n=t.renderer.rules.fence;t.renderer.rules.fence=(t,i,a={},d,o)=>{const s=t[i],m=s.content.trim();let[c,l,...u]=s.info.split(\\\" \\\");const g=m.split(/\\\\n/)[0].trim();if((\\\"gantt\\\"===g||\\\"sequenceDiagram\\\"===g||g.match(/^graph(?: (TB|BT|RL|LR|TD))?(;)?$/))&&(c=\\\"mermaid\\\"),\\\"mermaid\\\"!==c.trim())return n(t,i,{},d,o);if(\\\"mermaid\\\"===c.trim()){const t=\\\"mermaid_99\\\"+Array.from({length:5},(()=>\\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\\\".charAt(Math.floor(62*Math.random())))).join(\\\"\\\");if(!r)return`<pre style=\\\"color:red;\\\">${m}\\\\n Maybe you forget install a mermaid library plugin.</pre>`;r.initialize(e);const n=new CustomEvent(\\\"mermaidReady\\\",{detail:{id:t,text:m}});return document.dispatchEvent(n),`<pre id=\\\"${t}\\\">${m}</pre>`}}};\",\"type\":\"application/javascript\",\"module-type\":\"markdownit\"}}}"}