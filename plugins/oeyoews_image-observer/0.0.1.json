{"title":"$:/plugins/oeyoews/image-observer","description":"image-observer","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"image-observer","meat#disabled":"yes","qrcode":"yes","created":"2023-12-29","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/image-observer/readme\":{\"title\":\"$:/plugins/oeyoews/image-observer/readme\",\"text\":\"## Image Observer\\n\\n- 用于提供懒加载图片的 lib\\n\\n## Usage\\n\\n```js\\nconst { observer } = new $tw.ImageObserver();\\n```\\n\\n## Motivation\\n\",\"type\":\"text/markdown\",\"description\":\"image-observer\"},\"$:/plugins/oeyoews/image-observer/twimageobserver.js\":{\"title\":\"$:/plugins/oeyoews/image-observer/twimageobserver.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/image-observer/twimageobserver.js\\ntype: application/javascript\\nmodule-type: global\\n\\n\\\\*/\\n\\nclass LazyImageLoader {\\n  constructor() {\\n    this.dynamicClassed =\\n      'scale-105 blur-none md:blur-md bg-black/10 cursor-wait'; // 移动端上 blur 效果不能及时移除\\n    this.dataSrc = 'data-src';\\n\\n    this.imageCallback = this.imageCallback.bind(this);\\n    this.imageCallbackOptions = {\\n      root: null,\\n      rootMargin: '0px',\\n      threshold: 0.3\\n    };\\n\\n    this.observer = new IntersectionObserver(\\n      this.imageCallback,\\n      this.imageCallbackOptions\\n    );\\n  }\\n\\n  imageCallback(entries, observer) {\\n    entries.forEach((entry) => {\\n      const image = entry.target;\\n      const src = image.dataset.src;\\n      image.classList.add(...this.dynamicClassed.split(' '));\\n      image.src = 'data:image/png;base64,iVBORw0...';\\n\\n      if (entry.isIntersecting) {\\n        image.src = src;\\n        image.onload = () => {\\n          image.removeAttribute(this.dataSrc);\\n          image.classList.remove(...this.dynamicClassed.split(' '));\\n          image.classList.add('cursor-pointer');\\n        };\\n        observer.unobserve(image);\\n      }\\n    });\\n  }\\n}\\n\\nexports.ImageObserver = LazyImageLoader;\\n\",\"type\":\"application/javascript\",\"module-type\":\"global\"}}}"}