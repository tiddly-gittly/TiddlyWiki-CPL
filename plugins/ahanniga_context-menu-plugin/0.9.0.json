{"title":"$:/plugins/ahanniga/context-menu-plugin","description":"Configurable context menus for tiddlers","author":"A Hannigan","version":"0.9.0","core-version":">=5.0.0","source":"https://github.com/ahanniga/tiddlywiki-context-menu-plugin","plugin-type":"plugin","list":"README License","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"$:/config/tiddlercontextmenu/close-other-tiddlers\":{\"title\":\"$:/config/tiddlercontextmenu/close-other-tiddlers\",\"caption\":\"Close Others\",\"created\":\"20220729201154064\",\"icon\":\"$:/core/images/close-others-button\",\"modified\":\"20220730005202098\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-close-other-tiddlers\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/close-tiddler\":{\"title\":\"$:/config/tiddlercontextmenu/close-tiddler\",\"caption\":\"Close Tiddler\",\"created\":\"20220729205123079\",\"icon\":\"$:/core/images/close-button\",\"modified\":\"20220730005231520\",\"separate-after\":\"\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-close-tiddler\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/copy-to-clipboard\":{\"title\":\"$:/config/tiddlercontextmenu/copy-to-clipboard\",\"caption\":\"Copy to Clipboard\",\"created\":\"20220729212624469\",\"icon\":\"$:/core/images/copy-clipboard\",\"modified\":\"20220730005252978\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-copy-to-clipboard\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/delete-tiddler\":{\"title\":\"$:/config/tiddlercontextmenu/delete-tiddler\",\"caption\":\"Delete\",\"created\":\"20220729214620520\",\"icon\":\"$:/core/images/delete-button\",\"modified\":\"20220730005342967\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-delete-tiddler\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/edit-tiddler\":{\"title\":\"$:/config/tiddlercontextmenu/edit-tiddler\",\"caption\":\"Edit\",\"created\":\"20220729214907560\",\"icon\":\"$:/core/images/edit-button\",\"modified\":\"20220730005405279\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-edit-tiddler\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/fold-all-tiddlers\":{\"title\":\"$:/config/tiddlercontextmenu/fold-all-tiddlers\",\"caption\":\"Fold All\",\"created\":\"20220729215240119\",\"icon\":\"$:/core/images/fold-all-button\",\"modified\":\"20220730005430270\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-fold-all-tiddlers\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/fold-other-tiddlers\":{\"title\":\"$:/config/tiddlercontextmenu/fold-other-tiddlers\",\"caption\":\"Fold Others\",\"created\":\"20220729215431456\",\"icon\":\"$:/core/images/fold-others-button\",\"modified\":\"20220730100115989\",\"separate-after\":\"\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-fold-other-tiddlers\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/fold-tiddler\":{\"title\":\"$:/config/tiddlercontextmenu/fold-tiddler\",\"caption\":\"Toggle Fold\",\"created\":\"20220729215839423\",\"icon\":\"$:/core/images/fold-button\",\"modified\":\"20220730005515602\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-fold-tiddler\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/new-here\":{\"title\":\"$:/config/tiddlercontextmenu/new-here\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"caption\":\"New Here\",\"icon\":\"$:/core/images/new-here-button\",\"tm-message\":\"tm-new-here\",\"text\":\"show\"},\"$:/config/tiddlercontextmenu/print-river\":{\"title\":\"$:/config/tiddlercontextmenu/print-river\",\"caption\":\"Print River\",\"created\":\"20220731212634314\",\"icon\":\"$:/core/images/print-button\",\"modified\":\"20220731230735336\",\"separate-after\":\"\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"sp-print-river\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"hide\"},\"$:/config/tiddlercontextmenu/print\":{\"title\":\"$:/config/tiddlercontextmenu/print\",\"caption\":\"Print Open\",\"created\":\"20220729234344703\",\"icon\":\"$:/core/images/print-button\",\"modified\":\"20220730100015399\",\"separate-after\":\"\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-print\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"hide\"},\"$:/config/tiddlercontextmenu/unfold-all-tiddlers\":{\"title\":\"$:/config/tiddlercontextmenu/unfold-all-tiddlers\",\"caption\":\"Unfold All\",\"created\":\"20220729220222119\",\"icon\":\"$:/core/images/unfold-all-button\",\"modified\":\"20220730095906684\",\"tags\":\"$:/tags/tiddlercontextmenu\",\"tm-message\":\"tm-unfold-all-tiddlers\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"hide\"},\"$:/plugins/ahanniga/context-menu-plugin\":{\"text\":\"{\\\"tiddlers\\\":{\\\"$:/plugins/ahanniga/context-menu/view-template\\\":{\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu/view-template\\\",\\\"created\\\":\\\"20220724192929363\\\",\\\"modified\\\":\\\"20220724211425616\\\",\\\"tags\\\":\\\"$:/tags/ViewTemplate\\\",\\\"type\\\":\\\"text/vnd.tiddlywiki\\\",\\\"text\\\":\\\"<$contextMenu>\\\\n\\\"},\\\"$:/plugins/ahanniga/context-menu/ContextListener.js\\\":{\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu/ContextListener.js\\\",\\\"text\\\":\\\"/*\\\\\\\\\\\\ntitle: $:/plugins/ahanniga/context-menu/ContextListener.js\\\\ntype: application/javascript\\\\nmodule-type: widget\\\\n\\\\nThis widgets implements context menus to tiddlers\\\\n\\\\\\\\*/\\\\n\\\\n(function () {\\\\n\\\\n  var htmlToElement = function (html) {\\\\n    var template = document.createElement('template');\\\\n    html = html.trim();\\\\n    template.innerHTML = html;\\\\n    return template.content.firstChild;\\\\n  }\\\\n\\\\n  var Widget = require(\\\\\\\"$:/core/modules/widgets/widget.js\\\\\\\").widget;\\\\n  var template = `<div id=\\\\\\\"contextMenu\\\\\\\" class=\\\\\\\"context-menu\\\\\\\" style=\\\\\\\"display: none; z-order: 9999;\\\\\\\"></div>`;\\\\n\\\\n  var ContextListener = function (parseTreeNode, options) {\\\\n    this.initialise(parseTreeNode, options);\\\\n  };\\\\n\\\\n  ContextListener.prototype = new Widget();\\\\n\\\\n  ContextListener.prototype.render = function (parent, nextSibling) {\\\\n    this.parentDomNode = parent;\\\\n    this.execute();\\\\n    var self = this;\\\\n    parent.addEventListener(\\\\\\\"contextmenu\\\\\\\", function (event) { self.contextmenu.call(self, event) });\\\\n    document.onclick = this.hideMenu;\\\\n  };\\\\n\\\\n  ContextListener.prototype.contextmenu = function (event) {\\\\n    var self = this;\\\\n    event.preventDefault();\\\\n    var menu = document.getElementById(\\\\\\\"contextMenu\\\\\\\");\\\\n\\\\n    if (menu == null) {\\\\n      this.document.body.appendChild(htmlToElement(template));\\\\n      menu = document.getElementById(\\\\\\\"contextMenu\\\\\\\");\\\\n      menu.addEventListener(\\\\\\\"click\\\\\\\", function (event) { self.menuClicked.call(self, event) });\\\\n    }\\\\n    menu.innerHTML = \\\\\\\"\\\\\\\";\\\\n\\\\n    var contextMenuOptions = $tw.wiki.getTiddlerText(\\\\\\\"$:/plugins/ahanniga/context-menu/options\\\\\\\");\\\\n    var menuHtml = [\\\\\\\"<ul>\\\\\\\"];\\\\n    var options = JSON.parse(contextMenuOptions)[\\\\\\\"context-menu\\\\\\\"];\\\\n    for (var index = 0; index < options.length; index++) {\\\\n      var icon = $tw.wiki.getTiddlerText(options[index].icon);\\\\n      var tid = event.currentTarget.getAttribute(\\\\\\\"data-tiddler-title\\\\\\\");\\\\n      menuHtml.push(`<li><a action=\\\\\\\"${options[index].action}\\\\\\\" id=\\\\\\\"action-${index}\\\\\\\" tid=\\\\\\\"${tid}\\\\\\\" href=\\\\\\\"\\\\\\\">${icon} ${options[index].name}</a></li>`);\\\\n    }\\\\n    menuHtml.push(\\\\\\\"</ul>\\\\\\\");\\\\n    menu.append(htmlToElement(menuHtml.join(\\\\\\\"\\\\\\\")))\\\\n\\\\n    if (menu.style.display == \\\\\\\"block\\\\\\\") {\\\\n      this.hideMenu();\\\\n    } else {\\\\n      menu.style.display = 'block';\\\\n      menu.style.left = event.pageX + \\\\\\\"px\\\\\\\";\\\\n      menu.style.top = event.pageY + \\\\\\\"px\\\\\\\";\\\\n    }\\\\n\\\\n    return false;\\\\n  };\\\\n\\\\n  ContextListener.prototype.menuClicked = function (event) {\\\\n    var action = event.target.getAttribute(\\\\\\\"action\\\\\\\");\\\\n    var tid = event.target.getAttribute(\\\\\\\"tid\\\\\\\");\\\\n    var stid, state, text;\\\\n    event.preventDefault();\\\\n\\\\n    switch (action) {\\\\n      case \\\\\\\"tm-fold-tiddler\\\\\\\":\\\\n        stid = `$:/state/folded/${tid}`;\\\\n        state = $tw.wiki.getTiddlerText(stid, \\\\\\\"show\\\\\\\") === \\\\\\\"show\\\\\\\" ? \\\\\\\"hide\\\\\\\" : \\\\\\\"show\\\\\\\";\\\\n        $tw.wiki.setText(stid, \\\\\\\"text\\\\\\\", null, state);\\\\n        break;\\\\n      case \\\\\\\"tm-copy-to-clipboard\\\\\\\":\\\\n        text = $tw.wiki.getTiddlerText(tid);\\\\n        this.dispatchEvent({ type: action, param: text });\\\\n        break;\\\\n\\\\n      default:\\\\n        this.dispatchEvent({ type: action, param: tid });\\\\n    }\\\\n\\\\n    return false;\\\\n  };\\\\n\\\\n  ContextListener.prototype.execute = function () {\\\\n  };\\\\n\\\\n  ContextListener.prototype.refresh = function (changedTiddlers) {\\\\n    return false;\\\\n  };\\\\n\\\\n  ContextListener.prototype.hideMenu = function () {\\\\n    var menu = document.getElementById(\\\\\\\"contextMenu\\\\\\\");\\\\n    if (menu != null) {\\\\n      menu.style.display = \\\\\\\"none\\\\\\\";\\\\n    }\\\\n  };\\\\n\\\\n  exports.contextMenu = ContextListener;\\\\n\\\\n})();\\\\n\\\",\\\"type\\\":\\\"application/javascript\\\",\\\"module-type\\\":\\\"widget\\\",\\\"created\\\":\\\"20220724211224035\\\",\\\"modified\\\":\\\"20220726145239813\\\"},\\\"$:/plugins/ahanniga/context-menu/options\\\":{\\\"text\\\":\\\"{\\\\n\\\\t\\\\\\\"context-menu\\\\\\\": [ \\\\n\\\\t\\\\t  {\\\\n\\\\t\\\\t\\\\t  \\\\\\\"name\\\\\\\": \\\\\\\"Edit\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"icon\\\\\\\": \\\\\\\"$:/core/images/edit-button\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"action\\\\\\\": \\\\\\\"tm-edit-tiddler\\\\\\\"\\\\n\\\\t\\\\t  },\\\\n\\\\t\\\\t  {\\\\n\\\\t\\\\t\\\\t  \\\\\\\"name\\\\\\\": \\\\\\\"Toggle Fold\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"icon\\\\\\\": \\\\\\\"$:/core/images/fold-button\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"action\\\\\\\": \\\\\\\"tm-fold-tiddler\\\\\\\"\\\\n\\\\t\\\\t  },\\\\n\\\\t\\\\t  {\\\\n\\\\t\\\\t\\\\t  \\\\\\\"name\\\\\\\": \\\\\\\"Copy to Clipboard\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"icon\\\\\\\": \\\\\\\"$:/core/images/copy-clipboard\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"action\\\\\\\": \\\\\\\"tm-copy-to-clipboard\\\\\\\"\\\\n\\\\t\\\\t  },\\\\n\\\\t\\\\t{\\\\n\\\\t\\\\t\\\\t  \\\\\\\"name\\\\\\\": \\\\\\\"Close\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"icon\\\\\\\": \\\\\\\"$:/core/images/close-button\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"action\\\\\\\": \\\\\\\"tm-close-tiddler\\\\\\\"\\\\n\\\\t\\\\t  },\\\\n\\\\t\\\\t  {\\\\n\\\\t\\\\t\\\\t  \\\\\\\"name\\\\\\\": \\\\\\\"Delete\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"icon\\\\\\\": \\\\\\\"$:/core/images/delete-button\\\\\\\",\\\\n\\\\t\\\\t\\\\t  \\\\\\\"action\\\\\\\": \\\\\\\"tm-delete-tiddler\\\\\\\"\\\\n\\\\t\\\\t  }\\\\n\\\\t  ]\\\\n  }\\\",\\\"type\\\":\\\"application/json\\\",\\\"created\\\":\\\"20220725181550455\\\",\\\"modified\\\":\\\"20220726145135337\\\",\\\"tags\\\":\\\"\\\",\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu/options\\\"},\\\"$:/plugins/ahanniga/context-menu/styles.css\\\":{\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu/styles.css\\\",\\\"created\\\":\\\"20220725150446044\\\",\\\"modified\\\":\\\"20220726165539686\\\",\\\"tags\\\":\\\"$:/tags/Stylesheet\\\",\\\"type\\\":\\\"text/vnd.tiddlywiki\\\",\\\"text\\\":\\\"\\\\n\\\\n.context-menu {\\\\n    position: absolute;\\\\n\\\\t\\\\tmin-width: 180px;\\\\n    z-index: 99;\\\\n    display: flex;\\\\n    flex-direction: column;\\\\n    background-color: <<colour dropdown-background>>;\\\\n    border-radius: 6px;\\\\n    box-shadow: 0 10px 20px rgb(64 64 64 / 5%);\\\\n    padding: 0;\\\\n    border: 1px solid <<colour dropdown-border>>;\\\\n}\\\\n\\\\n.context-menu > ul {\\\\n    list-style: none;\\\\n    padding: 0;\\\\n    margin: 6px 0;\\\\n}\\\\n\\\\n.context-menu > ul > li > a {\\\\n  font: inherit;\\\\n  border: 0;\\\\n  padding: 4px 14px 4px 10px;\\\\n  width: 100%;\\\\n  display: flex;\\\\n  align-items: center;\\\\n  position: relative;\\\\n  text-decoration: unset;\\\\n  color: <<colour foreground>>;\\\\n  font-weight: 500;\\\\n}\\\\n\\\\n.context-menu > ul > li > a:hover {\\\\n    background: <<colour tiddler-link-foreground>>;\\\\n    color: <<colour tiddler-link-background>>; \\\\n    fill: <<colour tiddler-link-background>>; \\\\n}\\\\n\\\\n.context-menu > ul > li > a:hover > svg {\\\\n    color: <<colour tiddler-link-background>>; \\\\n    fill: <<colour tiddler-link-background>>; \\\\n}\\\\n\\\\n.context-menu > ul > li > a > i {\\\\n  padding-right: 10px;\\\\n}\\\\n\\\\n.context-menu > ul > li > a > svg {\\\\n    color: <<colour foreground>>;\\\\n    fill: <<colour foreground>>;\\\\n    width: 13px;\\\\n    margin-right: 9px;\\\\n    height: 13px;\\\\n}\\\\n\\\\n\\\"},\\\"$:/plugins/ahanniga/context-menu-plugin/License\\\":{\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu-plugin/License\\\",\\\"type\\\":\\\"text/plain\\\",\\\"text\\\":\\\"MIT License\\\\n\\\\nCopyright (c) 2022, A Hannigan\\\\n\\\\nPermission is hereby granted, free of charge, to any person obtaining a copy\\\\nof this software and associated documentation files (the \\\\\\\"Software\\\\\\\"), to deal\\\\nin the Software without restriction, including without limitation the rights\\\\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\\\\ncopies of the Software, and to permit persons to whom the Software is\\\\nfurnished to do so, subject to the following conditions:\\\\n\\\\nThe above copyright notice and this permission notice shall be included in all\\\\ncopies or substantial portions of the Software.\\\\n\\\\nTHE SOFTWARE IS PROVIDED \\\\\\\"AS IS\\\\\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\\\\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\\\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\\\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\\\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\\\\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\\\\nSOFTWARE.\\\"},\\\"$:/plugins/ahanniga/context-menu-plugin/README\\\":{\\\"title\\\":\\\"$:/plugins/ahanniga/context-menu-plugin/README\\\",\\\"text\\\":\\\"\\\\\\\\define plugin() $:/plugins/ahanniga/context-menu-plugin\\\\n\\\\\\\\define install()\\\\n<$list\\\\n  filter=\\\\\\\"[<transclusion>prefix[{$(plugin)$/README|$(plugin)$/README|||}]]\\\\\\\"\\\\n  emptyMessage=\\\\\\\"$(plugin)$\\\\\\\"\\\\n>\\\\n{{ $(plugin)$||$:/core/ui/Components/plugin-info }}\\\\n</$list>\\\\n\\\\\\\\end\\\\n\\\\nConfigurable context menus for tiddlers\\\\n\\\\n!! Install\\\\n\\\\n[[Manually install|https://tiddlywiki.com/#Manually%20installing%20a%20plugin]] the plugin by dragging this link to your ~TiddlyWiki:\\\\n\\\\n<<install>>\\\\n\\\\nThen save and refresh your ~TiddlyWiki.\\\\n\\\"}}}\",\"type\":\"application/json\",\"author\":\"A Hannigan\",\"core-version\":\">=5.0.0\",\"dependents\":\"\",\"description\":\"Configurable context menus for tiddlers\",\"list\":\"README License\",\"plugin-type\":\"plugin\",\"source\":\"https://github.com/ahanniga/tiddlywiki-context-menu-plugin\",\"title\":\"$:/plugins/ahanniga/context-menu-plugin\",\"version\":\"0.4.0\"},\"$:/plugins/ahanniga/context-menu/view-template\":{\"title\":\"$:/plugins/ahanniga/context-menu/view-template\",\"created\":\"20220724192929363\",\"modified\":\"20220724211425616\",\"tags\":\"$:/tags/ViewTemplate\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<$contextMenu>\\n\"},\"$:/plugins/ahanniga/context-menu/ContextListener.js\":{\"title\":\"$:/plugins/ahanniga/context-menu/ContextListener.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/ahanniga/context-menu/ContextListener.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nThis widgets implements context menus to tiddlers\\n\\\\*/\\n\\n(function () {\\n\\n    var sanitize = function (string) {\\n        const map = {\\n            '&': '&amp;',\\n            '<': '&lt;',\\n            '>': '&gt;',\\n            '\\\"': '&quot;',\\n            \\\"'\\\": '&#x27;',\\n            \\\"/\\\": '&#x2F;',\\n        };\\n        const reg = /[&<>\\\"'/]/ig;\\n        return string.replace(reg, (match) => (map[match]));\\n    };\\n\\n    var htmlToElement = function (html) {\\n        var template = document.createElement('template');\\n        template.innerHTML = html.trim();\\n        return template.content.firstChild;\\n    }\\n\\n    var parseParameters = function(src) {\\n        let paramMatcher = /\\\\\\\\parameters\\\\s*\\\\((.*?)\\\\)/;\\n        let paramMatch = src.match(paramMatcher);\\n        let parameters = {};\\n        if(paramMatch) {\\n            paramMatch[1].split(\\\",\\\").forEach(pair => {\\n                let [key, value] = pair.split(\\\":\\\");\\n                parameters[key.trim()] = value.replace(/[\\\"']/g, \\\"\\\").trim();\\n            });\\n\\n            // Remove the \\\\parameters block from the src\\n            src = src.replace(paramMatcher, '').trim();\\n        }\\n\\n        Object.keys(parameters).forEach(param => {\\n            let re = new RegExp(\\\"<<\\\"+param+\\\">>\\\", \\\"g\\\");\\n            src = src.replace(re, parameters[param]);\\n        });\\n\\n        return src;\\n    }\\n\\n    var Widget = require(\\\"$:/core/modules/widgets/widget.js\\\").widget;\\n    var template = `<div id=\\\"contextMenu\\\" class=\\\"context-menu\\\" style=\\\"display: none; z-order: 9999;\\\"></div>`;\\n\\n    var ContextListener = function (parseTreeNode, options) {\\n        this.initialise(parseTreeNode, options);\\n    };\\n\\n    ContextListener.prototype = new Widget();\\n\\n    ContextListener.prototype.render = function (parent, nextSibling) {\\n        this.parentDomNode = parent;\\n        var self = this;\\n        parent.addEventListener(\\\"contextmenu\\\", function (event) { self.contextmenu.call(self, event) });\\n        document.onclick = this.hideMenu;\\n    };\\n\\n    ContextListener.prototype.contextmenu = function (event) {\\n        var self = this;\\n        var menu = document.getElementById(\\\"contextMenu\\\");\\n\\n        if (getSelection().toString().trim().length > 0) {\\n            // User has selected text, so don't trigger this menu\\n            return true;\\n        }\\n\\n        if (menu == null) {\\n            this.document.body.appendChild(htmlToElement(template));\\n            menu = document.getElementById(\\\"contextMenu\\\");\\n            menu.addEventListener(\\\"click\\\", function (event) { self.menuClicked.call(self, event) });\\n        }\\n        menu.innerHTML = \\\"\\\";\\n\\n        var menuHtml = [\\\"<ul>\\\"];\\n        var titles = $tw.wiki.getTiddlersWithTag(\\\"$:/tags/tiddlercontextmenu\\\");\\n        var label, action, icon, tid, targ, text, separator;\\n\\n        for (var a = 0; a < titles.length; a++) {\\n            tid = $tw.wiki.getTiddler(titles[a]);\\n            text = sanitize(tid.getFieldString(\\\"text\\\", \\\"hide\\\"));\\n\\n            if (text !== \\\"show\\\") {\\n                continue;\\n            }\\n\\n            label = sanitize(tid.getFieldString(\\\"caption\\\", \\\"Unlabelled Option\\\"));\\n            action = sanitize(tid.getFieldString(\\\"tm-message\\\", \\\"tm-dummy\\\"));\\n            icon = $tw.wiki.getTiddlerText(tid.getFieldString(\\\"icon\\\", \\\"$:/core/images/blank\\\"));\\n            icon = parseParameters(icon);\\n            targ = event.currentTarget.getAttribute(\\\"data-tiddler-title\\\");\\n            separator = tid.fields[\\\"separate-after\\\"] === undefined ? \\\"\\\" : \\\"menu-separator\\\";\\n            menuHtml.push(`<li class=\\\"${separator}\\\"><a action=\\\"${action}\\\" targ=\\\"${targ}\\\" href=\\\"#!\\\">${icon} ${label}</a></li>`);\\n        }\\n\\n        menuHtml.push(\\\"</ul>\\\");\\n        menu.append(htmlToElement(menuHtml.join(\\\"\\\")))\\n\\n        if (menu.style.display == \\\"block\\\") {\\n            this.hideMenu();\\n        } else {\\n            menu.style.display = 'block';\\n            menu.style.left = event.pageX + \\\"px\\\";\\n            menu.style.top = event.pageY + \\\"px\\\";\\n        }\\n\\n        event.preventDefault();\\n        return false;\\n    };\\n\\n    ContextListener.prototype.menuClicked = function (event) {\\n        var action = event.target.getAttribute(\\\"action\\\");\\n        var targ = event.target.getAttribute(\\\"targ\\\");\\n        var tid, stid, state, text, ptid;\\n        this.hideMenu();\\n\\n        switch (action) {\\n            case \\\"tm-fold-tiddler\\\":\\n                stid = `$:/state/folded/${targ}`;\\n                state = $tw.wiki.getTiddlerText(stid, \\\"show\\\") === \\\"show\\\" ? \\\"hide\\\" : \\\"show\\\";\\n                $tw.wiki.setText(stid, \\\"text\\\", null, state);\\n                break;\\n            case \\\"tm-copy-to-clipboard\\\":\\n                text = $tw.wiki.getTiddlerText(targ);\\n                this.dispatchEvent({ type: action, param: text });\\n                break;\\n            case \\\"tm-print\\\":\\n                this.dispatchEvent({ type: action, event: event });\\n                break;\\n            case \\\"tm-unfold-all-tiddlers\\\":\\n                this.dispatchEvent({ type: action, param: targ, foldedStatePrefix: \\\"$:/state/folded/\\\" });\\n                break;\\n            case \\\"sp-print-river\\\":\\n                var curEntries = [];\\n                ptid = $tw.wiki.getTiddler(\\\"$:/PrintList\\\");\\n                if(ptid !== undefined) {\\n                    var list = ptid.getFieldList(\\\"list\\\");\\n                    if(Array.isArray(list) && list.indexOf(targ) < 0) {\\n                        for(a = 0; a < list.length; a++) {\\n                            curEntries.push(list[a]);\\n                        }\\n                    }\\n                }\\n                curEntries.push(targ);\\n                $tw.wiki.setText(\\\"$:/PrintList\\\", \\\"list\\\", 0, curEntries);\\n                $tw.rootWidget.dispatchEvent({ type: 'tm-open-window', param: '$:/plugins/BTC/PrintRiver/ui/Templates/PrintRiver' });\\n                break;\\n            case \\\"tm-new-here\\\":\\n                this.dispatchEvent({ type: \\\"tm-new-tiddler\\\", paramObject: {tags: targ}});\\n                break;\\n            default:\\n                this.dispatchEvent({ type: action, param: targ });\\n        }\\n\\n        event.preventDefault();\\n        return false;\\n    };\\n\\n    ContextListener.prototype.refresh = function (changedTiddlers) {\\n        return false;\\n    };\\n\\n    ContextListener.prototype.hideMenu = function () {\\n        var menu = document.getElementById(\\\"contextMenu\\\");\\n        if (menu != null) {\\n            menu.style.display = \\\"none\\\";\\n        }\\n    };\\n\\n    exports.contextMenu = ContextListener;\\n\\n})();\\n\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\",\"created\":\"20220724211224035\",\"modified\":\"20220729234907214\"},\"$:/plugins/ahanniga/context-menu/styles.css\":{\"title\":\"$:/plugins/ahanniga/context-menu/styles.css\",\"created\":\"20220725150446044\",\"modified\":\"20220729210033454\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\n.context-menu {\\n    position: absolute;\\n\\t\\tmin-width: 180px;\\n    z-index: 1000;\\n    display: flex;\\n    flex-direction: column;\\n    background-color: <<colour dropdown-background>>;\\n    border-radius: 6px;\\n    box-shadow: 0 10px 20px rgb(64 64 64 / 5%);\\n    padding: 0;\\n    border: 1px solid <<colour dropdown-border>>;\\n}\\n\\n.context-menu > ul {\\n    list-style: none;\\n    padding: 0;\\n    margin: 6px 0;\\n}\\n\\n.context-menu > ul > li > a {\\n  font: inherit;\\n  border: 0;\\n  padding: 2px 12px 2px 8px;\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  position: relative;\\n  text-decoration: unset;\\n  color: <<colour foreground>>;\\n  font-weight: 500;\\n  transition: 0.3s linear;\\n  -webkit-transition: 0.3s linear;\\n  -moz-transition: 0.3s linear;\\n  -ms-transition: 0.3s linear;\\n  -o-transition: 0.3s linear;\\n}\\n\\n.context-menu > ul > li > a:hover {\\n    background: <<colour tiddler-link-foreground>>;\\n    color: <<colour tiddler-link-background>>; \\n    fill: <<colour tiddler-link-background>>; \\n}\\n\\n.context-menu > ul > li > a:hover > svg {\\n    color: <<colour tiddler-link-background>>; \\n    fill: <<colour tiddler-link-background>>; \\n}\\n\\n.context-menu > ul > li > a > i {\\n  padding-right: 10px;\\n}\\n\\n.context-menu > ul > li > a > svg {\\n    color: <<colour foreground>>;\\n    fill: <<colour foreground>>;\\n    width: 13px;\\n    margin-right: 9px;\\n    height: 13px;\\n}\\n\\nul .menu-separator {\\n    border-bottom: 1px solid <<colour dropdown-border>>;\\n    margin-bottom: 5px;\\n    padding-bottom: 5px;\\n}\\n\\n\"},\"$:/tags/tiddlercontextmenu\":{\"title\":\"$:/tags/tiddlercontextmenu\",\"created\":\"20220729212214576\",\"list\":\"$:/config/tiddlercontextmenu/new-here $:/config/tiddlercontextmenu/edit-tiddler $:/config/tiddlercontextmenu/close-tiddler $:/config/tiddlercontextmenu/close-other-tiddlers $:/config/tiddlercontextmenu/copy-to-clipboard $:/config/tiddlercontextmenu/fold-tiddler $:/config/tiddlercontextmenu/fold-all-tiddlers $:/config/tiddlercontextmenu/fold-other-tiddlers $:/config/tiddlercontextmenu/unfold-all-tiddlers $:/config/tiddlercontextmenu/print $:/config/tiddlercontextmenu/delete-tiddler $:/config/tiddlercontextmenu/print-river\",\"modified\":\"20220729235711483\",\"type\":\"text/vnd.tiddlywiki\"},\"$:/plugins/ahanniga/context-menu-plugin/License\":{\"title\":\"$:/plugins/ahanniga/context-menu-plugin/License\",\"type\":\"text/plain\",\"text\":\"MIT License\\n\\nCopyright (c) 2022, A Hannigan\\n\\nPermission is hereby granted, free of charge, to any person obtaining a copy\\nof this software and associated documentation files (the \\\"Software\\\"), to deal\\nin the Software without restriction, including without limitation the rights\\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\\ncopies of the Software, and to permit persons to whom the Software is\\nfurnished to do so, subject to the following conditions:\\n\\nThe above copyright notice and this permission notice shall be included in all\\ncopies or substantial portions of the Software.\\n\\nTHE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\\nSOFTWARE.\"},\"$:/plugins/ahanniga/context-menu-plugin/README\":{\"title\":\"$:/plugins/ahanniga/context-menu-plugin/README\",\"text\":\"\\\\define plugin() $:/plugins/ahanniga/context-menu-plugin\\n\\\\define install()\\n<$list\\n  filter=\\\"[<transclusion>prefix[{$(plugin)$/README|$(plugin)$/README|||}]]\\\"\\n  emptyMessage=\\\"$(plugin)$\\\"\\n>\\n{{ $(plugin)$||$:/core/ui/Components/plugin-info }}\\n</$list>\\n\\\\end\\n\\n!! Context menus for tiddlers\\n\\nRight-click (or long-press on phone/tablet) to display a menu\\n\\n!!! Configuration\\n\\nUse this tag selector to show or reorder menu options: {{$:/tags/tiddlercontextmenu||$:/core/ui/TagTemplate}}\\n\\n* If the `separate-after` field exists, the option be followed by a menu separator\\n* Visibility of the option is determined by the text of the tiddler: \\\"show\\\" | \\\"hide\\\"\\n\\nCustom handling can be done by overriding the $:/plugins/ahanniga/context-menu/ContextListener.js tiddler.\\n\\nCustom styling can be  it by overriding the $:/plugins/ahanniga/context-menu/styles.css tiddler.\\n\\n!!! Installation\\n\\n[[Manually install|https://tiddlywiki.com/#Manually%20installing%20a%20plugin]] the plugin by dragging this link to your ~TiddlyWiki:\\n\\n<<install>>\\n\\nThen save and refresh your ~TiddlyWiki.\\n\"}}}","name":"context-menu-plugin"}