{"title":"$:/plugins/tiddlywiki/googleanalytics","name":"Google Analytics","description":"Website visitor statistics from Google","contributor":"Sylvain Comte","list":"readme settings usage","stability":"STABILITY_2_STABLE","version":"5.3.5","plugin-type":"plugin","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/tiddlywiki/googleanalytics/googleanalytics.js\":{\"title\":\"$:/plugins/tiddlywiki/googleanalytics/googleanalytics.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/tiddlywiki/googleanalytics/googleanalytics.js\\ntype: application/javascript\\nmodule-type: startup\\n\\nRuns Google Analytics with the measurement ID in the tiddler `$:/GoogleAnalyticsMeasurementID`\\n\\n\\\\*/\\n(function(){\\n\\n/*jslint node: true, browser: true */\\n/*global $tw: false */\\n\\\"use strict\\\";\\n\\n// Export name and synchronous status\\nexports.name = \\\"google-analytics\\\";\\nexports.platforms = [\\\"browser\\\"];\\nexports.synchronous = true;\\n\\nvar CONFIG_CONSENT_REQUIRED_TITLE = \\\"$:/config/cookie-consent-required\\\", // \\\"yes\\\" or \\\"no\\\" (the default)\\n\\tCONSENT_TITLE = \\\"$:/state/consent-banner/accepted\\\"; // \\\"\\\": undeclared, \\\"yes\\\": accepted, \\\"no\\\": declined\\n\\nexports.startup = function() {\\n\\tvar hasInitialised = false,\\n\\t\\tinitialiseGoogleAnalytics = function() {\\n\\t\\t\\tconsole.log(\\\"Initialising Google Analytics\\\");\\n\\t\\t\\thasInitialised = true;\\n\\t\\t\\tvar gaMeasurementID = $tw.wiki.getTiddlerText(\\\"$:/GoogleAnalyticsMeasurementID\\\",\\\"\\\").replace(/\\\\n/g,\\\"\\\");\\n\\t\\t\\tvar url =\\\"https://www.googletagmanager.com/gtag/js?id=\\\" + gaMeasurementID;\\n\\t\\t\\twindow.dataLayer = window.dataLayer || [];\\n\\t\\t\\twindow.gtag = function() { window.dataLayer?.push(arguments); };\\n\\t\\t\\twindow.gtag(\\\"js\\\",new Date());\\n\\t\\t\\twindow.gtag(\\\"config\\\",gaMeasurementID);\\n\\t\\t\\tconst scriptElement = window.document.createElement(\\\"script\\\");\\n\\t\\t\\tscriptElement.async = true;\\n\\t\\t\\tscriptElement.src = url;\\n\\t\\t\\twindow.document.head.appendChild(scriptElement);\\n\\t\\t};\\n\\t// Initialise now if consent isn't required\\n\\tif($tw.wiki.getTiddlerText(CONFIG_CONSENT_REQUIRED_TITLE) !== \\\"yes\\\") {\\n\\t\\tinitialiseGoogleAnalytics();\\n\\t} else {\\n\\t\\t// Or has been granted already\\n\\t\\tif($tw.wiki.getTiddlerText(CONSENT_TITLE) === \\\"yes\\\") {\\n\\t\\t\\tinitialiseGoogleAnalytics();\\n\\t\\t} else {\\n\\t\\t\\t// Or when our config tiddler changes\\n\\t\\t\\t$tw.wiki.addEventListener(\\\"change\\\",function(changes) {\\n\\t\\t\\t\\tif(changes[CONSENT_TITLE]) {\\n\\t\\t\\t\\t\\tif(!hasInitialised && $tw.wiki.getTiddlerText(CONSENT_TITLE) === \\\"yes\\\") {\\n\\t\\t\\t\\t\\t\\tinitialiseGoogleAnalytics();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\t}\\n};\\n\\n\\n\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/tiddlywiki/googleanalytics/readme\":{\"title\":\"$:/plugins/tiddlywiki/googleanalytics/readme\",\"text\":\"This plugin enables you to use Google Analytics to track access to your online TiddlyWiki document.\\n\\nBy default, the user is not asked for permission before initialising Google Analytics. This plugin also optionally integrates with the \\\"Consent Banner\\\" plugin (also found in the official plugin library) so that Google Analytics is not initialised until the user grants explicit permission.\\n\\n[[Source code|https://github.com/Jermolene/TiddlyWiki5/blob/master/plugins/tiddlywiki/googleanalytics]]\\n\"},\"$:/plugins/tiddlywiki/googleanalytics/settings\":{\"title\":\"$:/plugins/tiddlywiki/googleanalytics/settings\",\"text\":\"''[[Google Analytics Measurement ID|$:/GoogleAnalyticsMeasurementID]]'': (mandatory) a code of the form `G-XXXXXXXXXX` where X are digits or uppercase letters<br/><$edit-text tiddler=\\\"$:/GoogleAnalyticsMeasurementID\\\" default=\\\"\\\" tag=\\\"input\\\"/>\\n\\n\"},\"$:/plugins/tiddlywiki/googleanalytics/usage\":{\"title\":\"$:/plugins/tiddlywiki/googleanalytics/usage\",\"text\":\"!! Create a Google Analytics account\\n\\nIf you don't already have an account:\\n\\n# Go to the Google Analytics website: http://www.google.com/analytics/\\n# Click the ''Access Google Analytics'' button and follow instructions to set up your account\\n# Enter the URL where the wiki is hosted\\n# Note the Tracking ID for this domain of the form `G-XXXXXXXXXX`\\n\\n!! Install the plugin on your local copy of the TiddlyWiki\\n\\n# ''Backup your TiddlyWiki''. Just in case\\n# Install the plugin via the plugin manager in control panel\\n# Save the TiddlyWiki andrefresh the page to load the plugin\\n# Go to [[$:/ControlPanel]] > Plugins tab and unfold the Google Analytics Plugin\\n# Go to the //settings// tab and edit the parameters\\n# Save the TiddlyWiki\\n\\n!! Upload the new version of your TiddlyWiki\\n\\n# Upload the saved TiddlyWiki to Tiddlyhost, GitHub, GitLab or other web host\\n# Return to your Google Analytics page to check that your site is being tracked\\n\"}}}","author":"tiddlywiki"}