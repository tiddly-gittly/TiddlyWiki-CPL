{"title":"$:/plugins/oeyoews/neotw-copy-code2","description":"neotw-copy-code2","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"neotw-copy-code2","meat#disabled":"yes","qrcode":"yes","created":"2024-03-06","dependents":"","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-copy-code2/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code2/readme\",\"text\":\"<!-- plugin template readme -->\\n\\n## Motivation\\n\\nhttps://talk.tiddlywiki.org/t/introducing-a-copy-code-button-plugin-for-tiddlywiki-enhancing-code-sharing-and-efficiency/7224/18?u=oeyoews\\n\\n<!-- your plugin motivation, or why you write this plugin -->\\n\",\"type\":\"text/markdown\",\"description\":\"neotw-copy-code2\"},\"$:/plugins/oeyoews/neotw-copy-code2/copy-code-global\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code2/copy-code-global\",\"tags\":\"$:/tags/Global\",\"text\":\"\\\\widget $codeblock(code, language)\\n\\n<%if [<code>!match[]] %>\\n<div class=\\\"group relative\\\">\\n<!-- scale-0 group-hover:scale-100 -->\\n<$button class=\\\"neotw-copy-code z-[1] absolute right-0 m-1 p-0 transition-all delay-200 size-8 print:hidden\\\" message=\\\"tm-copy-to-clipboard\\\" param=<<code>> tooltip=\\\"copy code\\\">\\n{{$:/core/images/copy-clipboard}}\\n</$button>\\n<$genesis $type=\\\"$codeblock\\\" $remappable=\\\"no\\\" code=<<code>> language=<<language>> />\\n\\n</div>\\n<%endif%>\\n\\n\\\\end\"},\"$:/plugins/oeyoews/neotw-copy-code2/style.css\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code2/style.css\",\"tags\":\"$:/tags/Stylesheet\",\"text\":\".code-collapsed {\\n\\t\\tmax-height: 200px;\\n\\t\\toverflow: hidden;\\n\\t\\tposition: relative;\\n}\\n\\n<!--\\n.code-collapsed::after {\\n\\t\\tcontent: \\\"\\\";\\n\\t\\tposition: absolute;\\n\\t\\tbottom: 0;\\n\\t\\tleft: 0;\\n\\t\\twidth: 100%;\\n\\t\\theight: 60px;\\n\\t\\tpointer-events: none;\\n\\t\\tbackground: linear-gradient(transparent, rgba(248, 249, 250, 0.9));\\n}\\n-->\\n\\n<!--\\n.code-collapsed:hover::after {\\n\\t\\tbackground: transparent;\\n}\\n-->\\n\\n<$let darkmode={{{ [[$:/palette]get[text]get[color-scheme]] }}} >\\n<% if [<darkmode>match[dark]] %>\\n\\t.code-collapsed::after {\\n\\t\\tbackground: transparent;\\n\\t\\t<!-- background: linear-gradient(transparent, rgba(45, 45, 45, 0.9)); -->\\n  }\\n<% endif %>\\n</$let>\\n\\n.expand-button {\\n\\t\\tposition: absolute;\\n\\t\\tbottom: 4px;\\n\\t\\tleft: 50%;\\n\\t\\ttransform: translateX(-50%);\\n\\t\\tbackground-color: #4a6ee0;\\n\\t\\tcolor: white;\\n\\t\\tborder: none;\\n\\t\\tborder-radius: 4px;\\n\\t\\tpadding: 4px 8px;\\n\\t\\tfont-size: 14px;\\n\\t\\tcursor: pointer;\\n\\t\\ttransition: background-color 0.2s;\\n}\\n\\n.expand-button:hover {\\n\\t\\tbackground-color: #3a5bbf;\\n}\"},\"$:/plugins/oeyoews/neotw-copy-code2/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code2/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-copy-code2/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-copy-code2 widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass neotwCopyCode2 extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n    const title = this.getVariable('currentTiddler'); // 获取当前条目名称;\\n    const selector = `[data-tiddler-title=\\\"${title}\\\"]`;\\n    const tiddlerNode = document.querySelector(selector);\\n    // 找到同级的pre>code标签,\\n    const preEl = tiddlerNode.querySelectorAll('pre');\\n    if (preEl.length === 0 || !preEl) return;\\n    const codeEl = tiddlerNode.querySelectorAll('pre > code');\\n    preEl.forEach((pre) => {\\n      if (pre.clientHeight < 400) return;\\n      pre.classList.add('code-collapsed');\\n      const expandButton = document.createElement('button');\\n      expandButton.className =\\n        'expand-button absolute bottom-2 left-1/2 transform -translate-x-1/2';\\n      expandButton.textContent = '显示全部';\\n      // pre.before(expandButton);\\n      pre.appendChild(expandButton);\\n\\n      // 添加展开/折叠功能\\n      expandButton.addEventListener('click', function () {\\n        if (pre.classList.contains('code-collapsed')) {\\n          // 展开代码\\n          expandButton.textContent = '收起代码';\\n        } else {\\n          // 折叠代码\\n          expandButton.textContent = '显示全部';\\n        }\\n        pre.classList.toggle('code-collapsed');\\n      });\\n    });\\n\\n    return;\\n    if (!preEl) return;\\n    // js hljs language-javascript\\n    const lang = preEl.getAttribute('class').split(' ').pop();\\n  }\\n}\\n\\n/** @description {{ pluginname }} widget */\\nexports['neotwCopyCode2'] = neotwCopyCode2;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-copy-code2/viewTemplate\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code2/viewTemplate\",\"text\":\"<!-- tags: $:/tags/ViewTemplate -->\\n<!-- 会造成保存样式异常， 性能下降 -->\\n\\n<$list filter=\\\"[all[current]!is[missing]!is[binary]]\\\">\\n<$neotwCopyCode2 />\\n</$list>\"}}}"}