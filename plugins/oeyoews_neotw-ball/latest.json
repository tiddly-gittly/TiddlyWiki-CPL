{"title":"$:/plugins/oeyoews/neotw-ball","description":"neotw-ball","author":"oeyoews","version":"0.0.1","core-version":">=5.3.4","type":"application/json","plugin-type":"plugin","name":"neotw-ball","meat#disabled":"yes","qrcode":"yes","created":"2025/02/02","dependents":"","stability":"STABILITY_2_STABLE","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-ball/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-ball/readme\",\"description\":\"neotw-ball\",\"text\":\"[[在线文档|https://neotw.vercel.app/docs/plugins/neotw-ball]]\"},\"$:/plugins/oeyoews/neotw-ball/addEvent.js\":{\"title\":\"$:/plugins/oeyoews/neotw-ball/addEvent.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-ball/addEvent.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports = function (ball) {\\n  let startX,\\n    startY,\\n    startLeft,\\n    startTop,\\n    isDragging = false,\\n    startTime,\\n    moveX,\\n    moveY;\\n\\n  // **PC 端事件**\\n  ball.addEventListener('mousedown', (e) => startDrag(e.clientX, e.clientY));\\n  document.addEventListener(\\n    'mousemove',\\n    (e) => isDragging && moveDrag(e.clientX, e.clientY),\\n  );\\n  document.addEventListener('mouseup', endDrag);\\n\\n  // **移动端事件（防止滚动）**\\n  ball.addEventListener(\\n    'touchstart',\\n    (e) => {\\n      e.preventDefault(); // 禁止滚动\\n      startDrag(e.touches[0].clientX, e.touches[0].clientY);\\n    },\\n    { passive: false },\\n  );\\n\\n  document.addEventListener(\\n    'touchmove',\\n    (e) => {\\n      if (isDragging) {\\n        e.preventDefault(); // 禁止页面滚动\\n        moveDrag(e.touches[0].clientX, e.touches[0].clientY);\\n      }\\n    },\\n    { passive: false },\\n  );\\n\\n  document.addEventListener('touchend', endDrag);\\n\\n  function startDrag(clientX, clientY) {\\n    startTime = Date.now();\\n    isDragging = true;\\n    startX = clientX;\\n    startY = clientY;\\n    startLeft = ball.offsetLeft;\\n    startTop = ball.offsetTop;\\n  }\\n\\n  function moveDrag(clientX, clientY) {\\n    if (!isDragging) return;\\n\\n    let newLeft = startLeft + (clientX - startX);\\n    let newTop = startTop + (clientY - startY);\\n\\n    // **边界限制**\\n    newLeft = Math.max(\\n      0,\\n      Math.min(newLeft, window.innerWidth - ball.clientWidth),\\n    );\\n    newTop = Math.max(\\n      0,\\n      Math.min(newTop, window.innerHeight - ball.clientHeight),\\n    );\\n\\n    ball.style.left = newLeft + 'px';\\n    ball.style.top = newTop + 'px';\\n\\n    moveX = Math.abs(newLeft - startLeft);\\n    moveY = Math.abs(newTop - startTop);\\n  }\\n\\n  function endDrag() {\\n    if (!isDragging) return;\\n    isDragging = false;\\n\\n    // **短时间 & 小范围内移动 → 视为点击**\\n    if (Date.now() - startTime < 300 && moveX < 5 && moveY < 5) {\\n      alert('点击了悬浮球！');\\n      return;\\n    }\\n\\n    // **自动吸附到左/右边缘**\\n    const ballCenterX = ball.offsetLeft + ball.clientWidth / 2;\\n    if (ballCenterX > window.innerWidth / 2) {\\n      ball.style.left = window.innerWidth - ball.clientWidth + 'px';\\n    } else {\\n      ball.style.left = '0px';\\n    }\\n  }\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-ball/style.css\":{\"title\":\"$:/plugins/oeyoews/neotw-ball/style.css\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\",\"text\":\".drag-ball {\\n\\t--bg: rgba(0, 0, 0, 0.05);\\n\\tposition: fixed;\\n\\tz-index: 10003;\\n\\tright: 0;\\n\\ttop: 70%;\\n\\twidth: 50px;\\n\\theight: 50px;\\n\\t/* background: deepskyblue; */\\n\\t/* background-color: transparent; */\\n\\tborder-radius: 50%;\\n\\tbox-shadow: 0px 0px 5px 1px var(--bg) * 1.5;\\n\\tbackground-color: var(--bg);\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tcolor: #fff;\\n\\tfont-size: 14px;\\n\\tletter-spacing: 2px;\\n\\tuser-select: none;\\n\\tcursor: grab;\\n}\"},\"$:/plugins/oeyoews/neotw-ball/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-ball/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-ball/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-ball widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass BallWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const createElement = $tw.utils.domMaker;\\n    const addEvent = require('./addEvent');\\n\\n    const domNode = createElement('div', {\\n      class: 'drag-ball',\\n    });\\n    domNode.innerHTML = $tw.wiki.renderTiddler('text/html', '$:/core/icon', {\\n      parseAsInline: true,\\n    });\\n\\n    addEvent(domNode);\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n}\\n\\n/** @description neotw-ball widget */\\nexports['ball'] = BallWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}