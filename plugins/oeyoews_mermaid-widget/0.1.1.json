{"title":"$:/plugins/oeyoews/mermaid-widget","description":"mermaid-widget","author":"oeyoews","version":"0.1.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"mermaid-widget","meat#disabled":"yes","qrcode":"yes","created":"2024-01-11","dependents":"$:/plugins/oeyoews/mermaid-lib","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/mermaid-widget/readme\":{\"title\":\"$:/plugins/oeyoews/mermaid-widget/readme\",\"text\":\"## Mermaid widget\\n\\n<$mermaid2 rendertype=\\\"png\\\" theme=\\\"forest\\\">\\ninfo\\n</$mermaid2>\\n\\n```html\\n<$mermaid2 rendertype=\\\"png\\\" theme=\\\"forest\\\">\\ngraph LR;\\na[Another mermaid widget] -.-> b[[mermaid-widget]]\\n</$mermaid2>\\n```\\n\\n<$mermaid2 rendertype=\\\"png\\\" theme=\\\"forest\\\">\\ngraph LR;\\na[Another mermaid widget] -.-> b[[mermaid-widget]]\\n</$mermaid2>\\n\",\"type\":\"text/markdown\",\"description\":\"mermaid-widget\"},\"$:/plugins/oeyoews/mermaid-widget/widget.js\":{\"title\":\"$:/plugins/oeyoews/mermaid-widget/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/mermaid-widget/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nmermaid widget\\n\\\\*/\\nconst{widget:e}=require(\\\"$:/core/modules/widgets/widget.js\\\");class t extends e{constructor(e,t){super(e,t),this.mermaid,this.theme=\\\"default\\\",this.rendertype=\\\"svg\\\"}async render(e,t){this.computeAttributes(),this.execute();const r=this.document.createElement(\\\"div\\\");if(r.isTiddlyWikiFakeDom)return void console.warn(\\\"SSR not support export mermaid chart\\\");this.getmermaid();const{theme:i,rendertype:s}=this.attributes;i&&(this.theme=i),s&&(this.rendertype=s),e.insertBefore(r,t),this.renderChildren(r,null),this.domNodes.push(r),r.outerHTML=await this.renderMermaid(this.removeEmptyLines(r.textContent))}removeEmptyLines(e){return e.trim().replace(/^\\\\s*[\\\\r\\\\n]/gm,\\\"\\\")}getconfig(e){return{securityLevel:\\\"loose\\\",theme:e,startOnLoad:!1,htmlLabels:!0}}getmermaid(){if(window.mermaid)this.mermaid=window.mermaid;else{const e=\\\"mermaid.min.js\\\";\\n//   $tw.modules.types.library.hasOwnProperty(vanilaMermaid);\\ntry{this.mermaid=require(e),window.mermaid=this.mermaid}catch(e){console.warn(e)}}}async renderMermaid(e){const t=\\\"mermaid_\\\"+this.generateRandomString(5);let r,i=\\\"\\\";try{if(this.mermaid.initialize(this.getconfig(this.theme)),!await mermaid.parse(e,{suppressErrors:!1}))return`<pre>${e}</pre>`;const{svg:s}=await this.mermaid.render(\\\"fake_\\\"+t,e);if(i=s,!i)return`<pre style=\\\"color:#ff1919;\\\">${e}</pre>`;switch(this.rendertype){case\\\"svg\\\":default:r=this.centerStyle(i);break;case\\\"png\\\":const e=this.getStyle(i);r=this.centerStyle(`<img src=\\\"data:image/svg+xml,${encodeURIComponent(i)}\\\" style=\\\"${e}\\\" class=\\\"spotlight\\\"/>`)}return r}catch(t){return`<pre><code>${e}</code>\\\\n<code  style=\\\"color:#ff1919;\\\">${t.toString().split(\\\"\\\\n\\\").slice(1).join(\\\"\\\\n\\\").message||t.message}</code></pre>`}}generateRandomString(e){return Array.from({length:e},(()=>\\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\\\".charAt(Math.floor(62*Math.random())))).join(\\\"\\\")}getStyle(e){return(new DOMParser).parseFromString(e,\\\"image/svg+xml\\\").querySelector(\\\"svg\\\").style.cssText}refresh(){return!1}centerStyle(e){return`<div style=\\\"text-align:center;\\\">${e}</div>`}}exports.mermaid=t,exports.mermaid2=t;\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}