{"title":"$:/plugins/oeyoews/neotw-tiddlers-view","description":"neotw-tiddlers-view","author":"oeyoews","version":"0.0.1","core-version":">=5.3.4","type":"application/json","plugin-type":"plugin","name":"neotw-tiddlers-view","meat#disabled":"yes","qrcode":"yes","created":"20250226","dependents":"$:/plugins/oeyoews/neotw-vue3 $:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","stability":"STABILITY_2_STABLE","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-tiddlers-view/templates/app.vue\":{\"text\":\"<template>\\n  <div class=\\\"scroll-container\\\">\\n    <transition name=\\\"scroll\\\" mode=\\\"out-in\\\">\\n      <div v-if=\\\"currentTitle\\\" :key=\\\"currentTitle\\\"\\n        class=\\\"title-item bg-gray-200/70 backdrop-blur-md dark:bg-dimmed-800 px-2 py-1 rounded-sm text-black dark:text-white flex items-center gap-3\\\"\\n        @click=\\\"goToTiddler(currentTitle)\\\">\\n        <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"1em\\\" height=\\\"1em\\\" viewBox=\\\"0 0 24 24\\\" class=\\\"right-1\\\">\\n          <path fill=\\\"currentColor\\\"\\n            d=\\\"m12 0l10.23 6v12L12 24L1.77 18V6zm3.961 17.889l.154-.02c.113-.043.22-.081.288-.19c.227-.329-.357-.462-.566-.827s-1.071-2.364-.418-2.924s1.359-.79 1.629-1.315c.117-.236.238-.475.269-.742c.159.132.283.255.497.262c.567.036 1.054-.658 1.307-1.315c.135-.404.244-.832.218-1.226c-.069-.76.013-1.582.62-2.087c-.599.302-1.167.69-1.845.789c-.374-.114-.75-.216-1.147-.2c-.194-.253-.456-.727-.797-.782c-.58.208-.597 1.105-.842 2.321a5.4 5.4 0 0 0-1.154-.193c-.54-.035-1.42.134-2.038.116c-.619-.018-1.836-.562-2.849-.445c-.407.05-.817.12-1.195.291c-.231.105-.565.421-.733.468c-1.69.473-4.442.453-3.879-2.102c.044-.196.056-.373-.03-.417c-.11-.055-.17.06-.234.187c-.985 2.138.764 3.514 2.752 3.52c.625-.048.324-.007.904-.118l-.015.082a1.87 1.87 0 0 0 .865 1.718c-.27.771-.805 1.389-1.173 2.097c.138.881 1.031 2.057 1.4 2.225c.326.147 1.036.149 1.2-.089c.059-.111.02-.351-.044-.474c.277.308.651.736 1.013.942c.217.104.434.17.677.18l.31-.016c.154-.033.336-.058.44-.195c.116-.2.007-.756-.476-.796s-.795-.222-1.24-.882c-.365-.638.077-1.517.226-2.145c.765.123 1.535.22 2.31.222c.336-.017.67-.03 1.001-.093c.106.27.402 1.025.404 1.239c.007.601-.219 1.205-.121 1.807c.06.177.005.512.35.526l.388.018l.267-.008c.341.573.637.572 1.307.591m-7.518-1.66l-.063-.056c-.184-.198-.66-.544-.572-.865c.075-.238.213-.457.323-.683l-.004.023c-.02.282-.059.56.032.837c.278.228.663.59.918.837c-.138-.038-.4-.117-.53-.066l-.104-.026z\\\" />\\n        </svg> {{ currentTitle.slice(0, 50) }}\\n      </div>\\n    </transition>\\n  </div>\\n</template>\",\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/templates/app.vue\",\"hide-body\":\"yes\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/readme\",\"description\":\"neotw-tiddlers-view\",\"text\":\"[[在线文档|https://tiddlywiki-starter-kit.oeyoews.top/docs/plugins/neotw-tiddlers-view]]\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/viewTemplate\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/viewTemplate\",\"tags\":\"$:/tags/PageTemplate\",\"text\":\"<div class=\\\"fixed bottom-2 left-2 print:hidden\\\">\\n<$neotw-tiddlers-view />\\n</div>\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/RandomPicker.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/RandomPicker.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tiddlers-view/RandomPicker.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nclass RandomIndexPicker {\\n  constructor(length) {\\n    this.length = length;\\n    this.indexes = this.shuffle(Array.from({ length }, (_, i) => i)); // 生成随机索引数组\\n    this.current = 0;\\n  }\\n\\n  // Fisher-Yates 洗牌算法\\n  shuffle = (arr) => {\\n    for (let i = arr.length - 1; i > 0; i--) {\\n      const j = Math.floor(Math.random() * (i + 1));\\n      [arr[i], arr[j]] = [arr[j], arr[i]]; // 交换位置\\n    }\\n    return arr;\\n  };\\n\\n  getRandomIndex = () => {\\n    if (this.current >= this.length) {\\n      this.indexes = this.shuffle([...this.indexes]); // 重新洗牌\\n      this.current = 0;\\n    }\\n    return this.indexes[this.current++];\\n  };\\n}\\n\\nmodule.exports = RandomIndexPicker;\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/app.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/app.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tiddlers-view/app.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\n\\nconst getTemplate = require('../neotw-vue3/getTemplate.js');\\nconst pluginTitle = '$:/plugins/oeyoews/neotw-tiddlers-view';\\nconst RandomPicker = require('./RandomPicker.js');\\n\\nconst app = () => {\\n  const component = {\\n    template: getTemplate(`${pluginTitle}/templates/app.vue`),\\n    data() {\\n      return {\\n        allTitles: [],\\n        currentTitle: '',\\n        lastUpdateTime: 0,\\n        randomPicker: null,\\n        animationFrameId: null,\\n        filter:\\n          '[!is[system]sort[title]!is[tag]!prefix[$:/]!is[binary]!is[draft]days[-300]!sort[modified]limit[500]!tag[todo]]',\\n      };\\n    },\\n    mounted() {\\n      this.loadTitles();\\n      this.startScrolling();\\n    },\\n\\n    methods: {\\n      goToTiddler(title) {\\n        const goto = new $tw.Story();\\n        goto.navigateTiddler(title);\\n      },\\n\\n      loadTitles() {\\n        if ($tw && $tw.wiki) {\\n          this.allTitles = $tw.wiki.filterTiddlers(this.filter);\\n          this.randomPicker = new RandomPicker(this.allTitles.length);\\n          this.currentTitle = this.updateCurrentTitle();\\n        } else {\\n          console.error('TiddlyWiki API not available');\\n        }\\n      },\\n      updateCurrentTitle() {\\n        if (this.allTitles.length === 0) {\\n          return null;\\n        }\\n        const index = this.randomPicker.getRandomIndex();\\n        return this.allTitles[index];\\n      },\\n\\n      startScrolling() {\\n        // 使用requestAnimationFrame实现滚动\\n        const animate = (timestamp) => {\\n          if (!this.lastUpdateTime) this.lastUpdateTime = timestamp;\\n\\n          if (timestamp - this.lastUpdateTime >= 8000) {\\n            if (this.allTitles.length > 1) {\\n              this.currentTitle = this.updateCurrentTitle();\\n            }\\n            this.lastUpdateTime = timestamp;\\n          }\\n\\n          // 继续下一帧动画\\n          this.animationFrameId = window.requestAnimationFrame(animate);\\n        };\\n\\n        // 开始动画循环\\n        this.animationFrameId = window.requestAnimationFrame(animate);\\n      },\\n\\n      stopScrolling() {\\n        // 停止动画\\n        if (this.animationFrameId) {\\n          window.cancelAnimationFrame(this.animationFrameId);\\n          this.animationFrameId = null;\\n        }\\n      },\\n    },\\n  };\\n  return component;\\n};\\n\\nmodule.exports = app;\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/style.css\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/style.css\",\"tags\":\"$:/tags/Stylesheet\",\"text\":\".scroll-container {\\n\\tcursor: pointer;\\n\\toverflow: hidden;\\n\\tposition: relative;\\n\\tcolor: lightgray;\\n\\tfont-size: 14px;\\n}\\n.scroll-enter-active,\\n.scroll-leave-active {\\n\\ttransition: all 0.5s;\\n}\\n.scroll-enter-from {\\n\\ttransform: translateY(100%);\\n\\topacity: 0;\\n}\\n.scroll-leave-to {\\n\\ttransform: translateY(-100%);\\n\\topacity: 0;\\n}\"},\"$:/plugins/oeyoews/neotw-tiddlers-view/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tiddlers-view/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tiddlers-view/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-tiddlers-view widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass NeotwTiddlersViewWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const vuelib = '$:/plugins/oeyoews/neotw-vue3/vue.global.prod.js';\\n\\n    if (!window.Vue) {\\n      window.Vue = require(vuelib);\\n    }\\n\\n    const { createApp } = window.Vue;\\n    const component = require('./app');\\n    const domNode = this.document.createElement('div');\\n\\n    try {\\n      /** @type {{ use: Function, component: (string, Object) }} */\\n      const app = createApp(component());\\n\\n      app.config.errorHandler = (err) => {\\n        const text = `[Vue3](${app.version}): ` + err.message;\\n        console.error(text);\\n        domNode.textContent = text;\\n        domNode.style.color = 'red';\\n      };\\n\\n      // 挂载\\n      app.mount(domNode);\\n\\n      parent.insertBefore(domNode, nextSibling);\\n      this.domNodes.push(domNode);\\n    } catch (e) {\\n      console.error(e.message);\\n    }\\n  }\\n\\n  // TIP: 界面由 vue 接管， 不要在这里刷新\\n  refresh() {\\n    return false;\\n  }\\n}\\n\\n/** @description neotw-tiddlers-view widget */\\nexports['neotw-tiddlers-view'] = NeotwTiddlersViewWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}