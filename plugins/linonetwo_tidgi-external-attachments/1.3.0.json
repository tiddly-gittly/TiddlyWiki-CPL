{"author":"LinOnetwo","dependents":"","description":"External attachments for TidGi Desktop App, drag&drop image/binary file to wiki, and become skinny tiddler (a pointer to actural file). ","list":"readme settings tree","name":"External Attachments for TidGi app","plugin-type":"plugin","text":"{\"tiddlers\":{\"$:/config/ExternalAttachments/Enable\":{\"title\":\"$:/config/ExternalAttachments/Enable\",\"text\":\"yes\"},\"$:/config/ExternalAttachments/DisableForImage\":{\"title\":\"$:/config/ExternalAttachments/DisableForImage\",\"text\":\"yes\"},\"$:/config/ExternalAttachments/MoveToWikiFolder\":{\"title\":\"$:/config/ExternalAttachments/MoveToWikiFolder\",\"text\":\"yes\"},\"$:/config/ExternalAttachments/WikiFolderToMove\":{\"title\":\"$:/config/ExternalAttachments/WikiFolderToMove\",\"text\":\"files\"},\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\":{\"title\":\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\",\"text\":\"no\"},\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\":{\"title\":\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\",\"text\":\"yes\"},\"$:/plugins/linonetwo/tidgi-external-attachments/readme/en-GB\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/readme/en-GB\",\"text\":\"!！ Introduction\\n\\nThis plugin provides support for importing tiddlers as external attachments.\\n\\nOn the TidGi App, you can choose to import the binary large file as a 'reference tiddler', which means that the tiddler will refer to the original file via the ''_canonical_uri'' field, while itself will be almost an empty file, thus saving storage space in the Wiki. This reduces the size of the wiki and thus improves performance. However, it does mean that the wiki is no longer fully self-contained.\\n\\n!！ Compatibility\\n\\nThis plugin only works when using TiddlyWiki with platforms such as TiddlyDesktop/TidGi Desktop that support the ''path'' attribute for imported/dragged files (provided by app). And also need the app supports `file://` protocol of link.\\n\\n!!! Absolute `file://` link\\n\\nTidGi supports link and `_canonical_uri` to use `file://` prefix (or `open://`, both works the same), for example:\\n\\n```wikitext\\n[ext[Some External File Link with CJK character|file:///Users/linonetwo/Downloads/(OCRed)奖励的惩罚 (（美）科恩著) (Z-Library).pdf]]\\n\\n[ext[An External Folder Link|file:///Users/linonetwo/Downloads/]]\\n```\\n\\nSo when you drag a file into TidGi app, `_canonical_uri` created by this plugin will also prefixed by `file://`.\\n\\nThis prefix looks like `file:///` because absolute paths usually start with `/`, plus two slashes for `file://`, so it looks like three slashes.\\n\\n!!! Relative `file://` link\\n\\nTidGi also supports relative path in your wiki folder. Starting with `file://` and directly followed by a folder name or file name is a relative path, e.g:\\n\\n```wikitext\\n[ext[PDF in the files folder|file://files/A File.pdf]]\\n\\n[ext[Open the tiddlers folder|file://tiddlers/]]\\n```\\n\\nYou can also use `. /` to explicitly indicate that this is a relative path:\\n\\n```wikitext\\n[ext[PDF in the files folder|file://./files/A File.pdf]]\\n\\n[ext[Open the tiddlers folder|file://./tiddlers/]]\\n```\\n\\n{{$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB-desc}}\"},\"$:/plugins/linonetwo/tidgi-external-attachments/readme/zh-Hans\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/readme/zh-Hans\",\"text\":\"!! 简介\\n\\n这个插件提供了把大文件作为「外部附件」导入太记 App，变成「引用条目」的功能\\n\\n在太记 App 上，你可以选择将二进制大文件作为「引用条目」导入，也就是这个条目会通过 ''_canonical_uri'' 字段引用原始文件，它自身则几乎是个空文件，因此可以节省 Wiki 的存储空间，并提高加载的性能。然而，这也意味着 Wiki 不再是完全独立的了，需要依赖外部文件。\\n\\n!! 兼容性\\n\\n这个插件只在太记 App 桌面版上使用时有效，它支持拖曳导入文件时提供''路径''属性（由应用内的代码提供）。而且还需要应用程序支持 `file://` 协议的链接。\\n\\n!!! 绝对路径 `file://` 链接\\n\\n太记支持在链接和 `_canonical_uri` 字段里使用 `file://` 前缀（或 `open://`，两者效果相同）：\\n\\n```wikitext\\n[ext[一个带有中文字符的文件例子|file:///Users/linonetwo/Downloads/(OCRed)奖励的惩罚 (（美）科恩著) (Z-Library).pdf]]\\n\\n[ext[打开外部文件夹的链接|file:///Users/linonetwo/Downloads/]]\\n```\\n\\n因此，当你把一个文件拖入太记时，这个插件创建的 `_canonical_uri` 也将以 `file://` 为前缀。\\n\\n这个前缀看起来像是 `file:///`，是因为绝对路径一般以 `/` 开始，再加上 `file://` 的两个斜杠，所以看起来像是三个斜杠。\\n\\n!!! 相对路径 `file://` 链接\\n\\n太记还支持你的 Wiki 文件夹中的相对路径，以 `file://` 开头并直接跟上文件夹名或文件名，就是相对路径，例如：\\n\\n```wikitext\\n[ext[PDF in the files folder|file://files/A File.pdf]]\\n\\n[ext[Open the tiddlers folder|file://tiddlers/]]\\n```\\n\\n也可以用 `./` 明显地表示这是一个相对路径：\\n\\n```wikitext\\n[ext[PDF in the files folder|file://./files/A File.pdf]]\\n\\n[ext[Open the tiddlers folder|file://./tiddlers/]]\\n```\\n\\n{{$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans-desc}}\\n\\n!! 解决问题\\n\\n!!! 无法加载文件\\n\\n如果你从 Wiki 文件夹根目录拖进太记的文件无法加载，那么可以试试使用带 `./` 的相对路径。例如进入编辑模式，将 `file://A File.pdf` 这样的路径，改为 `file://./A File.pdf` 这样，可能就修复了。\"},\"$:/plugins/linonetwo/tidgi-external-attachments/readme\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/readme\",\"text\":\"<$list filter=\\\"[[$:/language]get[text]removeprefix[$:/languages/]else[en-GB]]\\\" variable=\\\"lang\\\">\\n\\n\\t<$list filter=\\\"[<lang>search[zh]]\\\">\\n\\n\\t\\t{{$:/plugins/linonetwo/tidgi-external-attachments/readme/zh-Hans}}\\n\\n\\t</$list>\\n\\n\\t<$list filter=\\\"[<lang>!search[zh]]\\\">\\n\\n\\t\\t{{$:/plugins/linonetwo/tidgi-external-attachments/readme/en-GB}}\\n\\n\\t</$list>\\n\\n</$list>\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings/settings-caption\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings/settings-caption\",\"text\":\"\\\\whitespace trim\\n\\n<$list filter=\\\"[[$:/language]get[text]removeprefix[$:/languages/]else[en-GB]]\\\" variable=\\\"lang\\\">\\n\\t<$list filter=\\\"[<lang>search[zh]]\\\">\\n\\t\\t<$transclude tiddler=\\\"$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans\\\" field=\\\"caption\\\" />\\n\\t</$list>\\n\\n\\t<$list filter=\\\"[<lang>!search[zh]]\\\">\\n\\t\\t<$transclude tiddler=\\\"$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB\\\" field=\\\"caption\\\" />\\n\\t</$list>\\n</$list>\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB-desc\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB-desc\",\"text\":\"!! Config Description\\n\\nBy default, after dragging a large file into the TidGi App, the 'reference tiddler' will use the 'absolute path' to reference the file. For example, if you drag in a PDF from your Windows desktop, the ''_canonical_uri'' field in the Reference tiddler will be filled in with the path to the PDF on your C drive desktop, so if you open the Wiki on a different computer, or delete the PDF on your desktop, the Reference tiddler in the Wiki will failed to open.\\n\\nYou can choose to use the \\\"relative path\\\" to solve this problem. There is a configuration \\\"Use absolute paths for attachments ''outside'' the Wiki folder\\\", by default is on, it means that drag-in the file on your desktop will use a absolute path reference, but also when drag-in a files in your wiki folder, it will use a relative path reference.\\n\\nSo you can firstly create a `files` folder in the Wiki folder, and then drag the PDF into that folder, and then drag the PDF in that folder into the TidGi App, imported as a \\\"reference tiddler\\\". Then even you open the Wiki on a different computer, the file in that in-Wiki folder can still be opened. Of course, you have to keep another configuration \\\"use absolute path reference file ''within'' the Wiki folder (not recommended)\\\" off, it also said that this config is \\\"not recommended to open\\\", it's only for special circumstances.\\n\\nIf you check \\\"Automatically move imported files to the Wiki folder\\\", then at the moment when the file is dragged into TidGi, it will automatically move the file to the Wiki folder, so you don't need to move the file manually. However, if you cancel the import at this time, the file will not be returned to its original location, you need to manually handle the moved file.\\n\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB\",\"caption\":\"ExtAttach\",\"text\":\"!! Configs\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/Enable\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/Enable\\\">Enable importing binary files as external attachments</$link> </$checkbox>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/DisableForImage\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/DisableForImage\\\">Disable this plugin when importing images</$link> </$checkbox>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/MoveToWikiFolder\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/MoveToWikiFolder\\\">Automatically move imported files to the Wiki folder</$link> </$checkbox>\\n\\n<%if [{$:/config/ExternalAttachments/MoveToWikiFolder}match[yes]] %>\\n\\n  <$edit-text tiddler=\\\"$:/config/ExternalAttachments/WikiFolderToMove\\\" tabindex=-1 focus=false cancelPopups=\\\"yes\\\" fileDrop=no tag=\\\"input\\\" /> Automatically move files to this folder inside the Wiki folder\\n\\n<% else %>\\n\\n  <$checkbox tiddler=\\\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\">\\n    <$link to=\\\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\\\">\\n      Use absolute paths for attachments ''outside'' the Wiki folder (anywhere on the computer)\\n    </$link>\\n  </$checkbox>\\n\\n<% endif %>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\\\">Use absolute paths for descendent attachments (inside wiki folder)</$link> </$checkbox>\\n\\n{{$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB-desc}}\\n\\n!! Trouble Shooting\\n\\n!!! Unable to load a file\\n\\nIf you drag in a file from the root of your Wiki folder and it doesn't load, then try using a relative path with `. /` as a prefix. For example, go into edit mode and change a path from `file://A File.pdf` to a path like `file://./A File.pdf` then it may be fixed.\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans-desc\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans-desc\",\"text\":\"!! 说明\\n\\n默认情况下，将大文件拖入太记 App 后，「引用条目」会使用「绝对路径」来引用该文件。例如你把 Windows 桌面上的 PDF 拖进来，「引用条目」里的 ''_canonical_uri'' 字段会填写 C 盘桌面上 PDF 的路径，这样如果你换了台电脑打开 Wiki，或把桌面上的 PDF 删了，在 Wiki 里的「引用条目」也会打不开。\\n\\n你可以选择使用「相对路径」来解决这个问题。上面有个配置「为 Wiki 文件夹''外''的附件使用绝对路径」，默认是开启的，它的意思是你桌面上的文件它会用绝对路径引用，而 Wiki 文件夹里的文件它会用相对路径引用。\\n\\n所以你可以先在 Wiki 文件夹里创建一个 `files` 文件夹，然后先把 PDF 拖进那个文件夹，再把那个文件夹里的 PDF 拖进太记 App 里，作为「引用条目」导入。这样你换了台电脑打开 Wiki，之前桌面上的文件打不开，但放在 Wiki 文件夹里任何文件夹里的文件还是可以打开的。当然，你得保持另一个配置「使用绝对路径引用 Wiki 文件夹''内''的文件（不推荐开启）」是关闭的，它也说了自己「不推荐开启」，仅供特殊情况使用。\\n\\n如果勾选了「自动将拖入的文件移动到 Wiki 文件夹内」，则在文件拖入太微的那一瞬间，就会自动将文件移动到 Wiki 文件夹内，这样你就不用手动移动文件了。不过注意的是，如果这时候取消导入，文件也不会被放回原处，你需要手动处理一下移过去的文件。\\n\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans\",\"caption\":\"外部附件\",\"text\":\"!! 配置项\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/Enable\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/Enable\\\" >启用本插件，将拖入的二进制文件都作为「引用条目」导入</$link> </$checkbox>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/DisableForImage\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/DisableForImage\\\">在拖入图片时不启用本插件</$link> </$checkbox>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/MoveToWikiFolder\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/MoveToWikiFolder\\\">自动将拖入的文件移动到 Wiki 文件夹内</$link> </$checkbox>\\n\\n<%if [{$:/config/ExternalAttachments/MoveToWikiFolder}match[yes]] %>\\n\\n  <$edit-text tiddler=\\\"$:/config/ExternalAttachments/WikiFolderToMove\\\" tabindex=-1 focus=false cancelPopups=\\\"yes\\\" fileDrop=no tag=\\\"input\\\" /> 自动移动文件到 Wiki 文件夹里的这个文件夹里\\n\\n<% else %>\\n\\n  <$checkbox tiddler=\\\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\">\\n    <$link to=\\\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\\\">\\n      为 Wiki 文件夹''外''的附件使用绝对路径（文件在电脑上的任何地方）\\n    </$link>\\n  </$checkbox>\\n\\n<% endif %>\\n\\n<$checkbox tiddler=\\\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> <$link to=\\\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\\\">使用绝对路径引用 Wiki 文件夹''内''的文件（不推荐开启）</$link> </$checkbox>\\n\\n{{$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans-desc}}\"},\"$:/plugins/linonetwo/tidgi-external-attachments/settings\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/settings\",\"tags\":\"$:/tags/ControlPanel/SettingsTab\",\"caption\":\"{{$:/plugins/linonetwo/tidgi-external-attachments/settings/settings-caption}}\",\"text\":\"<$list filter=\\\"[[$:/language]get[text]removeprefix[$:/languages/]else[en-GB]]\\\" variable=\\\"lang\\\">\\n\\n\\t<$list filter=\\\"[<lang>search[zh]]\\\">\\n\\t\\n\\t\\t{{$:/plugins/linonetwo/tidgi-external-attachments/settings/zh-Hans}}\\n\\n\\t</$list>\\n\\n\\t<$list filter=\\\"[<lang>!search[zh]]\\\">\\n\\t\\n\\t\\t{{$:/plugins/linonetwo/tidgi-external-attachments/settings/en-GB}}\\n\\n\\t</$list>\\n\\n</$list>\"},\"$:/plugins/linonetwo/tidgi-external-attachments/tree\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/tree\",\"caption\":\"{{$:/language/SideBar/Explorer/Caption}}\",\"text\":\"<<tree \\\"$:/plugins/linonetwo/tidgi-external-attachments/\\\">>\\n\"},\"$:/plugins/linonetwo/tidgi-external-attachments/startup.js\":{\"title\":\"$:/plugins/linonetwo/tidgi-external-attachments/startup.js\",\"type\":\"application/javascript\",\"module-type\":\"startup\",\"Modern.TiddlyDev#Origin\":\"startup.ts\",\"text\":\"\\\"use strict\\\";var ENABLE_EXTERNAL_ATTACHMENTS_TITLE=\\\"$:/config/ExternalAttachments/Enable\\\",DISSABLE_FOR_IMAGE_TITLE=\\\"$:/config/ExternalAttachments/DisableForImage\\\",USE_ABSOLUTE_FOR_DESCENDENTS_TITLE=\\\"$:/config/ExternalAttachments/UseAbsoluteForDescendents\\\",USE_ABSOLUTE_FOR_NON_DESCENDENTS_TITLE=\\\"$:/config/ExternalAttachments/UseAbsoluteForNonDescendents\\\",MOVE_TO_WIKI_FOLDER_TITLE=\\\"$:/config/ExternalAttachments/MoveToWikiFolder\\\",WIKI_FOLDER_TO_MOVE_TITLE=\\\"$:/config/ExternalAttachments/WikiFolderToMove\\\";function joinPaths(...e){let t=e.join(\\\"/\\\");return t=$tw.platform.isWindows?t.replaceAll(\\\"/\\\",\\\"\\\\\\\\\\\"):t}function basePath(e){return $tw.platform.isWindows?e.split(\\\"\\\\\\\\\\\").pop()||\\\"\\\":e.split(\\\"/\\\").pop()||\\\"\\\"}function makePathRelative(e,t,n={}){const i=(e=$tw.platform.isWindows&&\\\"//\\\"===(e=\\\"/\\\"!==(e=e.replaceAll(\\\"\\\\\\\\\\\",\\\"/\\\")).charAt(0)?\\\"/\\\"+e:e).substring(0,2)?e.substring(1):e).split(\\\"/\\\");var o=t.split(\\\"/\\\"),s=[];$tw.platform.isMac&&\\\"private\\\"===i[1]&&i.splice(1,1),$tw.utils.each(i,function(e,t){i[t]=encodeURI(e)});let r=0;for(;r<i.length&&r<o.length&&i[r]===o[r];)r+=1;if(1===r||n.useAbsoluteForNonDescendents&&r<o.length||n.useAbsoluteForDescendents&&r===o.length)return e;let a=0;for(a=r;a<o.length-1;a++)s.push(\\\"..\\\");for(a=r;a<i.length;a++)s.push(i[a]);return s.join(\\\"/\\\")}exports.name=\\\"tidgi-external-attachments\\\",exports.platforms=[\\\"browser\\\"],exports.after=[\\\"startup\\\"],exports.synchronous=!0,exports.startup=function(){var e;\\\"undefined\\\"!=typeof window&&\\\"function\\\"==typeof window.meta&&(e=window?.meta?.()?.workspaceID)&&window?.service?.workspace?.get(e).then(e=>{const o=e?.wikiFolderLocation;o&&$tw.hooks.addHook(\\\"th-importing-file\\\",function(e){var t,n;if(e.type.startsWith(\\\"image\\\")&&\\\"yes\\\"===$tw.wiki.getTiddlerText(DISSABLE_FOR_IMAGE_TITLE,\\\"\\\"))return!1;let i=window.remote?.getPathForFile?.(e.file);return!(!e.isBinary||!i||\\\"yes\\\"!==$tw.wiki.getTiddlerText(ENABLE_EXTERNAL_ATTACHMENTS_TITLE,\\\"\\\")||(\\\"yes\\\"===$tw.wiki.getTiddlerText(MOVE_TO_WIKI_FOLDER_TITLE,\\\"\\\")&&(t=$tw.wiki.getTiddlerText(WIKI_FOLDER_TO_MOVE_TITLE,\\\"\\\"),n=i,t=joinPaths(o,t,basePath(i)),i=t,window.service?.[\\\"native\\\"]?.movePath?.(n,t,{fileToDir:!0})),n=makePathRelative(i,o,{useAbsoluteForNonDescendents:\\\"yes\\\"===$tw.wiki.getTiddlerText(USE_ABSOLUTE_FOR_NON_DESCENDENTS_TITLE,\\\"\\\"),useAbsoluteForDescendents:\\\"yes\\\"===$tw.wiki.getTiddlerText(USE_ABSOLUTE_FOR_DESCENDENTS_TITLE,\\\"\\\")}),e.callback([{title:e.file.name,type:e.type,_canonical_uri:n=\\\"file://\\\"+n}]),0))})})};\"}}}","title":"$:/plugins/linonetwo/tidgi-external-attachments","type":"application/json","version":"1.3.0","Modern.TiddlyDev#SHA256-Hashed":"7b18d6c6a6df3cf891464c4784bf843f9728da6aa9a5e82bd2d19033cdca8819"}