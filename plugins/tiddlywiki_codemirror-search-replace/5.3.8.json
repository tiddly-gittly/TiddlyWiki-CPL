{"title":"$:/plugins/tiddlywiki/codemirror-search-replace","name":"CodeMirror Search and Replace","description":"Search and replace for CodeMirror","parent-plugin":"$:/plugins/tiddlywiki/codemirror","list":"readme","stability":"STABILITY_2_STABLE","version":"5.3.8","plugin-type":"plugin","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/tiddlywiki/codemirror/addon/search/search.js\":{\"text\":\"!function(e){\\\"object\\\"==typeof exports&&\\\"object\\\"==typeof module?e(require(\\\"../../lib/codemirror\\\"),require(\\\"./searchcursor\\\"),require(\\\"../dialog/dialog\\\")):\\\"function\\\"==typeof define&&define.amd?define([\\\"../../lib/codemirror\\\",\\\"./searchcursor\\\",\\\"../dialog/dialog\\\"],e):e(CodeMirror)}(function(f){\\\"use strict\\\";function r(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}function p(e){return e.state.search||(e.state.search=new r)}function n(e){return\\\"string\\\"==typeof e&&e==e.toLowerCase()}function d(e,r,o){return e.getSearchCursor(r,o,{caseFold:n(r),multiline:!0})}function m(e,r,o,t,n){e.openDialog?e.openDialog(r,n,{value:t,selectValueOnOpen:!0,bottom:e.options.search.bottom}):n(prompt(o,t))}function h(e){return e.replace(/\\\\\\\\([nrt\\\\\\\\])/g,function(e,r){return\\\"n\\\"==r?\\\"\\\\n\\\":\\\"r\\\"==r?\\\"\\\\r\\\":\\\"t\\\"==r?\\\"\\\\t\\\":\\\"\\\\\\\\\\\"==r?\\\"\\\\\\\\\\\":e})}function a(e){var r=e.match(/^\\\\/(.*)\\\\/([a-z]*)$/);if(r)try{e=new RegExp(r[1],-1==r[2].indexOf(\\\"i\\\")?\\\"\\\":\\\"i\\\")}catch(e){}else e=h(e);return e=(\\\"string\\\"==typeof e?\\\"\\\"==e:e.test(\\\"\\\"))?/x^/:e}function y(e,r,o){var t;r.queryText=o,r.query=a(o),e.removeOverlay(r.overlay,n(r.query)),r.overlay=(t=r.query,o=n(r.query),\\\"string\\\"==typeof t?t=new RegExp(t.replace(/[\\\\-\\\\[\\\\]\\\\/\\\\{\\\\}\\\\(\\\\)\\\\*\\\\+\\\\?\\\\.\\\\\\\\\\\\^\\\\$\\\\|]/g,\\\"\\\\\\\\$&\\\"),o?\\\"gi\\\":\\\"g\\\"):t.global||(t=new RegExp(t.source,t.ignoreCase?\\\"gi\\\":\\\"g\\\")),{token:function(e){t.lastIndex=e.pos;var r=t.exec(e.string);if(r&&r.index==e.pos)return e.pos+=r[0].length||1,\\\"searching\\\";r?e.pos=r.index:e.skipToEnd()}}),e.addOverlay(r.overlay),e.showMatchesOnScrollbar&&(r.annotate&&(r.annotate.clear(),r.annotate=null),r.annotate=e.showMatchesOnScrollbar(r.query,n(r.query)))}function o(n,r,e,o){var t=p(n);if(t.query)return g(n,r);var a,i,s,c,l,u=n.getSelection()||t.lastQuery;u instanceof RegExp&&\\\"x^\\\"==u.source&&(u=null),e&&n.openDialog?(a=null,i=function(e,r){f.e_stop(r),e&&(e!=t.queryText&&(y(n,t,e),t.posFrom=t.posTo=n.getCursor()),a&&(a.style.opacity=1),g(n,r.shiftKey,function(e,r){var o;r.line<3&&document.querySelector&&(o=n.display.wrapper.querySelector(\\\".CodeMirror-dialog\\\"))&&o.getBoundingClientRect().bottom-4>n.cursorCoords(r,\\\"window\\\").top&&((a=o).style.opacity=.4)}))},e=C(s=n),c=u,l=function(e,r){var o=f.keyName(e),t=n.getOption(\\\"extraKeys\\\"),t=t&&t[o]||f.keyMap[n.getOption(\\\"keyMap\\\")][o];\\\"findNext\\\"==t||\\\"findPrev\\\"==t||\\\"findPersistentNext\\\"==t||\\\"findPersistentPrev\\\"==t?(f.e_stop(e),y(n,p(n),r),n.execCommand(t)):\\\"find\\\"!=t&&\\\"findPersistent\\\"!=t||(f.e_stop(e),i(r,e))},s.openDialog(e,i,{value:c,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){v(s)},onKeyDown:l,bottom:s.options.search.bottom}),o&&u&&(y(n,t,u),g(n,r))):m(n,C(n),\\\"Search for:\\\",u,function(e){e&&!t.query&&n.operation(function(){y(n,t,e),t.posFrom=t.posTo=n.getCursor(),g(n,r)})})}function g(o,t,n){o.operation(function(){var e=p(o),r=d(o,e.query,t?e.posFrom:e.posTo);(r.find(t)||(r=d(o,e.query,t?f.Pos(o.lastLine()):f.Pos(o.firstLine(),0))).find(t))&&(o.setSelection(r.from(),r.to()),o.scrollIntoView({from:r.from(),to:r.to()},20),e.posFrom=r.from(),e.posTo=r.to(),n&&n(r.from(),r.to()))})}function v(r){r.operation(function(){var e=p(r);e.lastQuery=e.query,e.query&&(e.query=e.queryText=null,r.removeOverlay(e.overlay),e.annotate&&(e.annotate.clear(),e.annotate=null))})}function x(e,r){var o,t=e?document.createElement(e):document.createDocumentFragment();for(o in r)t[o]=r[o];for(var n=2;n<arguments.length;n++){var a=arguments[n];t.appendChild(\\\"string\\\"==typeof a?document.createTextNode(a):a)}return t}function C(e){var r=x(\\\"label\\\",{className:\\\"CodeMirror-search-label\\\"},e.phrase(\\\"Search:\\\"),x(\\\"input\\\",{type:\\\"text\\\",style:\\\"width: 10em\\\",className:\\\"CodeMirror-search-field\\\",id:\\\"CodeMirror-search-field\\\"}));return r.setAttribute(\\\"for\\\",\\\"CodeMirror-search-field\\\"),x(\\\"\\\",null,r,\\\" \\\",x(\\\"span\\\",{style:\\\"color: #666\\\",className:\\\"CodeMirror-search-hint\\\"},e.phrase(\\\"(Use /re/ syntax for regexp search)\\\")))}function b(r,t,n){r.operation(function(){for(var o,e=d(r,t);e.findNext();)\\\"string\\\"!=typeof t?(o=r.getRange(e.from(),e.to()).match(t),e.replace(n.replace(/\\\\$(\\\\d)/g,function(e,r){return o[r]}))):e.replace(n)})}function t(u,e){var r,o,t;u.getOption(\\\"readOnly\\\")||(r=u.getSelection()||p(u).lastQuery,t=x(\\\"\\\",null,x(\\\"span\\\",{className:\\\"CodeMirror-search-label\\\"},o=e?u.phrase(\\\"Replace all:\\\"):u.phrase(\\\"Replace:\\\")),(t=u,x(\\\"\\\",null,\\\" \\\",x(\\\"input\\\",{type:\\\"text\\\",style:\\\"width: 10em\\\",className:\\\"CodeMirror-search-field\\\"}),\\\" \\\",x(\\\"span\\\",{style:\\\"color: #666\\\",className:\\\"CodeMirror-search-hint\\\"},t.phrase(\\\"(Use /re/ syntax for regexp search)\\\"))))),m(u,t,o,r,function(l){l&&(l=a(l),m(u,x(\\\"\\\",null,x(\\\"span\\\",{className:\\\"CodeMirror-search-label\\\"},u.phrase(\\\"With:\\\")),\\\" \\\",x(\\\"input\\\",{type:\\\"text\\\",style:\\\"width: 10em\\\",className:\\\"CodeMirror-search-field\\\"})),u.phrase(\\\"Replace with:\\\"),\\\"\\\",function(a){var i,s,c;a=h(a),e?b(u,l,a):(v(u),i=d(u,l,u.getCursor(\\\"from\\\")),c=function(o){i.replace(\\\"string\\\"==typeof l?a:a.replace(/\\\\$(\\\\d)/g,function(e,r){return o[r]})),s()},(s=function(){var e,r,o,t,n=i.from();!(e=i.findNext())&&(i=d(u,l),!(e=i.findNext())||n&&i.from().line==n.line&&i.from().ch==n.ch)||(u.setSelection(i.from(),i.to()),u.scrollIntoView({from:i.from(),to:i.to()}),t=x(\\\"\\\",null,x(\\\"span\\\",{className:\\\"CodeMirror-search-label\\\"},(t=n=u).phrase(\\\"Replace?\\\")),\\\" \\\",x(\\\"button\\\",{},t.phrase(\\\"Yes\\\")),\\\" \\\",x(\\\"button\\\",{},t.phrase(\\\"No\\\")),\\\" \\\",x(\\\"button\\\",{},t.phrase(\\\"All\\\")),\\\" \\\",x(\\\"button\\\",{},t.phrase(\\\"Stop\\\"))),r=u.phrase(\\\"Replace?\\\"),o=[function(){c(e)},s,function(){b(u,l,a)}],n.openConfirm?n.openConfirm(t,o):confirm(r)&&o[0]())})())}))}))}f.defineOption(\\\"search\\\",{bottom:!1}),f.commands.find=function(e){v(e),o(e)},f.commands.findPersistent=function(e){v(e),o(e,!1,!0)},f.commands.findPersistentNext=function(e){o(e,!1,!0,!0)},f.commands.findPersistentPrev=function(e){o(e,!0,!0,!0)},f.commands.findNext=o,f.commands.findPrev=function(e){o(e,!0)},f.commands.clearSearch=v,f.commands.replace=t,f.commands.replaceAll=function(e){t(e,!0)}});\",\"type\":\"application/javascript\",\"title\":\"$:/plugins/tiddlywiki/codemirror/addon/search/search.js\",\"module-type\":\"codemirror\"},\"$:/plugins/tiddlywiki/codemirror/addon/search/jump-to-line.js\":{\"text\":\"!function(e){\\\"object\\\"==typeof exports&&\\\"object\\\"==typeof module?e(require(\\\"../../lib/codemirror\\\"),require(\\\"../dialog/dialog\\\")):\\\"function\\\"==typeof define&&define.amd?define([\\\"../../lib/codemirror\\\",\\\"../dialog/dialog\\\"],e):e(CodeMirror)}(function(e){\\\"use strict\\\";function l(e,o){var r=Number(o);return/^[-+]/.test(o)?e.getCursor().line+r:r-1}e.defineOption(\\\"search\\\",{bottom:!1}),e.commands.jumpToLine=function(t){var e,o,r,s,i,n=t.getCursor();i=(i=e=t).phrase(\\\"Jump to line:\\\")+' <input type=\\\"text\\\" style=\\\"width: 10em\\\" class=\\\"CodeMirror-search-field\\\"/> <span style=\\\"color: #888\\\" class=\\\"CodeMirror-search-hint\\\">'+i.phrase(\\\"(Use line:column or scroll% syntax)\\\")+\\\"</span>\\\",o=t.phrase(\\\"Jump to line:\\\"),r=n.line+1+\\\":\\\"+n.ch,s=function(e){var o,r;e&&((o=/^\\\\s*([\\\\+\\\\-]?\\\\d+)\\\\s*\\\\:\\\\s*(\\\\d+)\\\\s*$/.exec(e))?t.setCursor(l(t,o[1]),Number(o[2])):(o=/^\\\\s*([\\\\+\\\\-]?\\\\d+(\\\\.\\\\d+)?)\\\\%\\\\s*/.exec(e))?(r=Math.round(t.lineCount()*Number(o[1])/100),/^[-+]/.test(o[1])&&(r=n.line+r+1),t.setCursor(r-1,n.ch)):(o=/^\\\\s*\\\\:?\\\\s*([\\\\+\\\\-]?\\\\d+)\\\\s*/.exec(e))&&t.setCursor(l(t,o[1]),n.ch))},e.openDialog?e.openDialog(i,s,{value:r,selectValueOnOpen:!0,bottom:e.options.search.bottom}):s(prompt(o,r))},e.keyMap.default[\\\"Alt-G\\\"]=\\\"jumpToLine\\\"});\",\"type\":\"application/javascript\",\"title\":\"$:/plugins/tiddlywiki/codemirror/addon/search/jump-to-line.js\",\"module-type\":\"codemirror\"},\"$:/plugins/tiddlywiki/codemirror/addon/search/searchcursor.js\":{\"text\":\"!function(t){\\\"object\\\"==typeof exports&&\\\"object\\\"==typeof module?t(require(\\\"../../lib/codemirror\\\")):\\\"function\\\"==typeof define&&define.amd?define([\\\"../../lib/codemirror\\\"],t):t(CodeMirror)}(function(r){\\\"use strict\\\";var p,v,x=r.Pos;function m(t,e){for(var n,i=null!=(i=(n=t).flags)?i:(n.ignoreCase?\\\"i\\\":\\\"\\\")+(n.global?\\\"g\\\":\\\"\\\")+(n.multiline?\\\"m\\\":\\\"\\\"),r=i,o=0;o<e.length;o++)-1==r.indexOf(e.charAt(o))&&(r+=e.charAt(o));return i==r?t:new RegExp(t.source,r)}function d(t){return/\\\\\\\\s|\\\\\\\\n|\\\\n|\\\\\\\\W|\\\\\\\\D|\\\\[\\\\^/.test(t.source)}function a(t,e,n){e=m(e,\\\"g\\\");for(var i=n.line,r=n.ch,o=t.lastLine();i<=o;i++,r=0){e.lastIndex=r;var h=t.getLine(i),h=e.exec(h);if(h)return{from:x(i,h.index),to:x(i,h.index+h[0].length),match:h}}}function o(t,e,n){if(!d(e))return a(t,e,n);e=m(e,\\\"gm\\\");for(var i=1,r=n.line,o=t.lastLine();r<=o;){for(var h=0;h<i&&!(o<r);h++)var l=t.getLine(r++),c=null==c?l:c+\\\"\\\\n\\\"+l;i*=2,e.lastIndex=n.ch;var s,f,g,u=e.exec(c);if(u)return g=c.slice(0,u.index).split(\\\"\\\\n\\\"),s=u[0].split(\\\"\\\\n\\\"),f=n.line+g.length-1,g=g[g.length-1].length,{from:x(f,g),to:x(f+s.length-1,1==s.length?g+s[0].length:s[s.length-1].length),match:u}}}function L(t,e,n){for(var i,r=0;r<=t.length;){e.lastIndex=r;var o=e.exec(t);if(!o)break;var h=o.index+o[0].length;if(h>t.length-n)break;(!i||h>i.index+i[0].length)&&(i=o),r=o.index+1}return i}function O(t,e,n){e=m(e,\\\"g\\\");for(var i=n.line,r=n.ch,o=t.firstLine();o<=i;i--,r=-1){var h=t.getLine(i),h=L(h,e,r<0?0:h.length-r);if(h)return{from:x(i,h.index),to:x(i,h.index+h[0].length),match:h}}}function h(t,e,n){if(!d(e))return O(t,e,n);e=m(e,\\\"gm\\\");for(var i=1,r=t.getLine(n.line).length-n.ch,o=n.line,h=t.firstLine();h<=o;){for(var l=0;l<i&&h<=o;l++)var c=t.getLine(o--),s=null==s?c:c+\\\"\\\\n\\\"+s;i*=2;var f,g,u,a=L(s,e,r);if(a)return u=s.slice(0,a.index).split(\\\"\\\\n\\\"),f=a[0].split(\\\"\\\\n\\\"),g=o+u.length,u=u[u.length-1].length,{from:x(g,u),to:x(g+f.length-1,1==f.length?u+f[0].length:f[f.length-1].length),match:a}}}function y(t,e,n,i){if(t.length==e.length)return n;for(var r=0,o=n+Math.max(0,t.length-e.length);;){if(r==o)return r;var h=r+o>>1,l=i(t.slice(0,h)).length;if(l==n)return h;n<l?o=h:r=1+h}}function l(t,e,n,i){if(!e.length)return null;var r=i?p:v,o=r(e).split(/\\\\r|\\\\n\\\\r?/);t:for(var h=n.line,l=n.ch,c=t.lastLine()+1-o.length;h<=c;h++,l=0){var s=t.getLine(h).slice(l),f=r(s);if(1==o.length){var g=f.indexOf(o[0]);if(-1==g);else return n=y(s,f,g,r)+l,{from:x(h,y(s,f,g,r)+l),to:x(h,y(s,f,g+o[0].length,r)+l)}}else{g=f.length-o[0].length;if(f.slice(g)==o[0]){for(var u=1;u<o.length-1;u++)if(r(t.getLine(h+u))!=o[u])continue t;var a=t.getLine(h+o.length-1),m=r(a),d=o[o.length-1];if(m.slice(0,d.length)==d)return{from:x(h,y(s,f,g,r)+l),to:x(h+o.length-1,y(a,m,d.length,r))}}}}}function c(t,e,n,i){if(!e.length)return null;var r=i?p:v,o=r(e).split(/\\\\r|\\\\n\\\\r?/);t:for(var h=n.line,l=n.ch,c=t.firstLine()-1+o.length;c<=h;h--,l=-1){var s=t.getLine(h),f=r(s=-1<l?s.slice(0,l):s);if(1==o.length){var g=f.lastIndexOf(o[0]);if(-1!=g)return{from:x(h,y(s,f,g,r)),to:x(h,y(s,f,g+o[0].length,r))}}else{g=o[o.length-1];if(f.slice(0,g.length)==g){for(var u=1,n=h-o.length+1;u<o.length-1;u++)if(r(t.getLine(n+u))!=o[u])continue t;var a=t.getLine(h+1-o.length),m=r(a);if(m.slice(m.length-o[0].length)==o[0])return{from:x(h+1-o.length,y(a,m,a.length-o[0].length,r)),to:x(h,y(s,f,g.length,r))}}}}}function i(n,i,t,e){var r;this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=n,t=t?n.clipPos(t):x(0,0),this.pos={from:t,to:t},\\\"object\\\"==typeof e?r=e.caseFold:(r=e,e=null),\\\"string\\\"==typeof i?(null==r&&(r=!1),this.matches=function(t,e){return(t?c:l)(n,i,e,r)}):(i=m(i,\\\"gm\\\"),e&&!1===e.multiline?this.matches=function(t,e){return(t?O:a)(n,i,e)}:this.matches=function(t,e){return(t?h:o)(n,i,e)})}v=String.prototype.normalize?(p=function(t){return t.normalize(\\\"NFD\\\").toLowerCase()},function(t){return t.normalize(\\\"NFD\\\")}):(p=function(t){return t.toLowerCase()},function(t){return t}),i.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){var e=this.doc.clipPos(t?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(e=x(e.line,e.ch),t?(e.ch--,e.ch<0&&(e.line--,e.ch=(this.doc.getLine(e.line)||\\\"\\\").length)):(e.ch++,e.ch>(this.doc.getLine(e.line)||\\\"\\\").length&&(e.ch=0,e.line++)),0!=r.cmpPos(e,this.doc.clipPos(e))))return this.atOccurrence=!1;var e=this.matches(t,e);return this.afterEmptyMatch=e&&0==r.cmpPos(e.from,e.to),e?(this.pos=e,this.atOccurrence=!0,this.pos.match||!0):(e=x(t?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:e,to:e},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t,e){this.atOccurrence&&(t=r.splitLines(t),this.doc.replaceRange(t,this.pos.from,this.pos.to,e),this.pos.to=x(this.pos.from.line+t.length-1,t[t.length-1].length+(1==t.length?this.pos.from.ch:0)))}},r.defineExtension(\\\"getSearchCursor\\\",function(t,e,n){return new i(this.doc,t,e,n)}),r.defineDocExtension(\\\"getSearchCursor\\\",function(t,e,n){return new i(this,t,e,n)}),r.defineExtension(\\\"selectMatches\\\",function(t,e){for(var n=[],i=this.getSearchCursor(t,this.getCursor(\\\"from\\\"),e);i.findNext()&&!(0<r.cmpPos(i.to(),this.getCursor(\\\"to\\\")));)n.push({anchor:i.from(),head:i.to()});n.length&&this.setSelections(n,0)})});\",\"type\":\"application/javascript\",\"title\":\"$:/plugins/tiddlywiki/codemirror/addon/search/searchcursor.js\",\"module-type\":\"codemirror\"},\"$:/plugins/tiddlywiki/codemirror-search-replace/readme\":{\"title\":\"$:/plugins/tiddlywiki/codemirror-search-replace/readme\",\"text\":\"This plugin enhances the [[CodeMirror|http://codemirror.net]] text editor with Search and Replace functionality. It needs the latest [[CodeMirror plugin|$:/plugins/tiddlywiki/codemirror]] to be installed\\n\\nIt adds these Keyboard Shortcuts to ~CodeMirror:\\n\\n|Shortcut |Function |h\\n|Ctrl-F / Cmd-F |Start searching |\\n|Ctrl-G / Cmd-G / Shift-F3 |Find next |\\n|Shift-Ctrl-G / Shift-Cmd-G / F3 |Find previous |\\n|Shift-Ctrl-F / Cmd-Option-F |Replace |\\n|Shift-Ctrl-R / Shift-Cmd-Option-F |Replace all |\\n|Alt-F |Persistent search (dialog doesn't autoclose, enter to find next, Shift-Enter to find previous) |\\n|Alt-G |Jump to line |\\n\\n\"}}}","author":"tiddlywiki"}