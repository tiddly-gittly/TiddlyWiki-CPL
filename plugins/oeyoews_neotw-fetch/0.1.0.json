{"title":"$:/plugins/oeyoews/neotw-fetch","description":"Neotw Fetch","author":"oeyoews","version":"0.1.0","core-version":">=5.3.1","type":"application/json","plugin-type":"plugin","name":"Neotw Fetch","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-fetch/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/readme\",\"text\":\"!! Getfile\\n\\n\\n!! TODO\\n\\n* [ ] 借鉴 tw 的 tm-http\\n* [ ] markdown img 语法会残留 tc-imag-loading\"},\"$:/plugins/oeyoews/neotw-fetch/addfile.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/addfile.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/addfile.js\\ntype: application/javascript\\nmodule-type: library\\n\\n仅支持简单的两层数据嵌套\\n\\\\*/\\nexports.addfile=async(t,r,e=\\\"text\\\")=>{try{const i=await fetch(t);if(!i.ok)return;const o=await i[e]();if(!o)return;if($tw.wiki.tiddlerExists(r))return void console.warn(`${r} 已存在`);$tw.wiki.addTiddler({title:r,type:\\\"text/markdown\\\",text:o})}catch(t){console.error(\\\"Error fetching data:\\\",t)}},exports.getText=async t=>{try{const r=await fetch(t);if(!r.ok)return;return await r.text()}catch(t){return void console.error(t)}};\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-fetch/startup.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/startup.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/startup.js\\ntype: application/javascript\\nmodule-type: startup\\n\\nfetch-readme module\\n\\\\*/\\nexports.name=\\\"fetch-readme-startup-hook\\\",exports.platforms=[\\\"browser\\\"],exports.after=[\\\"startup\\\"],exports.synchronous=!0,exports.startup=()=>{const{addfile:e}=require(\\\"./addfile\\\");$tw.rootWidget.addEventListener(\\\"om-fetch\\\",(async t=>{const r=(new Date).getTime(),{paramObject:{url:o=\\\"https://raw.githubusercontent.com/oeyoews/neotw/main/README.md\\\",fileName:a=`fetch-${r}`}={}}=t;await e(o,a)}))};\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/oeyoews/neotw-fetch/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nfetch-mdfile widget\\n\\\\*/\\nconst{widget:e}=require(\\\"$:/core/modules/widgets/widget.js\\\"),{getText:t}=require(\\\"./addfile\\\");exports.fetch=class extends e{constructor(e,t){super(e,t)}async render(e,s){if(!$tw.browser)return;this.parentDomNode=e,this.computeAttributes(),this.execute(),$tw.modules.titles[\\\"nprogress.min.js\\\"]||(new $tw.Notify).display({title:\\\"neotw-fetch\\\",status:\\\"warning\\\",autoclose:!1,type:1,text:\\\"缺失 NProgress 插件\\\"});const r=$tw.NProgress,o=\\\"https://raw.githubusercontent.com/oeyoews/neotw/main/README.md\\\",{url:i=o}=this.attributes,n=this.document.createElement(\\\"div\\\");n.className=\\\"h-48 w-full rounded animate-pulse bg-gray-200\\\",e.insertBefore(n,s),this.domNodes.push(n),r.start();const d=await t(i),u=this.document.createElement(\\\"div\\\"),a=$tw.wiki.renderText(\\\"text/html\\\",\\\"text/markdown\\\",d);u.innerHTML=a,r.done(),e.insertBefore(u,n),this.removeChildDomNodes(n)}refresh(){return!1}};\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}