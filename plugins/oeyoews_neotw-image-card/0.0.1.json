{"title":"$:/plugins/oeyoews/neotw-image-card","description":"neotw-image-card","author":"oeyoews","version":"0.0.1","core-version":">=5.3.4","type":"application/json","plugin-type":"plugin","name":"neotw-image-card","meat#disabled":"yes","qrcode":"yes","created":"2025/02/16","dependents":"","stability":"STABILITY_2_STABLE","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-image-card/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-image-card/readme\",\"description\":\"neotw-image-card\",\"text\":\"[[在线文档|https://neotw.vercel.app/docs/plugins/neotw-image-card]]\"},\"$:/plugins/oeyoews/neotw-image-card/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-card/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-card/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-image-card widget\\n\\n\\\\*/\\nconst{widget:e}=require(\\\"$:/core/modules/widgets/widget.js\\\");exports[\\\"neotw-image-card\\\"]=class extends e{constructor(e,t){super(e,t)}render(e,t){if(!$tw.browser)return;if(this.computeAttributes(),this.execute(),this.document.isTiddlyWikiFakeDom)return;const i=$tw.utils.domMaker,d=this.getAttribute(\\\"src\\\"),o=(this.getAttribute(\\\"width\\\"),i(\\\"div\\\",{class:\\\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-500 transition-colors\\\",text:\\\"拖放图片到这里或点击上传\\\"})),r=i(\\\"canvas\\\",{class:\\\"w-full h-auto hidden\\\"}),s=i(\\\"button\\\",{class:\\\"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 hidden\\\",text:\\\"复制图片\\\"}),a=i(\\\"div\\\",{children:[o,r,s]}),h=e=>{if(\\\"string\\\"==typeof e){const t=new Image;t.crossOrigin=\\\"anonymous\\\",t.onload=()=>{const e=r,i=e.getContext(\\\"2d\\\");e.width=t.width+160,e.height=t.height+160;const d=i.createLinearGradient(0,0,e.width,e.height);d.addColorStop(0,\\\"#aee3ff\\\"),d.addColorStop(1,\\\"#cefdb6\\\"),i.fillStyle=d,i.fillRect(0,0,e.width,e.height);const a=(e.width-t.width)/2,h=(e.height-t.height)/2;i.beginPath();const n=20;i.moveTo(a+n,h),i.lineTo(a+t.width-n,h),i.arcTo(a+t.width,h,a+t.width,h+n,n),i.lineTo(a+t.width,h+t.height-n),i.arcTo(a+t.width,h+t.height,a+t.width-n,h+t.height,n),i.lineTo(a+n,h+t.height),i.arcTo(a,h+t.height,a,h+t.height-n,n),i.lineTo(a,h+n),i.arcTo(a,h,a+n,h,n),i.closePath(),i.clip(),i.drawImage(t,a,h),r.classList.remove(\\\"hidden\\\"),s.classList.remove(\\\"hidden\\\"),o.classList.add(\\\"hidden\\\")},t.onerror=()=>{console.error(\\\"图片加载失败:\\\",e)},t.src=e}else{const t=new FileReader;t.onload=e=>{const t=new Image;t.style.borderRadius=\\\"20px\\\",t.onload=()=>{const e=r,i=e.getContext(\\\"2d\\\");e.width=t.width+160,e.height=t.height+160;const d=i.createLinearGradient(0,0,e.width,e.height);d.addColorStop(0,\\\"#aee3ff\\\"),d.addColorStop(1,\\\"#cefdb6\\\"),i.fillStyle=d,i.fillRect(0,0,e.width,e.height);const o=(e.width-t.width)/2,a=(e.height-t.height)/2;i.beginPath();const h=20;i.moveTo(o+h,a),i.lineTo(o+t.width-h,a),i.arcTo(o+t.width,a,o+t.width,a+h,h),i.lineTo(o+t.width,a+t.height-h),i.arcTo(o+t.width,a+t.height,o+t.width-h,a+t.height,h),i.lineTo(o+h,a+t.height),i.arcTo(o,a+t.height,o,a+t.height-h,h),i.lineTo(o,a+h),i.arcTo(o,a,o+h,a,h),i.closePath(),i.clip(),i.drawImage(t,o,a),r.classList.remove(\\\"hidden\\\"),s.classList.remove(\\\"hidden\\\")},t.src=e.target.result},t.readAsDataURL(e)}};d&&(h(d),o.classList.add(\\\"hidden\\\")),o.addEventListener(\\\"dragover\\\",(e=>{e.preventDefault(),o.classList.add(\\\"border-blue-500\\\")})),o.addEventListener(\\\"dragleave\\\",(()=>{o.classList.remove(\\\"border-blue-500\\\")})),o.addEventListener(\\\"drop\\\",(e=>{e.preventDefault(),o.classList.remove(\\\"border-blue-500\\\");const t=e.dataTransfer.files[0];t&&t.type.startsWith(\\\"image/\\\")&&h(t)})),o.addEventListener(\\\"click\\\",(()=>{const e=i(\\\"input\\\",{attributes:{type:\\\"file\\\",accept:\\\"image/*\\\",style:\\\"display: none\\\"}});e.addEventListener(\\\"change\\\",(e=>{e.target.files[0]&&h(e.target.files[0])})),e.click()})),s.addEventListener(\\\"click\\\",(()=>{r.toBlob((e=>{const t=new ClipboardItem({\\\"image/png\\\":e});navigator.clipboard.write([t]).then((()=>{alert(\\\"图片已复制到剪贴板！\\\")})).catch((e=>{console.error(\\\"复制失败:\\\",e);const t=document.createElement(\\\"a\\\");t.download=\\\"image-card.png\\\",t.href=r.toDataURL(\\\"image/png\\\"),t.click()}))}),\\\"image/png\\\",1)})),e.insertBefore(a,t),this.domNodes.push(a)}};\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}