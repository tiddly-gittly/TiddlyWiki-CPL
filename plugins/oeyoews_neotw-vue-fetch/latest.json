{"title":"$:/plugins/oeyoews/neotw-vue-fetch","description":"neotw-vue-fetch","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"neotw-vue-fetch","meat#disabled":"yes","qrcode":"yes","created":"2024-03-10","dependents":"$:/plugins/oeyoews/neotw-vue3","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-vue-fetch/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-vue-fetch/readme\",\"text\":\"<!-- plugin template readme -->\\n\\n## Motivation\\n\\n<!-- your plugin motivation, or why you write this plugin -->\\n\",\"type\":\"text/markdown\",\"description\":\"neotw-vue-fetch\"},\"$:/plugins/oeyoews/neotw-vue-fetch/component.js\":{\"title\":\"$:/plugins/oeyoews/neotw-vue-fetch/component.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-vue-fetch/component.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\n\\nconst { watch, toRaw, computed, ref } = window.Vue;\\n\\nconst getTemplate = (file) => {\\n  let template = $tw.wiki.getTiddlerText(file).trim();\\n\\n  if (template.startsWith('<template>') && template.endsWith('</template>')) {\\n    template = template.slice(10, -11);\\n  }\\n\\n  return template;\\n};\\n\\n/**\\n * Creates a Vue component that fetches data from the specified URL and renders it.\\n *\\n * @param {string} url - The URL to fetch data from.\\n * @return {Object} The Vue component object.\\n */\\nconst app = (url) => {\\n  const component = {\\n    setup() {\\n      // 加载中 ...\\n      const text = ref('');\\n\\n      return {\\n        text,\\n      };\\n    },\\n\\n    async mounted() {\\n      this.text = await this.getText();\\n    },\\n\\n    methods: {\\n      renderText(text) {\\n        return $tw.wiki.renderText('text/html', 'text/markdown', text);\\n      },\\n      async getText() {\\n        try {\\n          const res = await fetch(url);\\n          const data = await res.text();\\n          return this.renderText(data);\\n        } catch (e) {\\n          this.text = `${url} 加载出错`;\\n          console.error(e.message);\\n        }\\n      },\\n    },\\n\\n    template: getTemplate('$:/plugins/oeyoews/neotw-vue-fetch/widget.vue'),\\n  };\\n  return component;\\n};\\n\\nmodule.exports = app;\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-vue-fetch/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-vue-fetch/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-vue-fetch/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-vue-fetch widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass VueFetchWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const defaulturl =\\n      'https://raw.githubusercontent.com/oeyoews/neotw/main/README.md';\\n\\n    const { url = defaulturl } = this.attributes;\\n\\n    const vuelib = '$:/plugins/oeyoews/neotw-vue3/vue.global.prod.js';\\n\\n    if (!window.Vue) {\\n      window.Vue = require(vuelib);\\n    }\\n\\n    const { createApp } = window.Vue;\\n    const component = require('./component');\\n    const domNode = this.document.createElement('div');\\n\\n    try {\\n      const app = createApp(component(url));\\n\\n      app.config.errorHandler = (err) => {\\n        const text = `[Vue3](${app.version}): ` + err;\\n        console.error(text);\\n        domNode.textContent = text;\\n        domNode.style.color = 'red';\\n      };\\n\\n      // 挂载\\n      app.mount(domNode);\\n\\n      parent.insertBefore(domNode, nextSibling);\\n      this.domNodes.push(domNode);\\n    } catch (e) {\\n      console.error(e.message);\\n    }\\n  }\\n}\\n\\n/** @description neotw-vue-fetch widget */\\nexports['neotw-vue-fetch'] = VueFetchWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-vue-fetch/widget.vue\":{\"title\":\"$:/plugins/oeyoews/neotw-vue-fetch/widget.vue\",\"text\":\"<template>\\n  <div class=\\\"gap-4 flex flex-col\\\" v-if=\\\"!text\\\">\\n    <div class=\\\"bg-gray-200 h-12 rounded animate-pulse\\\"></div>\\n    <div class=\\\"bg-gray-200 h-8 w-2/3 rounded animate-pulse\\\"></div>\\n    <div class=\\\"bg-gray-200 h-6 w-3/4 rounded animate-pulse\\\"></div>\\n  </div>\\n  <div v-else v-html=\\\"text\\\"></div>\\n</template>\\n\",\"type\":\".vue\"}}}"}