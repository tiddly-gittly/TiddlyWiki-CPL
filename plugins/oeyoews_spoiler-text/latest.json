{"title":"$:/plugins/oeyoews/spoiler-text","description":"spoiler-text","author":"oeyoews","version":"0.0.6","core-version":">=5.3.4","type":"application/json","plugin-type":"plugin","name":"spoiler-text","meat#disabled":"yes","qrcode":"yes","created":"2025/01/30","stability":"STABILITY_2_STABLE","list":"readme","dependents":"","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/spoiler-text/readme\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/readme\",\"description\":\"spoiler-text\",\"text\":\"[[在线文档|https://tiddlywiki-starter-kit.oeyoews.top/docs/plugins/spoiler-text]]\\n\\n!! Widget Usage\\n\\nThis is a <$s-t text=\\\"Spoiler Text Plugin\\\" />\\n\\n```html\\nThis is a <$s-t text=\\\"Spoiler Text Plugin\\\" />\\nThis is a <$spoiler-text text=\\\"Spoiler Text Plugin\\\" />\\n```\\n\\n!! Web Component Usage\\n\\nThis is a <s-t text=\\\"Spoiler Text Plugin(web Component)\\\" />\\n\\n```html\\nThis is a <s-t text=\\\"Spoiler Text Plugin(web Component)\\\" />\\nThis is a <s-t >Spoiler Text Plugin(web Component)\\\" </s-t>\\nThis is a <spoiler-text >Spoiler Text Plugin(web Component)\\\" </spoiler-text>\\n```\\n\\n!! wikitext parser\\n\\n```html\\n<*Spoiler Text Example*>\\n```\\n\\n!! use transclude(beta)\\n\\n> need doucle click insteadof click\\n\\n```html\\n<$s-t tiddler={{your tiddler}} />\\n```\"},\"$:/core/ui/EditorToolbar/spoiler\":{\"title\":\"$:/core/ui/EditorToolbar/spoiler\",\"tags\":\"$:/tags/EditorToolbar\",\"description\":\"{{$:/plugins/oeyoews/spoiler-text/readme!!description}}\",\"caption\":\"Spoiler\",\"condition\":\"[<targetTiddler>!has[type]] [<targetTiddler>type[text/vnd.tiddlywiki]] [<targetTiddler>type[text/markdown]]\",\"icon\":\"$:/plugins/oeyoews/spoiler-text/icon\",\"list-before\":\"$:/core/ui/EditorToolbar/mono-block\",\"shortcuts\":\"((spoiler))\",\"text\":\"<$action-sendmessage\\n\\t$message=\\\"tm-edit-text-operation\\\"\\n\\t$param=\\\"wrap-selection\\\"\\n\\tprefix=\\\"<s-t>\\\"\\n\\tsuffix=\\\"</s-t>\\\"\\n/>\\n\"},\"$:/plugins/oeyoews/spoiler-text/SpoilerText.js\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/SpoilerText.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/spoiler-text/SpoilerText.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nclass SpoilerText extends HTMLElement {\\n  constructor() {\\n    super();\\n    /** @type {'click' | 'dblclick'} */\\n    this.listenerType = 'click';\\n  }\\n  addEventListeners() {\\n    this.wrapper.classList.toggle('revealed');\\n  }\\n  // https://talk.tiddlywiki.org/t/web-component-cannot-get-textcontent/11756/3\\n  // https://developer.mozilla.org/zh-CN/docs/Web/API/Web_components/Using_custom_elements\\n  connectedCallback() {\\n    this.attachShadow({ mode: 'open' });\\n\\n    const style = document.createElement('style');\\n    style.textContent = `.spoiler{display:inline-block;filter:blur(0.5em);transition: filter 0.1s ease;user-select:none;cursor:pointer;}.spoiler:hover{filter:blur(0.18em);}.spoiler.revealed{filter:blur(0); user-select:auto;cursor:auto;}`;\\n\\n    this.wrapper = document.createElement('span');\\n    this.wrapper.classList.add('spoiler');\\n    this.shadowRoot.append(style, this.wrapper);\\n    const text =\\n      this.getAttribute('text')?.length > 0 &&\\n      !['true', 'false'].includes(this.getAttribute('text'))\\n        ? this.getAttribute('text')\\n        : `<slot></slot>`;\\n    if (this.getAttribute('tiddler')) {\\n      this.wrapper.innerHTML = $tw.wiki.renderTiddler(\\n        'text/html',\\n        this.getAttribute('tiddler'),\\n        {\\n          parseAsInline: true,\\n        },\\n      );\\n      this.listenerType = 'dblclick';\\n    } else {\\n      this.wrapper.innerHTML = text;\\n    }\\n    this.wrapper.addEventListener(this.listenerType, () => {\\n      this.addEventListeners();\\n    });\\n  }\\n  disconnectedCallback() {\\n    this.wrapper.removeEventListener(this.listenerType, () => {\\n      this.addEventListeners();\\n    });\\n  }\\n}\\nclass ST extends SpoilerText {}\\n\\nmodule.exports = { SpoilerText, ST };\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/spoiler-text/icon\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/icon\",\"text\":\"<svg width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n  <path d=\\\"M1 12C1 12 5 5 12 5C19 5 23 12 23 12C23 12 19 19 12 19C5 19 1 12 1 12Z\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n  <line x1=\\\"4\\\" y1=\\\"4\\\" x2=\\\"20\\\" y2=\\\"20\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n</svg>\\n\"},\"$:/snippets/oeyoews/spoiler-text/st\":{\"title\":\"$:/snippets/oeyoews/spoiler-text/st\",\"description\":\"Spoiler Text\",\"text\":\"<s-t>${1}</s-t>\"},\"$:/plugins/oeyoews/spoiler-text/rules/SpoilerText.js\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/rules/SpoilerText.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/spoiler-text/rules/SpoilerText.js\\ntype: application/javascript\\nmodule-type: wikirule\\n\\n|*spoiler text*|\\n\\nbased on https://github.com/TiddlyWiki/TiddlyWiki5/blob/master/core/modules/parsers/wikiparser/rules/prettylink.js\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  exports.name = 'spoiler';\\n  exports.types = { inline: true };\\n\\n  exports.init = function (parser) {\\n    this.parser = parser;\\n    // Regexp to match\\n    this.matchRegExp = /\\\\<\\\\*(.*?)\\\\*\\\\>/gm;\\n  };\\n\\n  exports.parse = function () {\\n    // Move past the match\\n    var start = this.parser.pos + 2;\\n    this.parser.pos = this.matchRegExp.lastIndex;\\n    // Process the link\\n    var text = this.match[1],\\n      link = this.match[2] || text,\\n      textEndPos = this.parser.source.indexOf('<', start);\\n    if (textEndPos < 0 || textEndPos > this.matchRegExp.lastIndex) {\\n      textEndPos = this.matchRegExp.lastIndex - 2;\\n    }\\n    var linkStart = this.match[2] ? start + this.match[1].length + 1 : start;\\n    var linkEnd = linkStart + link.length;\\n    return [\\n      {\\n        type: 'element',\\n        tag: 's-t',\\n        children: [\\n          {\\n            type: 'text',\\n            text,\\n            start: linkStart,\\n            end: linkEnd,\\n          },\\n        ],\\n      },\\n    ];\\n  };\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"wikirule\"},\"$:/plugins/oeyoews/spoiler-text/startup.js\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/startup.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/spoiler-text/startup.js\\ntype: application/javascript\\nmodule-type: startup\\n\\n\\\\*/\\n\\nexports.platforms = ['browser'];\\nexports.synchronous = true;\\nexports.startup = function () {\\n  const { SpoilerText, ST } = require('./SpoilerText');\\n  const components = { 'spoiler-text': SpoilerText, 's-t': ST };\\n  Object.keys(components).forEach((key) =>\\n    customElements.define(key, components[key]),\\n  );\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/oeyoews/spoiler-text/style.css\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/style.css\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\",\"text\":\".spoiler{display:inline-block;filter:blur(0.5em);transition: filter 0.1s ease;user-select:none;cursor:pointer;}.spoiler:hover{filter:blur(0.18em);}.spoiler.revealed{filter:blur(0); user-select:auto;cursor:auto;}\"},\"$:/plugins/oeyoews/spoiler-text/widget.js\":{\"title\":\"$:/plugins/oeyoews/spoiler-text/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/spoiler-text/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nspoiler-text widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass SpoilerText extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n    /** @type {'click' | 'dblclick'} */\\n    let listenerType = 'click';\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const createElement = $tw.utils.domMaker;\\n\\n    const domNode = createElement('span');\\n    if (this.hasAttribute('tiddler')) {\\n      listenerType = 'dblclick';\\n      domNode.innerHTML = $tw.wiki.renderTiddler(\\n        'text/html',\\n        this.getAttribute('tiddler'),\\n        {\\n          parseAsInline: true,\\n        },\\n      );\\n    } else {\\n      domNode.innerHTML = this.getAttribute('text');\\n    }\\n    domNode.classList.add('spoiler');\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n\\n    domNode.addEventListener(listenerType, () => {\\n      domNode.classList.toggle('revealed');\\n    });\\n  }\\n}\\n\\n/** @description spoiler-text widget */\\nexports['spoiler-text'] = SpoilerText;\\nexports['s-t'] = SpoilerText;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}