{"title":"$:/plugins/oeyoews/vue-zhipu","description":"vue-zhipu","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"vue-zhipu","meat#disabled":"yes","qrcode":"yes","created":"2024-03-31","dependents":"$:/plugins/oeyoews/neotw-vue3 $:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/vue-zhipu/templates/app.vue\":{\"text\":\"<template>\\n  <div class=\\\"p-2 rounded\\\">\\n    <div class=\\\"flex items-center justify-end mb-2\\\">\\n      <el-button @click=\\\"goHome\\\">返回主页</el-button>\\n    </div>\\n    <el-collapse v-model=\\\"activeName\\\" accordion>\\n      <el-collapse-item title=\\\"智谱 API\\\" name=\\\"1\\\">\\n        <input type=\\\"password\\\" v-model=\\\"api_key\\\"\\n          placeholder=\\\"API key，如: 1e9a8196d7e93079828c7f3e3c222db0.1xviOIMegcccW71i\\\" class=\\\"w-full\\\">\\n        <br>\\n        <span class=\\\"text-muted text-small mt-2\\\">\\n          tip: 从这里查看和创建 API key：\\n          <a href=\\\"https://open.bigmodel.cn/usercenter/apikeys\\\" target=\\\"_blank\\\">\\n            https://open.bigmodel.cn/usercenter/apikeys\\n          </a>\\n        </span>\\n      </el-collapse-item>\\n    </el-collapse>\\n\\n    <!-- step-02 post_body -->\\n    <div class=\\\"mb-5 hidden\\\">\\n      <p>\\n        <textarea v-model=\\\"post_body\\\" class=\\\"w-full h-48\\\"></textarea>\\n        <span class=\\\"text-muted text-small\\\">\\n          提示: 参数 \\\"stream\\\" 设为 true，则按流数据返回。设为 false，就是普通的 post 请求，普通读取其返回值就可以。\\n        </span>\\n      </p>\\n    </div>\\n\\n    <!-- step-03 发送请求 -->\\n    <div class=\\\"my-5\\\">\\n      <form @submit.prevent=\\\"btnClicked\\\" class=\\\"flex gap-2\\\">\\n        <el-input type=\\\"text\\\" v-model=\\\"prompt\\\" class=\\\"w-full\\\" ref=\\\"chatRef\\\" placeholder=\\\"输入内容\\\" />\\n        <el-button native-type=\\\"submit\\\" class=\\\"shrink-0\\\">发送</el-button>\\n      </form>\\n      <!-- <div class=\\\"font-bold\\\">智谱 AI: </div> -->\\n      <div v-html=\\\"the_last_message_html\\\"\\n        class=\\\"mt-8 rounded border-dimmed-700 p-2 antialiased prose prose-gray max-w-none prose-img:my-0 prose-a:no-underline prose-h2:mt-4 prose-blockquote:not-italic dark:prose-invert dark:prose-pre:bg-[#282c34] dark:prose-pre:text-white prose-p:mt-0\\\">\\n      </div>\\n      <!-- <div>\\n        <el-button @click=\\\"copyToClipboard\\\" class=\\\"shrink-0\\\">copy</el-button>\\n      </div> -->\\n    </div>\\n  </div>\\n\\n</template>\",\"title\":\"$:/plugins/oeyoews/vue-zhipu/templates/app.vue\",\"hide-body\":\"yes\"},\"$:/plugins/oeyoews/vue-zhipu/plugins/TiddlyWikiVue.js\":{\"text\":\"module.exports={install(t,o){t.component(\\\"TiddlyWikiVue\\\",{template:\\\"<button> {{ msg }} </button>\\\",props:{msg:String}})}};\",\"title\":\"$:/plugins/oeyoews/vue-zhipu/plugins/TiddlyWikiVue.js\",\"module-type\":\"library\",\"type\":\"application/javascript\"},\"$:/plugins/oeyoews/vue-zhipu/components/Version.js\":{\"text\":\"module.exports={name:\\\"Version\\\",props:{version:{type:String,default:\\\"5.3.2\\\"}},template:\\\"<span> {{ version }} </span>\\\"};\",\"title\":\"$:/plugins/oeyoews/vue-zhipu/components/Version.js\",\"module-type\":\"library\",\"type\":\"application/javascript\"},\"$:/plugins/oeyoews/vue-zhipu/readme\":{\"title\":\"$:/plugins/oeyoews/vue-zhipu/readme\",\"description\":\"vue-zhipu\",\"text\":\"[[在线文档|https://neotw.vercel.app/docs/plugins/vue-zhipu]]\"},\"$:/plugins/oeyoews/vue-zhipu/layout\":{\"title\":\"$:/plugins/oeyoews/vue-zhipu/layout\",\"name\":\"zhipu ai\",\"description\":\"zhipu ai\",\"tags\":\"$:/tags/Layout\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo m-auto sm:w-auto md:w-2/3\\\">\\n<$vue-zhipu />\\n</div>\"},\"$:/plugins/oeyoews/vue-zhipu/app.js\":{\"title\":\"$:/plugins/oeyoews/vue-zhipu/app.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/vue-zhipu/app.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nconst{watch:e,computed:t,ref:n}=window.Vue,o=require(\\\"$:/plugins/oeyoews/neotw-vue3/getTemplate.js\\\");crypto.subtle||alert('file:// or unsafe http:// is not allowed to use \\\"crypto.subtle\\\" functions,\\\\n\\\\n        you could run this file by Vite3 within the public dir.\\\\n\\\\n        file:// 或 不安全的 http:// 无法支持 \\\"crypto.subtle\\\" 方法运行，\\\\n\\\\n        把这个文件放到 Vite3 项目的 public 目录中可以运行。\\\\n      ');const a=localStorage.getItem(\\\"ZHIPU_APIKEY\\\")||\\\"\\\";module.exports=()=>({setup(){const o=n(\\\"\\\"),s=n(a),l=n(\\\"\\\"),i=n(\\\"\\\"),r=n(!1),u=t((()=>JSON.stringify({model:\\\"glm-3-turbo\\\",stream:\\\"true\\\",messages:[{role:\\\"user\\\",content:l.value}]},null,2)));e(s,(e=>{localStorage.setItem(\\\"ZHIPU_APIKEY\\\",e)}));const c=function(e){if(e.endsWith(\\\"[DONE]\\\"))return;let t=JSON.parse(e.replace(/^data: /,\\\"\\\").replace(\\\"\\\\n\\\\n$\\\",\\\"\\\"));const n=(t.choices||[{}])[0]?.delta?.content||\\\"\\\";o.value+=n},p=t((()=>$tw.wiki.renderText(\\\"text/html\\\",\\\"text/markdown\\\",o.value,{parseAsInline:!0})));return{isChat:r,copyToClipboard:()=>$tw.utils.copyToClipboard(o.value),the_last_message:o,the_last_message_html:p,api_key:s,chatRef:i,post_body:u,prompt:l,btnClicked:async()=>{if(\\\"\\\"===s.value)return void alert(\\\"please set api_key.\\\\n填写api_key\\\");o.value=\\\"\\\";let[e,t]=s.value.split(\\\".\\\"),n=(new Date).valueOf(),a=await async function(e,t,n){const o={alg:\\\"HS256\\\",sign_type:\\\"SIGN\\\"},a=btoa(JSON.stringify(o)),s=btoa(JSON.stringify(t));if(!e)return;const l=await crypto.subtle.importKey(\\\"raw\\\",(new TextEncoder).encode(e),{name:\\\"HMAC\\\",hash:{name:\\\"SHA-256\\\"}},!1,[\\\"sign\\\"]),i=await crypto.subtle.sign(\\\"HMAC\\\",l,(new TextEncoder).encode(a+\\\".\\\"+s));return a+\\\".\\\"+s+\\\".\\\"+btoa(String.fromCharCode.apply(null,new Uint8Array(i)))}(t,{api_key:e,timestamp:n,exp:new Date(n+36e5).valueOf()});(async(e,t,n)=>{const o=(await fetch(\\\"https://open.bigmodel.cn/api/paas/v4/chat/completions\\\",{method:\\\"post\\\",headers:e,body:\\\"object\\\"==typeof t?JSON.stringify(t,null,2):t})).body.getReader();let a=\\\"\\\";const s=async e=>{const t=await e.read();if(t.done)return r.value=!1,l.value=\\\"\\\",void i.value.focus();{a+=new TextDecoder(\\\"utf-8\\\").decode(t.value);const o=a.split(\\\"\\\\n\\\\n\\\");a=o.pop();for(let e in o){const t=o[e];n&&n(t)}return s(e)}};s(o)})({Authorization:a,\\\"content-type\\\":\\\"application/json\\\"},JSON.parse(u.value),c),r.value=!0}}},mounted(){this.chatRef.focus()},methods:{goHome(){$tw.wiki.setText(\\\"$:/layout\\\",\\\"text\\\",null,\\\"$:/core/ui/PageTemplate\\\")}},template:o(\\\"$:/plugins/oeyoews/vue-zhipu/templates/app.vue\\\")});\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/vue-zhipu/widget.js\":{\"title\":\"$:/plugins/oeyoews/vue-zhipu/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/vue-zhipu/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nvue-zhipu widget\\n\\n\\\\*/\\nconst{widget:e}=require(\\\"$:/core/modules/widgets/widget.js\\\");exports[\\\"vue-zhipu\\\"]=class extends e{constructor(e,r){super(e,r)}render(e,r){if(!$tw.browser)return;if(this.computeAttributes(),this.execute(),this.document.isTiddlyWikiFakeDom)return;window.Vue||(window.Vue=require(\\\"$:/plugins/oeyoews/neotw-vue3/vue.global.prod.js\\\"));const{createApp:t}=window.Vue,s=require(\\\"./app\\\"),o=this.document.createElement(\\\"div\\\"),i=require(\\\"./plugins/TiddlyWikiVue\\\"),u=require(\\\"element-plus.min.js\\\");try{const n=t(s());n.use(i),n.use(u),n.config.errorHandler=e=>{const r=`[Vue3](${n.version}): `+e;console.error(r),o.textContent=r,o.style.color=\\\"red\\\"},n.mount(o),e.insertBefore(o,r),this.domNodes.push(o)}catch(e){console.error(e.message)}}refresh(){return!1}};\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}