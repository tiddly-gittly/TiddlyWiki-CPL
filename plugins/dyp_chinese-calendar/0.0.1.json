{"title":"$:/plugins/dyp/chinese-calendar","version":"0.0.1","stability":"STABILITY_2_STABLE","name":"chinese-calendar","description":"中文日历","author":"dyp","source":"https://github.com/dyp1121054136/dyp-plugins-library","list":"readme usage history","plugin-priority":"","parent-plugin":"","dependents":"","plugin-type":"plugin","core-version":"5.3.7-prerelease","packaged-by":"Gatha on 6th 六月 2025, 17:25:09","type":"application/json","text":"{\"tiddlers\":{\"$:/core/images/calendar-annotation\":{\"title\":\"$:/core/images/calendar-annotation\",\"code-body\":\"yes\",\"created\":\"20250606070331584\",\"modified\":\"20250606080913289\",\"tags\":\"中文日历 图标\",\"type\":\"image/svg+xml\",\"text\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"bi bi-bookmarks\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M2 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L7 13.101l-4.223 2.815A.5.5 0 0 1 2 15.5V4zm2-1a1 1 0 0 0-1 1v10.566l3.723-2.482a.5.5 0 0 1 .554 0L11 14.566V4a1 1 0 0 0-1-1H4z\\\"/>\\n  <path d=\\\"M4.268 1H12a1 1 0 0 1 1 1v11.768l.223.148A.5.5 0 0 0 14 13.5V2a2 2 0 0 0-2-2H6a2 2 0 0 0-1.732 1z\\\"/>\\n</svg>\"},\"$:/core/modules/widgets/chinese-calendar.js\":{\"title\":\"$:/core/modules/widgets/chinese-calendar.js\",\"created\":\"20250606062947638\",\"modified\":\"20250606104943901\",\"module-type\":\"widget\",\"tags\":\"中文日历\",\"type\":\"application/javascript\",\"text\":\"/*\\\\  \\ntitle: $:/core/modules/widgets/chinese-calendar.js  \\ntype: application/javascript  \\nmodule-type: widget  \\n  \\n中文日历widget - 主要渲染逻辑  \\n\\\\*/  \\n  \\n\\\"use strict\\\";  \\n  \\nvar Widget = require(\\\"$:/core/modules/widgets/widget.js\\\").widget;  \\nvar CalendarCell = require(\\\"$:/core/modules/widgets/chinese-calendar/calendar-cell.js\\\");  \\nvar CalendarData = require(\\\"$:/core/modules/widgets/chinese-calendar/calendar-data.js\\\");  \\n  \\nvar ChineseCalendarWidget = function(parseTreeNode,options) {  \\n    this.initialise(parseTreeNode,options);  \\n};  \\n  \\nChineseCalendarWidget.prototype = new Widget();  \\n  \\nChineseCalendarWidget.prototype.render = function(parent,nextSibling) {  \\n    this.parentDomNode = parent;  \\n    this.computeAttributes();  \\n    this.execute();  \\n      \\n    var calendarNode = this.document.createElement(\\\"div\\\");  \\n    calendarNode.setAttribute(\\\"class\\\", \\\"tc-chinese-calendar\\\");  \\n      \\n    this.generateCalendar(calendarNode);  \\n      \\n    parent.insertBefore(calendarNode,nextSibling);  \\n    this.domNodes.push(calendarNode);  \\n};  \\n  \\nChineseCalendarWidget.prototype.execute = function() {  \\n    this.year = parseInt(this.getAttribute(\\\"year\\\", new Date().getFullYear().toString()));  \\n    this.month = parseInt(this.getAttribute(\\\"month\\\", (new Date().getMonth() + 1).toString()));  \\n    this.showLunar = this.getAttribute(\\\"lunar\\\", \\\"yes\\\") === \\\"yes\\\";  \\n    this.showHolidays = this.getAttribute(\\\"holidays\\\", \\\"yes\\\") === \\\"yes\\\";  \\n    this.mondayFirst = this.getAttribute(\\\"monday-first\\\", \\\"no\\\") === \\\"yes\\\";  \\n    this.highlightToday = this.getAttribute(\\\"highlight-today\\\", \\\"yes\\\") === \\\"yes\\\";  \\n    this.annotationFilter = this.getAttribute(\\\"annotation-filter\\\", \\\"\\\");  \\n      \\n    var today = new Date();  \\n    this.todayYear = today.getFullYear();  \\n    this.todayMonth = today.getMonth() + 1;  \\n    this.todayDate = today.getDate();  \\n      \\n    // 初始化辅助模块  \\n    this.cellHelper = new CalendarCell(this);  \\n    this.dataHelper = new CalendarData(this);  \\n};  \\n  \\nChineseCalendarWidget.prototype.generateCalendar = function(container) {  \\n    var monthNames = [\\\"一月\\\", \\\"二月\\\", \\\"三月\\\", \\\"四月\\\", \\\"五月\\\", \\\"六月\\\",   \\n                     \\\"七月\\\", \\\"八月\\\", \\\"九月\\\", \\\"十月\\\", \\\"十一月\\\", \\\"十二月\\\"];  \\n      \\n    var dayNames = this.mondayFirst ?   \\n        [\\\"一\\\", \\\"二\\\", \\\"三\\\", \\\"四\\\", \\\"五\\\", \\\"六\\\", \\\"日\\\"] :   \\n        [\\\"日\\\", \\\"一\\\", \\\"二\\\", \\\"三\\\", \\\"四\\\", \\\"五\\\", \\\"六\\\"];  \\n      \\n    // 创建标题  \\n    var title = this.document.createElement(\\\"h3\\\");  \\n    title.setAttribute(\\\"class\\\", \\\"tc-calendar-title\\\");  \\n    title.appendChild(this.document.createTextNode(this.year + \\\"年\\\" + monthNames[this.month - 1]));  \\n    container.appendChild(title);  \\n      \\n    // 创建表格  \\n    var table = this.document.createElement(\\\"table\\\");  \\n    table.setAttribute(\\\"class\\\", \\\"tc-calendar-table\\\");  \\n      \\n    // 创建表头  \\n    var thead = this.document.createElement(\\\"thead\\\");  \\n    var headerRow = this.document.createElement(\\\"tr\\\");  \\n    dayNames.forEach(function(dayName) {  \\n        var th = this.document.createElement(\\\"th\\\");  \\n        th.appendChild(this.document.createTextNode(dayName));  \\n        headerRow.appendChild(th);  \\n    }, this);  \\n    thead.appendChild(headerRow);  \\n    table.appendChild(thead);  \\n      \\n    // 创建表体  \\n    this.generateCalendarBody(table);  \\n      \\n    container.appendChild(table);  \\n};  \\n  \\nChineseCalendarWidget.prototype.generateCalendarBody = function(table) {  \\n    var tbody = this.document.createElement(\\\"tbody\\\");  \\n    var firstDay = new Date(this.year, this.month - 1, 1).getDay();  \\n      \\n    if(this.mondayFirst) {  \\n        firstDay = (firstDay === 0) ? 6 : firstDay - 1;  \\n    }  \\n      \\n    var daysInMonth = new Date(this.year, this.month, 0).getDate();  \\n    var date = 1;  \\n      \\n    for(var week = 0; week < 6; week++) {  \\n        var row = this.document.createElement(\\\"tr\\\");  \\n        for(var day = 0; day < 7; day++) {  \\n            var cell = this.document.createElement(\\\"td\\\");  \\n            if(week === 0 && day < firstDay || date > daysInMonth) {  \\n                cell.setAttribute(\\\"class\\\", \\\"tc-calendar-empty\\\");  \\n            } else {  \\n                this.cellHelper.createDateCell(cell, date);  \\n                date++;  \\n            }  \\n            row.appendChild(cell);  \\n        }  \\n        tbody.appendChild(row);  \\n        if(date > daysInMonth) break;  \\n    }  \\n      \\n    table.appendChild(tbody);  \\n};  \\n  \\nChineseCalendarWidget.prototype.refresh = function(changedTiddlers) {  \\n    var changedAttributes = this.computeAttributes();  \\n    if(changedAttributes.year || changedAttributes.month ||   \\n       changedAttributes.lunar || changedAttributes.holidays ||  \\n       changedAttributes[\\\"monday-first\\\"] || changedAttributes[\\\"highlight-today\\\"] ||  \\n       changedAttributes[\\\"annotation-filter\\\"]) {  \\n        this.refreshSelf();  \\n        return true;  \\n    } else {  \\n        return false;  \\n    }  \\n};  \\n  \\nexports[\\\"chinese-calendar\\\"] = ChineseCalendarWidget;\"},\"$:/core/modules/widgets/chinese-calendar/calendar-annotations.js\":{\"title\":\"$:/core/modules/widgets/chinese-calendar/calendar-annotations.js\",\"created\":\"20250606104318418\",\"modified\":\"20250606104854979\",\"module-type\":\"library\",\"tags\":\"中文日历\",\"type\":\"application/javascript\",\"text\":\"/*\\\\  \\ntitle: $:/core/modules/widgets/chinese-calendar/calendar-annotations.js  \\ntype: application/javascript  \\nmodule-type: library  \\n  \\n中文日历 - 批注处理模块  \\n\\\\*/  \\n  \\n\\\"use strict\\\";  \\n  \\nvar CalendarAnnotations = function(widget) {  \\n    this.widget = widget;  \\n};  \\n  \\nCalendarAnnotations.prototype.handleAnnotations = function(cell, currentDate, cellClasses) {  \\n    if(!this.widget.annotationFilter) return;  \\n      \\n    var annotations = this.getAnnotations(currentDate);  \\n    if(annotations && annotations.length > 0) {  \\n        if(annotations.length === 1) {  \\n            this.addSingleAnnotation(cell, annotations[0]);  \\n        } else {  \\n            this.addMultipleAnnotations(cell, annotations);  \\n        }  \\n        cellClasses.push(\\\"tc-calendar-annotated\\\");  \\n    }  \\n};  \\n  \\nCalendarAnnotations.prototype.getAnnotations = function(date) {  \\n    var dateKey = this.widget.year + \\\"-\\\" +   \\n                  String(this.widget.month).padStart(2, '0') + \\\"-\\\" +   \\n                  String(date.getDate()).padStart(2, '0');  \\n      \\n    // 调试日志（可选，用于排查问题）  \\n    // console.log(\\\"查找批注，日期键:\\\", dateKey);  \\n    // console.log(\\\"筛选器:\\\", this.widget.annotationFilter.replace(\\\"{{date}}\\\", dateKey));  \\n      \\n    var annotationTiddlers = this.widget.wiki.filterTiddlers(  \\n        this.widget.annotationFilter.replace(\\\"{{date}}\\\", dateKey), this.widget);  \\n      \\n    // console.log(\\\"找到的批注条目:\\\", annotationTiddlers);  \\n      \\n    if(annotationTiddlers.length > 0) {  \\n        var self = this;  \\n        return annotationTiddlers.map(function(title) {  \\n            var tiddler = self.widget.wiki.getTiddler(title);  \\n            return {  \\n                text: tiddler.fields.text || \\\"\\\",  \\n                color: tiddler.fields[\\\"annotation-color\\\"] || \\\"default\\\",  \\n                tiddlerTitle: title  \\n            };  \\n        });  \\n    }  \\n    return null;  \\n};  \\n  \\nCalendarAnnotations.prototype.addSingleAnnotation = function(cell, annotation) {  \\n    this.createAnnotationButton(cell, annotation, annotation.tiddlerTitle);  \\n};  \\n  \\nCalendarAnnotations.prototype.addMultipleAnnotations = function(cell, annotations) {  \\n    // 直接创建多批注按钮，简化逻辑  \\n    this.createMultiAnnotationButton(cell, annotations);  \\n};  \\n  \\nCalendarAnnotations.prototype.createAnnotationButton = function(cell, annotation, targetTitle) {  \\n    var self = this;  \\n    var svgButton = this.widget.document.createElement(\\\"div\\\");  \\n    svgButton.setAttribute(\\\"class\\\", \\\"tc-calendar-annotation-button\\\");  \\n      \\n    if(annotation.color && annotation.color !== \\\"default\\\") {  \\n        svgButton.classList.add(\\\"tc-calendar-annotation-\\\" + annotation.color);  \\n    }  \\n      \\n    // 只使用条目中设置的图标，不提供硬编码默认值  \\n    var iconTiddler = this.widget.wiki.getTiddler(\\\"$:/core/images/calendar-annotation\\\");  \\n    if(iconTiddler && iconTiddler.fields.text) {  \\n        svgButton.innerHTML = iconTiddler.fields.text;  \\n    } else {  \\n        // 如果没有图标条目，使用简单的文本标记  \\n        svgButton.textContent = \\\"●\\\";  \\n        svgButton.style.fontSize = \\\"8px\\\";  \\n        svgButton.style.lineHeight = \\\"8px\\\";  \\n        svgButton.style.textAlign = \\\"center\\\";  \\n\\n// 根据批注颜色设置文本颜色  \\nif(annotation.color && annotation.color !== \\\"default\\\") {  \\n    // 使用CSS中定义的颜色映射  \\n    var colorMap = {  \\n        \\\"red\\\": \\\"#dc3545\\\",  \\n        \\\"blue\\\": \\\"#007bff\\\",   \\n        \\\"green\\\": \\\"#28a745\\\",  \\n        \\\"yellow\\\": \\\"#ffc107\\\",  \\n        \\\"orange\\\": \\\"#fd7e14\\\",  \\n        \\\"purple\\\": \\\"#6f42c1\\\"  \\n    };  \\n    svgButton.style.color = colorMap[annotation.color] || \\\"#5797d8\\\";  \\n} else {  \\n    svgButton.style.color = \\\"#5797d8\\\"; // 默认颜色  \\n}\\n    }  \\n      \\n    // 创建弹窗内容  \\n    var popupContent = this.widget.document.createElement(\\\"div\\\");  \\n    popupContent.setAttribute(\\\"class\\\", \\\"tc-calendar-annotation-popup\\\");  \\n    popupContent.style.display = \\\"none\\\";  \\n      \\n    var textLines = annotation.text.split('\\\\n');  \\n    for(var i = 0; i < textLines.length; i++) {  \\n        if(i > 0) {  \\n            popupContent.appendChild(this.widget.document.createElement(\\\"br\\\"));  \\n        }  \\n        popupContent.appendChild(this.widget.document.createTextNode(textLines[i]));  \\n    }  \\n      \\n    var isPopupVisible = false;  \\n      \\n    // 悬停显示功能  \\n    svgButton.addEventListener(\\\"mouseenter\\\", function() {  \\n        popupContent.style.display = \\\"block\\\";  \\n        isPopupVisible = true;  \\n    });  \\n      \\n    svgButton.addEventListener(\\\"mouseleave\\\", function() {  \\n        setTimeout(function() {  \\n            if(!popupContent.matches(':hover')) {  \\n                popupContent.style.display = \\\"none\\\";  \\n                isPopupVisible = false;  \\n            }  \\n        }, 100);  \\n    });  \\n  \\n    popupContent.addEventListener(\\\"mouseenter\\\", function() {  \\n        popupContent.style.display = \\\"block\\\";  \\n        isPopupVisible = true;  \\n    });  \\n      \\n    popupContent.addEventListener(\\\"mouseleave\\\", function() {  \\n        popupContent.style.display = \\\"none\\\";  \\n        isPopupVisible = false;  \\n    });  \\n      \\n    // 点击功能 - 跳转到批注条目  \\n    svgButton.addEventListener(\\\"click\\\", function(event) {  \\n        event.stopPropagation();  \\n          \\n        // 如果有批注条目标题，则导航到该条目  \\n        if(targetTitle) {  \\n            self.widget.dispatchEvent({  \\n                type: \\\"tm-navigate\\\",  \\n                navigateTo: targetTitle,  \\n                navigateFromTitle: self.widget.getVariable(\\\"currentTiddler\\\")  \\n            });  \\n        } else {  \\n            // 如果没有条目标题，则切换弹窗显示  \\n            if(isPopupVisible) {  \\n                popupContent.style.display = \\\"none\\\";  \\n                isPopupVisible = false;  \\n            } else {  \\n                popupContent.style.display = \\\"block\\\";  \\n                isPopupVisible = true;  \\n            }  \\n        }  \\n    });  \\n      \\n    cell.appendChild(svgButton);  \\n    cell.appendChild(popupContent);  \\n};  \\n  \\nCalendarAnnotations.prototype.createMultiAnnotationButton = function(cell, annotations) {  \\n    var self = this;  \\n    var svgButton = this.widget.document.createElement(\\\"div\\\");  \\n    svgButton.setAttribute(\\\"class\\\", \\\"tc-calendar-annotation-button tc-calendar-multi-annotation\\\");  \\n      \\n    // 使用第一个批注的颜色  \\n    if(annotations[0].color && annotations[0].color !== \\\"default\\\") {  \\n        svgButton.classList.add(\\\"tc-calendar-annotation-\\\" + annotations[0].color);  \\n    }  \\n      \\n    // 使用相同的图标处理逻辑  \\n    var iconTiddler = this.widget.wiki.getTiddler(\\\"$:/core/images/calendar-annotation\\\");  \\n    if(iconTiddler && iconTiddler.fields.text) {  \\n        svgButton.innerHTML = iconTiddler.fields.text;  \\n    } else {  \\n        svgButton.textContent = \\\"●\\\";  \\n        svgButton.style.fontSize = \\\"16px\\\";  \\n        svgButton.style.lineHeight = \\\"16px\\\";  \\n        svgButton.style.textAlign = \\\"center\\\";  \\n    }  \\n      \\n    // 设置相对定位以便添加徽章  \\n    svgButton.style.position = \\\"relative\\\";  \\n      \\n    // 添加多批注数量徽章  \\n    var countBadge = this.widget.document.createElement(\\\"span\\\");  \\n    countBadge.textContent = annotations.length.toString();  \\n    countBadge.style.cssText = \\\"position:absolute;top:-5px;right:-5px;background:#ff4444;color:white;border-radius:50%;width:12px;height:12px;font-size:8px;text-align:center;line-height:12px;font-weight:bold;\\\";  \\n    svgButton.appendChild(countBadge);  \\n      \\n    // 创建多批注选择菜单  \\n    var menuContent = this.widget.document.createElement(\\\"div\\\");  \\n    menuContent.setAttribute(\\\"class\\\", \\\"tc-calendar-annotation-menu\\\");  \\n    menuContent.style.display = \\\"none\\\";  \\n      \\n    annotations.forEach(function(annotation, index) {  \\n        var menuItem = self.widget.document.createElement(\\\"div\\\");  \\n        menuItem.setAttribute(\\\"class\\\", \\\"tc-calendar-annotation-menu-item\\\");  \\n          \\n        var preview = annotation.text.length > 20 ?   \\n                     annotation.text.substring(0, 20) + \\\"...\\\" :   \\n                     annotation.text;  \\n        menuItem.appendChild(self.widget.document.createTextNode(preview));  \\n          \\n        menuItem.addEventListener(\\\"click\\\", function(event) {  \\n            event.stopPropagation();  \\n            if(annotation.tiddlerTitle) {  \\n                self.widget.dispatchEvent({  \\n                    type: \\\"tm-navigate\\\",  \\n                    navigateTo: annotation.tiddlerTitle,  \\n                    navigateFromTitle: self.widget.getVariable(\\\"currentTiddler\\\")  \\n                });  \\n            }  \\n            menuContent.style.display = \\\"none\\\";  \\n            isMenuVisible = false;  \\n        });  \\n          \\n        menuContent.appendChild(menuItem);  \\n    });  \\n      \\n    var isMenuVisible = false;  \\n      \\n    svgButton.addEventListener(\\\"click\\\", function(event) {  \\n        event.stopPropagation();  \\n        if(isMenuVisible) {  \\n            menuContent.style.display = \\\"none\\\";  \\n            isMenuVisible = false;  \\n        } else {  \\n            menuContent.style.display = \\\"block\\\";  \\n            isMenuVisible = true;  \\n        }  \\n    });  \\n      \\n    // 点击其他地方关闭菜单  \\n    var closeMenuHandler = function() {  \\n        menuContent.style.display = \\\"none\\\";  \\n        isMenuVisible = false;  \\n    };  \\n      \\n    this.widget.document.addEventListener(\\\"click\\\", closeMenuHandler);  \\n      \\n    cell.appendChild(svgButton);  \\n    cell.appendChild(menuContent);  \\n};  \\n  \\nmodule.exports = CalendarAnnotations;\\n\"},\"$:/core/modules/widgets/chinese-calendar/calendar-cell.js\":{\"title\":\"$:/core/modules/widgets/chinese-calendar/calendar-cell.js\",\"created\":\"20250606104242135\",\"modified\":\"20250606104749487\",\"module-type\":\"library\",\"tags\":\"中文日历\",\"type\":\"application/javascript\",\"text\":\"/*\\\\  \\ntitle: $:/core/modules/widgets/chinese-calendar/calendar-cell.js\\ntype: application/javascript  \\nmodule-type: library\\n  \\n中文日历 - 日期单元格处理模块  \\n\\\\*/  \\n  \\n\\\"use strict\\\";  \\n  \\nvar CalendarAnnotations = require(\\\"$:/core/modules/widgets/chinese-calendar/calendar-annotations.js\\\");  \\n  \\nvar CalendarCell = function(widget) {  \\n    this.widget = widget;  \\n    this.annotationHelper = new CalendarAnnotations(widget);  \\n};  \\n  \\nCalendarCell.prototype.createDateCell = function(cell, date) {  \\n    var currentDate = new Date(this.widget.year, this.widget.month - 1, date);  \\n    var isToday = this.widget.highlightToday &&   \\n                  this.widget.year === this.widget.todayYear &&   \\n                  this.widget.month === this.widget.todayMonth &&   \\n                  date === this.widget.todayDate;  \\n      \\n    var cellClasses = [\\\"tc-calendar-cell\\\"];  \\n    if(isToday) cellClasses.push(\\\"tc-calendar-today\\\");  \\n      \\n    // 创建日期链接容器  \\n    var dateLink = this.createDateLink(date);  \\n    var cellContent = this.createCellContent(date, currentDate, cellClasses);  \\n      \\n    dateLink.appendChild(cellContent);  \\n    cell.appendChild(dateLink);  \\n      \\n    // 处理批注  \\n    this.annotationHelper.handleAnnotations(cell, currentDate, cellClasses);  \\n      \\n    cell.setAttribute(\\\"class\\\", cellClasses.join(\\\" \\\"));  \\n};  \\n  \\nCalendarCell.prototype.createDateLink = function(date) {  \\n    var dateLink = this.widget.document.createElement(\\\"div\\\");  \\n    dateLink.setAttribute(\\\"class\\\", \\\"tc-calendar-date-link\\\");  \\n      \\n    var dateKey = this.widget.year + \\\"年\\\" +   \\n                  String(this.widget.month).padStart(2, '0') + \\\"月\\\" +   \\n                  String(date).padStart(2, '0') + \\\"日\\\";  \\n      \\n    var self = this;  \\n    dateLink.addEventListener(\\\"click\\\", function(event) {  \\n        if(!event.target.closest('.tc-calendar-annotation-button')) {  \\n            event.stopPropagation();  \\n            self.widget.dispatchEvent({  \\n                type: \\\"tm-navigate\\\",  \\n                navigateTo: dateKey,  \\n                navigateFromTitle: self.widget.getVariable(\\\"currentTiddler\\\")  \\n            });  \\n        }  \\n    });  \\n      \\n    return dateLink;  \\n};  \\n  \\nCalendarCell.prototype.createCellContent = function(date, currentDate, cellClasses) {  \\n    var cellContent = this.widget.document.createElement(\\\"div\\\");  \\n    cellContent.setAttribute(\\\"class\\\", \\\"tc-calendar-cell-content\\\");  \\n      \\n    // 日期数字  \\n    var dateDiv = this.widget.document.createElement(\\\"div\\\");  \\n    dateDiv.setAttribute(\\\"class\\\", \\\"tc-calendar-date\\\");  \\n    dateDiv.appendChild(this.widget.document.createTextNode(date.toString()));  \\n    cellContent.appendChild(dateDiv);  \\n      \\n    // 农历日期  \\n    if(this.widget.showLunar) {  \\n        var lunarDate = this.widget.dataHelper.getLunarDate(currentDate);  \\n        if(lunarDate) {  \\n            var lunarDiv = this.widget.document.createElement(\\\"div\\\");  \\n            lunarDiv.setAttribute(\\\"class\\\", \\\"tc-calendar-lunar\\\");  \\n            lunarDiv.appendChild(this.widget.document.createTextNode(lunarDate));  \\n            cellContent.appendChild(lunarDiv);  \\n        }  \\n    }  \\n      \\n    // 节假日  \\n    if(this.widget.showHolidays) {  \\n        var holiday = this.widget.dataHelper.getHoliday(currentDate);  \\n        if(holiday) {  \\n            var holidayDiv = this.widget.document.createElement(\\\"div\\\");  \\n            holidayDiv.setAttribute(\\\"class\\\", \\\"tc-calendar-holiday\\\");  \\n            holidayDiv.appendChild(this.widget.document.createTextNode(holiday));  \\n            cellContent.appendChild(holidayDiv);  \\n            cellClasses.push(\\\"tc-calendar-holiday-cell\\\");  \\n        }  \\n    }  \\n      \\n    return cellContent;  \\n};  \\n  \\nmodule.exports = CalendarCell;\"},\"$:/core/modules/widgets/chinese-calendar/calendar-data.js\":{\"title\":\"$:/core/modules/widgets/chinese-calendar/calendar-data.js\",\"created\":\"20250606104500507\",\"modified\":\"20250606104819587\",\"module-type\":\"library\",\"tags\":\"中文日历\",\"type\":\"application/javascript\",\"text\":\"/*\\\\  \\ntitle: $:/core/modules/widgets/chinese-calendar/calendar-data.js  \\ntype: application/javascript  \\nmodule-type: library  \\n  \\n中文日历 - 数据获取模块  \\n\\\\*/  \\n  \\n\\\"use strict\\\";  \\n  \\nvar CalendarData = function(widget) {  \\n    this.widget = widget;  \\n};  \\n  \\nCalendarData.prototype.getLunarDate = function(date) {  \\n    var monthKey = date.getFullYear() + \\\"-\\\" + String(date.getMonth() + 1).padStart(2, '0');  \\n    var dayKey = String(date.getDate());  \\n      \\n    var lunarDataTiddler = this.widget.wiki.getTiddler(\\\"$:/data/lunar/\\\" + monthKey);  \\n      \\n    if(lunarDataTiddler && lunarDataTiddler.fields.text) {  \\n        try {  \\n            var monthData = JSON.parse(lunarDataTiddler.fields.text);  \\n            return monthData[dayKey] || \\\"\\\";  \\n        } catch(e) {  \\n            return \\\"\\\";  \\n        }  \\n    }  \\n    return \\\"\\\";  \\n};  \\n  \\nCalendarData.prototype.getHoliday = function(date) {  \\n    var dateKey = date.getFullYear() + \\\"-\\\" +   \\n                  String(date.getMonth() + 1).padStart(2, '0') + \\\"-\\\" +   \\n                  String(date.getDate()).padStart(2, '0');  \\n      \\n    // 查找整年的节假日数据tiddler  \\n    var holidayDataTiddler = this.widget.wiki.getTiddler(\\\"$:/data/holidays/\\\" + date.getFullYear());  \\n      \\n    if(holidayDataTiddler && holidayDataTiddler.fields.text) {  \\n        try {  \\n            var yearData = JSON.parse(holidayDataTiddler.fields.text);  \\n            return yearData[dateKey] || null;  \\n        } catch(e) {  \\n            return null;  \\n        }  \\n    }  \\n      \\n    return null;  \\n};  \\n  \\nmodule.exports = CalendarData;\"},\"$:/data/holidays/2025\":{\"title\":\"$:/data/holidays/2025\",\"created\":\"20250606084551742\",\"modified\":\"20250606085219169\",\"tags\":\"中文日历\",\"type\":\"application/json\",\"text\":\"{\\n    \\\"2025-01-01\\\": \\\"元旦\\\",\\n    \\\"2025-01-28\\\": \\\"除夕\\\",\\n    \\\"2025-01-29\\\": \\\"春节\\\",\\n    \\\"2025-01-30\\\": \\\"春节\\\",\\n    \\\"2025-01-31\\\": \\\"春节\\\",\\n    \\\"2025-02-01\\\": \\\"春节\\\",\\n    \\\"2025-02-02\\\": \\\"春节\\\",\\n    \\\"2025-02-03\\\": \\\"春节\\\",\\n    \\\"2025-02-04\\\": \\\"春节\\\",\\n    \\\"2025-02-14\\\": \\\"情人节\\\",\\n    \\\"2025-03-08\\\": \\\"妇女节\\\",\\n    \\\"2025-03-12\\\": \\\"植树节\\\",\\n    \\\"2025-04-01\\\": \\\"愚人节\\\",\\n    \\\"2025-04-04\\\": \\\"清明节\\\",\\n    \\\"2025-04-05\\\": \\\"清明节\\\",\\n    \\\"2025-04-06\\\": \\\"清明节\\\",\\n    \\\"2025-05-01\\\": \\\"劳动节\\\",\\n    \\\"2025-05-02\\\": \\\"劳动节\\\",\\n    \\\"2025-05-03\\\": \\\"劳动节\\\",\\n    \\\"2025-05-04\\\": \\\"劳动节\\\",\\n    \\\"2025-05-05\\\": \\\"劳动节\\\",\\n    \\\"2025-05-11\\\": \\\"母亲节\\\",\\n    \\\"2025-05-31\\\": \\\"端午节\\\",\\n    \\\"2025-06-01\\\": \\\"儿童节\\\",\\n    \\\"2025-06-02\\\": \\\"端午节\\\",\\n    \\\"2025-06-15\\\": \\\"父亲节\\\",\\n    \\\"2025-07-01\\\": \\\"建党节\\\",\\n    \\\"2025-08-01\\\": \\\"建军节\\\",\\n    \\\"2025-08-07\\\": \\\"七夕节\\\",\\n    \\\"2025-09-10\\\": \\\"教师节\\\",\\n    \\\"2025-10-01\\\": \\\"国庆节\\\",\\n    \\\"2025-10-02\\\": \\\"国庆节\\\",\\n    \\\"2025-10-03\\\": \\\"国庆节\\\",\\n    \\\"2025-10-04\\\": \\\"国庆节\\\",\\n    \\\"2025-10-05\\\": \\\"国庆节\\\",\\n    \\\"2025-10-06\\\": \\\"国庆节\\\",\\n    \\\"2025-10-07\\\": \\\"国庆节\\\",\\n    \\\"2025-10-08\\\": \\\"国庆节\\\",\\n    \\\"2025-10-31\\\": \\\"万圣节\\\",\\n    \\\"2025-11-11\\\": \\\"光棍节\\\",\\n    \\\"2025-12-25\\\": \\\"圣诞节\\\"\\n}\"},\"$:/data/lunar/2025-06\":{\"title\":\"$:/data/lunar/2025-06\",\"created\":\"20250606073156457\",\"modified\":\"20250606091454599\",\"tags\":\"中文日历\",\"type\":\"application/json\",\"text\":\"{  \\n  \\\"1\\\": \\\"初六\\\",  \\n  \\\"2\\\": \\\"初七\\\",   \\n  \\\"3\\\": \\\"初八\\\",  \\n  \\\"4\\\": \\\"初九\\\",  \\n  \\\"5\\\": \\\"芒种\\\",  \\n  \\\"6\\\": \\\"十一\\\",  \\n  \\\"7\\\": \\\"十二\\\",  \\n  \\\"8\\\": \\\"十三\\\",  \\n  \\\"9\\\": \\\"十四\\\",  \\n  \\\"10\\\": \\\"十五\\\",  \\n  \\\"11\\\": \\\"十六\\\",  \\n  \\\"12\\\": \\\"十七\\\",  \\n  \\\"13\\\": \\\"十八\\\",  \\n  \\\"14\\\": \\\"十九\\\",  \\n  \\\"15\\\": \\\"二十\\\",  \\n  \\\"16\\\": \\\"廿一\\\",  \\n  \\\"17\\\": \\\"廿二\\\",  \\n  \\\"18\\\": \\\"廿三\\\",  \\n  \\\"19\\\": \\\"廿四\\\",  \\n  \\\"20\\\": \\\"廿五\\\",  \\n  \\\"21\\\": \\\"夏至\\\",  \\n  \\\"22\\\": \\\"廿七\\\",  \\n  \\\"23\\\": \\\"廿八\\\",  \\n  \\\"24\\\": \\\"廿九\\\",  \\n  \\\"25\\\": \\\"六月初一\\\",  \\n  \\\"26\\\": \\\"初二\\\",  \\n  \\\"27\\\": \\\"初三\\\",  \\n  \\\"28\\\": \\\"初四\\\",  \\n  \\\"29\\\": \\\"初五\\\",  \\n  \\\"30\\\": \\\"初六\\\"  \\n}\"},\"$:/plugins/dyp/chinese-calendar/history\":{\"title\":\"$:/plugins/dyp/chinese-calendar/history\",\"created\":\"20250606092350587\",\"modified\":\"20250606092501531\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\"},\"$:/plugins/dyp/chinese-calendar/readme\":{\"title\":\"$:/plugins/dyp/chinese-calendar/readme\",\"created\":\"20250606092233277\",\"modified\":\"20250606092336005\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"; 中文日历\\n\\n支持添加农历日期、节假日、节气、批注笔记\"},\"$:/plugins/dyp/chinese-calendar/usage\":{\"title\":\"$:/plugins/dyp/chinese-calendar/usage\",\"created\":\"20250606092339856\",\"modified\":\"20250606092347810\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\"},\"2025-06-15-meeting\":{\"title\":\"2025-06-15-meeting\",\"annotation-color\":\"red\",\"created\":\"20250606064400286\",\"date\":\"2025-06-15\",\"modified\":\"20250606090937487\",\"tags\":\"中文日历\",\"text\":\"重要会议\\n其他的内容\"},\"中文日历样式css\":{\"title\":\"中文日历样式css\",\"created\":\"20250606063044994\",\"modified\":\"20250606091307783\",\"tags\":\"$:/tags/Stylesheet 中文日历\",\"text\":\"/* 表格数据单元格 - 增大尺寸 */  \\n.tc-calendar-cell {  \\n    position: relative;  \\n    height: 55px;  \\n    min-height: 55px;  \\n    width: 55px;  \\n    padding: 2px;  \\n    background-color: #ffffff;  \\n    text-align: center;  \\n    vertical-align: middle;  \\n}  \\n  \\n/* 空白单元格 */  \\n.tc-calendar-empty {  \\n    background-color: #f9f9f9;  \\n}  \\n  \\n/* 日期链接容器 - 可点击 */  \\n.tc-calendar-date-link {  \\n    cursor: pointer;  \\n    width: 100%;  \\n    height: 100%;  \\n    display: flex;  \\n    align-items: center;  \\n    justify-content: center;  \\n    border-radius: 2px;  \\n    transition: background-color 0.2s ease;  \\n}  \\n  \\n.tc-calendar-date-link:hover {  \\n    background-color: rgba(0,0,0,0.05);  \\n}  \\n  \\n/* 单元格内容容器 - 居中对齐，修复文字排版 */  \\n.tc-calendar-cell-content {  \\n    display: flex;  \\n    flex-direction: column;  \\n    align-items: center;  \\n    justify-content: center;  \\n    height: 100%;  \\n    width: 100%;  \\n    white-space: nowrap;  /* 防止文字换行 */  \\n    word-break: keep-all; /* 保持文字完整 */  \\n}  \\n  \\n/* 日期数字样式 - 大字体，修复排版 */  \\n.tc-calendar-date {  \\n    font-size: 18px;  \\n    font-weight: bold;  \\n    margin: 0;  \\n    line-height: 1;  \\n    color: #333333;  \\n    text-align: center;  \\n    white-space: nowrap;  \\n}  \\n  \\n/* 农历日期样式 - 大字体，修复排版 */  \\n.tc-calendar-lunar {  \\n    font-size: 12px;  \\n    color: #999;  \\n    margin: 1px 0 0 0;  \\n    line-height: 1;  \\n    text-align: center;  \\n    white-space: nowrap;  \\n}  \\n  \\n/* 节假日样式 - 大字体，修复排版 */  \\n.tc-calendar-holiday {  \\n    font-size: 11px;  \\n    color: #5797d8;  \\n    font-weight: normal;  \\n    line-height: 1;  \\n    margin: 1px 0 0 0;  \\n    text-align: center;  \\n    white-space: nowrap;  \\n}  \\n  \\n/* 节假日单元格背景 */  \\n.tc-calendar-holiday-cell {  \\n    background-color: #f2faea;  \\n}  \\n  \\n/* 今天日期高亮 - 修复边框问题 */  \\n.tc-calendar-today {  \\n    background-color: #5797d825 !important;  \\n    position: relative;  \\n}  \\n  \\n.tc-calendar-today::before {  \\n    content: '';  \\n    position: absolute;  \\n    top: 0;  \\n    left: 0;  \\n    right: 0;  \\n    bottom: 0;  \\n    border: 2px solid #5797d8;  \\n    pointer-events: none;  \\n    z-index: 1;  \\n}  \\n  \\n.tc-calendar-today .tc-calendar-date {  \\n    color: #5797d8;  \\n    font-weight: bold;  \\n    position: relative;  \\n    z-index: 2;  \\n}  \\n  \\n.tc-calendar-today .tc-calendar-lunar {  \\n    position: relative;  \\n    z-index: 2;  \\n}  \\n  \\n.tc-calendar-today .tc-calendar-holiday {  \\n    position: relative;  \\n    z-index: 2;  \\n}  \\n  \\n/* SVG批注按钮样式 */  \\n.tc-calendar-annotation-button {  \\n    position: absolute;  \\n    top: 2px;  \\n    right: 2px;  \\n    width: 16px;  \\n    height: 16px;  \\n    cursor: pointer;  \\n    z-index: 10;  \\n    opacity: 0.7;  \\n    transition: opacity 0.2s ease;  \\n}  \\n  \\n.tc-calendar-annotation-button:hover {  \\n    opacity: 1;  \\n    transform: scale(1.1);  \\n}  \\n  \\n.tc-calendar-annotation-button svg {  \\n    width: 80%;  \\n    height: 80%;  \\n    fill: #5797d8;  \\n}  \\n  \\n/* 不同颜色的SVG批注按钮 */  \\n.tc-calendar-annotation-red svg {  \\n    fill: #dc3545;  \\n}  \\n  \\n.tc-calendar-annotation-blue svg {  \\n    fill: #007bff;  \\n}  \\n  \\n.tc-calendar-annotation-green svg {  \\n    fill: #28a745;  \\n}  \\n  \\n.tc-calendar-annotation-yellow svg {  \\n    fill: #ffc107;  \\n}  \\n  \\n.tc-calendar-annotation-orange svg {  \\n    fill: #fd7e14;  \\n}  \\n  \\n.tc-calendar-annotation-purple svg {  \\n    fill: #6f42c1;  \\n}  \\n  \\n/* 批注弹窗样式 - 显示在右侧，改进交互 */  \\n.tc-calendar-annotation-popup {  \\n    position: absolute;  \\n    top: 0;  \\n    left: 100%;  \\n    margin-left: 5px;  \\n    background-color: #ffffff;  \\n    border: 1px solid #e0e0e0;  \\n    border-radius: 4px;  \\n    padding: 8px 10px;  \\n    font-size: 14px;  \\n    color: #333333;  \\n    white-space: pre-wrap;  /* 支持换行和空格 */  \\n    z-index: 1000;  \\n    box-shadow: 0 2px 8px rgba(0,0,0,0.15);  \\n    max-width: 200px;  \\n    min-width: 120px;  \\n    word-wrap: break-word;  \\n    line-height: 1.4;  \\n}  \\n  \\n.tc-calendar-annotation-popup::before {  \\n    content: '';  \\n    position: absolute;  \\n    top: 50%;  \\n    left: -5px;  \\n    transform: translateY(-50%);  \\n    width: 0;  \\n    height: 0;  \\n    border-top: 5px solid transparent;  \\n    border-bottom: 5px solid transparent;  \\n    border-right: 5px solid #ffffff;  \\n}  \\n  \\n/* 隐藏原来的批注文字显示 */  \\n.tc-calendar-annotation-text {  \\n    display: none;  \\n}  \\n  \\n/* 响应式调整 - 保持可读性 */  \\n@media (max-width: 600px) {  \\n    .tc-calendar-cell {  \\n        height: 45px;  \\n        min-height: 45px;  \\n        width: 45px;  \\n        padding: 1px;  \\n    }  \\n      \\n    .tc-calendar-date {  \\n        font-size: 16px;  \\n    }  \\n      \\n    .tc-calendar-lunar {  \\n        font-size: 11px;  \\n    }  \\n      \\n    .tc-calendar-holiday {  \\n        font-size: 10px;  \\n    }  \\n      \\n    .tc-calendar-annotation-button {  \\n        width: 14px;  \\n        height: 14px;  \\n    }  \\n      \\n    .tc-calendar-annotation-popup {  \\n        font-size: 13px;  \\n        max-width: 140px;  \\n    }  \\n}  \\n  \\n/* 平板设备调整 */  \\n@media (max-width: 768px) and (min-width: 601px) {  \\n    .tc-calendar-cell {  \\n        height: 50px;  \\n        min-height: 50px;  \\n        width: 50px;  \\n    }  \\n      \\n    .tc-calendar-date {  \\n        font-size: 17px;  \\n    }  \\n      \\n    .tc-calendar-lunar {  \\n        font-size: 12px;  \\n    }  \\n}  \\n  \\n/* 深色主题适配 */  \\n@media (prefers-color-scheme: dark) {  \\n    .tc-calendar-annotation-popup {  \\n        box-shadow: 0 2px 4px rgba(255,255,255,0.1);  \\n    }  \\n}  \\n  \\n/* 确保表格布局紧凑 - 单边框 */  \\n.tc-calendar-table {  \\n    border-collapse: collapse;  \\n    border-spacing: 0;  \\n}  \\n  \\n.tc-calendar-table th,  \\n.tc-calendar-table td {  \\n    border: 1px solid #e0e0e0;  \\n    padding: 0;  \\n    margin: 0;  \\n}  \\n  \\n/* 表头样式调整 - 大字体 */  \\n.tc-calendar-table th {  \\n    background-color: #fafafa;  \\n    height: 35px;  \\n    font-weight: bold;  \\n    font-size: 16px;  \\n    color: #666666;  \\n    text-align: center;  \\n    vertical-align: middle;  \\n}  \\n  \\n/* 日历标题样式 - 大字体 */  \\n.tc-calendar-title {  \\n    text-align: center;  \\n    margin: 0 0 12px 0;  \\n    color: #333333;  \\n    font-size: 20px;  \\n    font-weight: bold;  \\n}  \\n  \\n/* 日历容器 */  \\n.tc-chinese-calendar {  \\n    font-family: sans-serif;  \\n    margin: 5px 0;  \\n    display: inline-block;  \\n}\"},\"引用中文日历示例\":{\"title\":\"引用中文日历示例\",\"created\":\"20250606063213752\",\"modified\":\"20250606090927139\",\"tags\":\"中文日历 测试\",\"text\":\"基本用法：\\n\\n```tw\\n<$chinese-calendar year=\\\"2025\\\" month=\\\"6\\\" monday-first=\\\"yes\\\" highlight-today=\\\"yes\\\"/>\\n```\\n\\n带批注的用法\\n\\n```tw\\n<$chinese-calendar   \\n    year=\\\"2025\\\"   \\n    month=\\\"6\\\"   \\n    monday-first=\\\"yes\\\"   \\n    highlight-today=\\\"yes\\\"  \\n    annotation-filter=\\\"[tag[calendar-annotation]field:date[{{date}}]]\\\"/>\\n```\\n\\n创建批注tiddler示例：\\n\\n```tw\\ntitle: 2025-06-15-meeting  \\ntags: calendar-annotation  \\ndate: 2025-06-15  \\nannotation-color: red\\ntext: 重要会议  \\n```\\n\\n<$chinese-calendar year=\\\"2025\\\" month=\\\"6\\\" monday-first=\\\"yes\\\" highlight-today=\\\"yes\\\"/>\\n\\n<$chinese-calendar   \\n    year=\\\"2025\\\"   \\n    month=\\\"6\\\"   \\n    monday-first=\\\"yes\\\"   \\n    highlight-today=\\\"yes\\\"  \\n    annotation-filter=\\\"[field:date[{{date}}]]\\\"/>\"}}}"}