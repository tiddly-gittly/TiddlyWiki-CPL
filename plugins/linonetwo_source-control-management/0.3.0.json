{"author":"LinOnetwo","core-version":">=5.1.22","dependents":"","description":"Use TidGi's NodeJS API to sync data to git on the cloud","list":"readme tree","name":"Source Control Management (git) for TidGi Desktop","plugin-type":"plugin","stability":"STABILITY_1_EXPERIMENTAL","text":"{\"tiddlers\":{\"$:/plugins/linonetwo/source-control-management/SideBarSCMTab\":{\"title\":\"$:/plugins/linonetwo/source-control-management/SideBarSCMTab\",\"tags\":\"$:/tags/SideBar\",\"type\":\"text/vnd.tiddlywiki\",\"caption\":\"SCM\",\"description\":\"Source Control Management\",\"text\":\"<$git-sync-scm-tab />\\n\"},\"$:/plugins/linonetwo/source-control-management/icons/git-pull-request.svg\":{\"title\":\"$:/plugins/linonetwo/source-control-management/icons/git-pull-request.svg\",\"text\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"tc-image-button\\\" width=\\\"22\\\" height=\\\"22\\\" viewBox=\\\"0 0 22 22\\\" stroke-width=\\\"2\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\">\\n  <path stroke=\\\"none\\\" d=\\\"M0 0h24v24H0z\\\"/>\\n  <circle cx=\\\"6\\\" cy=\\\"18\\\" r=\\\"2\\\"/>\\n  <circle cx=\\\"6\\\" cy=\\\"6\\\" r=\\\"2\\\"/>\\n  <circle cx=\\\"18\\\" cy=\\\"18\\\" r=\\\"2\\\"/>\\n  <line x1=\\\"6\\\" y1=\\\"8\\\" x2=\\\"6\\\" y2=\\\"16\\\"/>\\n  <path d=\\\"M11 6h5a2 2 0 0 1 2 2v8\\\"/>\\n  <polyline points=\\\"14 9 11 6 14 3\\\"/>\\n</svg>\",\"type\":\"text/vnd.tiddlywiki\"},\"$:/plugins/linonetwo/source-control-management/readme\":{\"title\":\"$:/plugins/linonetwo/source-control-management/readme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"!! 功能\\n\\n[[WebCatalog|https://webcatalogapp.com/]] 除了[[能将 TiddlyWiki 包装成桌面应用|https://onetwo.ren/%E7%94%A8tiddlywiki%E6%9B%BF%E4%BB%A3notion%E5%92%8Cevernote%E7%AE%A1%E7%90%86%E7%9F%A5%E8%AF%86/]]以外，还提供了自定义 API 并暴露给网页的功能，让我们可以在 Wiki 网页里使用一些高级功能。\\n\\n本插件利用暴露的自定义 API 实现：\\n\\n# 查看本地 NodeJS 版 TiddlyWiki 是否完全与 Github 备份云同步了\\n# 一键同步本地和云端\\n\\n!! 用法\\n\\n当点开 SCM 标签页的时候，会进行一次 git 环境检查，因为使用的 git 库 dugite 比较卡，所以只进行一次检查，如果需要刷新，需要来回切换一下 tab。\\n\"},\"$:/plugins/linonetwo/source-control-management/tree\":{\"title\":\"$:/plugins/linonetwo/source-control-management/tree\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<<tree prefix:\\\"$:/plugins/linonetwo/source-control-management/\\\">>\"},\"$:/plugins/linonetwo/source-control-management/tab.js\":{\"title\":\"$:/plugins/linonetwo/source-control-management/tab.js\",\"type\":\"application/javascript\",\"module-type\":\"widget\",\"Modern.TiddlyDev#Origin\":\"tab.ts\",\"text\":\"\\\"use strict\\\";var import_widget=require(\\\"$:/core/modules/widgets/widget.js\\\");if($tw.browser){class a extends import_widget.widget{constructor(e,t){super(e,t),this.state={needSetUp:!1,repoInfo:{},count:0,unsync:!1},this.initialise(e,t),this.checkInLoop()}async getWorkspaces(){var e=await window?.service?.workspace?.getWorkspacesAsList?.();const t=await window?.service?.workspace?.getActiveWorkspace?.();return t&&e?e.filter(e=>e.id===t.id||e.isSubWiki&&e.mainWikiID===t.id):[]}render(e,t){this.parentDomNode=e,this.computeAttributes();var i=this.document.createElement(\\\"div\\\");i.className=\\\"\\\";for(const w of Object.keys(this.state.repoInfo).sort((e,t)=>e.length-t.length)){var s=this.state.repoInfo[w],n=this.document.createElement(\\\"div\\\"),a=this.document.createElement(\\\"h4\\\"),o=this.document.createElement(\\\"span\\\"),r=(o.className=\\\"tidgi-scm-count\\\",o.innerText=String(s.length),w.split(\\\"/\\\").pop());a.innerText=r??\\\"-\\\",a.append(o),n.append(a);for(const m of s){var c=this.document.createElement(\\\"div\\\"),d=(c.className=\\\"tidgi-scm-file-info\\\",this.document.createElement(\\\"span\\\")),l=(d.className=\\\"tidgi-scm-file-changed-type\\\",d.innerText=this.mapChangeTypeToText(m.type),this.document.createElement(\\\"a\\\"));l.className=\\\"tidgi-scm-file-name tc-tiddlylink tc-tiddlylink-resolves tc-popup-handle tc-popup-absolute\\\";const g=this.getTitleByPath(m.fileRelativePath);l.innerText=g,l.addEventListener(\\\"click\\\",()=>{this.onChangedFileNameClicked(g)});var p=this.document.createElement(\\\"a\\\"),h=(p.className=\\\"tidgi-scm-file-open-in-folder tc-tiddlylink tc-tiddlylink-resolves tc-popup-handle tc-popup-absolute\\\",$tw.wiki.getTiddlerText(\\\"$:/plugins/linonetwo/open-in-external-app/icons/open-in-folder\\\")??\\\"O\\\");p.innerHTML=h,p.addEventListener(\\\"click\\\",()=>{this.onOpenInFolderClicked(m.filePath)}),c.append(d),c.append(l),c.append(p),n.append(c)}i.append(n)}e.insertBefore(i,t),this.domNodes.push(i)}onChangedFileNameClicked(e){var t=window.meta?.()?.workspaceID;t&&window?.service?.wiki?.wikiOperationInBrowser?.(\\\"wiki-open-tiddler\\\",t,[e])}onOpenInFolderClicked(e){window?.service?.[\\\"native\\\"]?.openPath?.(e,!0)}getTitleByPath(e){return e.startsWith(\\\"plugins\\\")?\\\"$:/\\\"+e:e.startsWith(\\\"tiddlers/\\\")?e.replace(\\\"tiddlers/\\\",\\\"\\\").replace(/\\\\.tid$/,\\\"\\\"):e.endsWith(\\\".tid\\\")?e.replace(/\\\\.tid$/,\\\"\\\"):e}async getFolderInfo(){return(await this.getWorkspaces()).map(({wikiFolderLocation:e,gitUrl:t})=>({wikiPath:e,gitUrl:t}))}mapChangeTypeToText(e){return\\\"??\\\"!==e?e:\\\"+\\\"}async checkInLoop(){window?.service?.git&&\\\"function\\\"==typeof window?.service?.git?.commitAndSync&&\\\"function\\\"==typeof window?.service?.git?.getModifiedFileList&&\\\"function\\\"==typeof window?.service?.workspace?.getWorkspacesAsList?(this.state.needSetUp=!1,await this.checkGitState()):this.state.needSetUp=!0}async checkGitState(){this.state.count=0,this.state.unsync=!1,this.state.repoInfo={};var e=(await this.getFolderInfo()).map(async({wikiPath:e})=>{var t=await window?.service?.git?.getModifiedFileList?.(e);t&&(t.sort((e,t)=>e.fileRelativePath>t.fileRelativePath?1:-1),$tw.wiki.addTiddler({title:\\\"$:/state/scm-modified-file-list/\\\"+e,text:JSON.stringify(t)}),this.state.repoInfo[e]=t)});return await Promise.all(e),this.refreshSelf()}}exports[\\\"git-sync-scm-tab\\\"]=a}\"},\"$:/plugins/linonetwo/source-control-management/tab.css\":{\"title\":\"$:/plugins/linonetwo/source-control-management/tab.css\",\"tags\":[\"$:/tags/Stylesheet\"],\"type\":\"text/css\",\"Modern.TiddlyDev#Origin\":\"../../temp_stylePlugin:src/source-control-management/style.css\",\"text\":\"span.tidgi-scm-count{position:relative;background:#696969;color:#fff;border-radius:9999px;opacity:.5;min-width:1.2em;margin-left:.5em;padding-left:.5em;padding-top:.1em;padding-right:.5em;width:-moz-fit-content;width:fit-content}span.tidgi-scm-count-small{font-size:.6em;padding-left:.2em;padding-right:.2em;line-height:1.3em;margin-left:-1em}div.tidgi-scm-file-info{margin-bottom:5px}span.tidgi-scm-file-changed-type{margin-right:5px}a.tidgi-scm-file-name{color:#333;cursor:pointer}a.tidgi-scm-file-open-in-folder{color:#333;cursor:pointer;padding:0}a.tidgi-scm-file-open-in-folder>svg{padding:0;height:1em}\"}}}","title":"$:/plugins/linonetwo/source-control-management","type":"application/json","version":"0.3.0","Modern.TiddlyDev#SHA256-Hashed":"65815f7de4557f1096d204d5e6faf3f6eeb49baac252e94012cb1271b46132dc"}