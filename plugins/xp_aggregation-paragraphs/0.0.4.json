{"title":"$:/plugins/xp/aggregation-paragraphs","name":"Paragraphs","description":"Exploring writing long articles in tiddlywiki","list":"readme settings","version":"0.0.4","plugin-type":"plugin","parent-plugin":"$:/plugins/xp/aggregation","dependents":"$:/plugins/xp/aggregation","type":"application/json","author":"kl","created":"20230927134452617","modified":"20240216072405006","text":"{\"tiddlers\":{\"PARAGRAPHS\":{\"title\":\"PARAGRAPHS\",\".taghandler\":\"\",\"caption\":\"{{$:/xp/images/paragraph}} PARAGRAPHS\",\"color\":\"#bbb\",\"icon\":\"$:/xp/images/paragraph\",\"tmap.id\":\"12f8b357-ef9d-4830-939f-7885a78514d4\",\"text\":\"\\\\whitespace trim\\n\\\\function aggregationTag() [[$:/config/xp/aggregation-paragraphs/Tags]get[text]]\\n\\n\\\\define storeTitle() $:/temp/search/paragraphs\\n\\\\function userInput() [<storeTitle>get[text]]\\n\\\\define searchFilter() [tag<aggregationTag>sort[]search:*<userInput>]\\n\\n\\\\procedure new-tiddler()\\n\\\\whitespace notrim\\n<$button tooltip=\\\"Create a paragraphs tiddler\\\" aria-label=\\\"new paragraphs tiddler\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n<span class=\\\"tc-btn-icon\\\">{{$:/core/images/new-button}}</span> new tiddler\\n<$action-sendmessage $message=\\\"tm-new-tiddler\\\"\\ntags=<<aggregationTag>>\\ntext={{{ [<now \\\"[UTC]YYYY0MM0DD0hh0mm0ssXXX\\\">addprefix[<<paras \\\"]addsuffix[\\\">>]] }}}\\n/>\\n</$button>\\n\\\\end new-tiddler\\n\\n<div class=\\\"tc-sidebar-lists xp-float-right\\\">\\n<<new-tiddler>>&emsp;<<help-button-to \\\"$:/plugins/xp/aggregation-paragraphs\\\">>\\n</div>\\n\\n<$list filter=\\\"[tag<aggregationTag>limit[1]]\\\" emptyMessage={{$:/aggregation/prompt}} variable=\\\"ignore\\\">\\n\\n<span class=\\\"xp-search\\\">\\nSearch <i class='tc-tiny-gap-left'/>\\n<$macrocall\\n  $name=\\\"keyboard-driven-input\\\"\\n  tiddler=<<storeTitle>>\\n  type=\\\"search\\\"\\n  tag=\\\"input\\\"\\n  focus={{$:/config/xp/aggregation/SearchAutoFocus}}\\n  inputCancelActions=\\\"<$action-deletetiddler $tiddler=<<storeTitle>>/>\\\"\\n/>\\n</span>\\n<i class='tc-tiny-gap-left'/>\\n<span class=\\\"xp-search\\\">\\n<$reveal state=<<storeTitle>> type=\\\"nomatch\\\" text=\\\"\\\">\\n<$button class=\\\"tc-btn-invisible\\\">\\n<$action-deletetiddler $tiddler=<<storeTitle>>/>\\n{{$:/core/images/close-button}}\\n</$button>\\n</$reveal>\\n</span>\\n<$reveal state=<<storeTitle>> type=\\\"nomatch\\\" text=\\\"\\\">\\n<$let resultCount={{{ [subfilter<searchFilter>count[]] }}}>\\n<span class=\\\"xp-search-results\\\">{{$:/language/Search/System/Matches}}</span>\\n</$let>\\n</$reveal>\\n\\n<$macrocall\\n  $name=\\\"list-links\\\"\\n  filter=<<searchFilter>>\\n  type=\\\"ol\\\"\\n  class=\\\"tc-muted\\\"\\n/>\\n\\n</$list>\"},\"$:/config/xp/aggregation-paragraphs/EditTemplate\":{\"title\":\"$:/config/xp/aggregation-paragraphs/EditTemplate\",\"text\":\"$:/xp/aggregation-paragraphs/ui/EditTemplate\"},\"$:/config/xp/aggregation-paragraphs/Tags\":{\"title\":\"$:/config/xp/aggregation-paragraphs/Tags\",\"text\":\"Paragraphs\"},\"$:/config/xp/aggregation/ui/paragraphs\":{\"title\":\"$:/config/xp/aggregation/ui/paragraphs\",\"text\":\"PARAGRAPHS\"},\"$:/config/xp/aggregation-paragraphs/view\":{\"title\":\"$:/config/xp/aggregation-paragraphs/view\",\"text\":\"pop\"},\"$:/plugins/xp/aggregation-paragraphs/icon\":{\"title\":\"$:/plugins/xp/aggregation-paragraphs/icon\",\"text\":\"<svg width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 1024 1024\\\"><path d=\\\"M928 960H96c-53.02 0-96-42.98-96-96V160c0-53.02 42.98-96 96-96h832c53.02 0 96 42.98 96 96v704c0 53.02-42.98 96-96 96zM256 240c-44.182 0-80 35.818-80 80s35.818 80 80 80 80-35.818 80-80-35.818-80-80-80z m0 192c-44.182 0-80 35.818-80 80s35.818 80 80 80 80-35.818 80-80-35.818-80-80-80z m0 192c-44.182 0-80 35.818-80 80s35.818 80 80 80 80-35.818 80-80-35.818-80-80-80z m576-272v-64c0-13.254-10.746-24-24-24H408c-13.254 0-24 10.746-24 24v64c0 13.254 10.746 24 24 24h400c13.254 0 24-10.746 24-24z m0 192v-64c0-13.254-10.746-24-24-24H408c-13.254 0-24 10.746-24 24v64c0 13.254 10.746 24 24 24h400c13.254 0 24-10.746 24-24z m0 192v-64c0-13.254-10.746-24-24-24H408c-13.254 0-24 10.746-24 24v64c0 13.254 10.746 24 24 24h400c13.254 0 24-10.746 24-24z\\\"/></svg>\"},\"$:/xp/images/paragraph\":{\"title\":\"$:/xp/images/paragraph\",\"tags\":\"$:/tags/Image\",\"text\":\"\\\\parameters (size:\\\"22pt\\\")\\n<svg width=<<size>> height=<<size>> viewBox=\\\"0 0 1024 1024\\\"><path d=\\\"M876.580571 107.995429v41.728c0 19.419429-15.433143 53.138286-34.852571 53.138285-9.728 0-21.138286-1.718857-30.866286 0.585143a24.100571 24.100571 0 0 0-18.285714 17.700572c-2.852571 10.861714-1.718857 24.576-1.718857 36.571428v658.285714a34.633143 34.633143 0 0 1-34.852572 34.852572h-61.696a34.633143 34.633143 0 0 1-34.852571-34.852572V220.013714h-81.700571v695.990857a34.633143 34.633143 0 0 1-34.852572 34.852572H481.206857a34.633143 34.633143 0 0 1-34.852571-34.852572v-283.428571c-55.442286-4.571429-102.838857-16.018286-139.995429-33.718857a235.264 235.264 0 0 1-109.714286-102.290286c-23.990857-43.995429-36.571429-93.696-36.571428-148.004571 0-63.414857 17.152-118.272 50.285714-163.437715 33.718857-45.129143 73.728-75.446857 119.442286-90.843428C372.662857 79.981714 462.957714 73.142857 568.100571 73.142857h273.700572c19.419429 0 34.852571 15.433143 34.852571 34.852572z\\\"/></svg>\"},\"$:/xp/aggregation-paragraphs/procedures\":{\"title\":\"$:/xp/aggregation-paragraphs/procedures\",\"code-body\":\"yes\",\"tags\":\"$:/tags/Global\",\"text\":\"\\\\procedure paras(state:\\\"paras-state\\\",type,searchClass:\\\"xp-search-aggregation\\\",promptTiddler:\\\"$:/aggregation/prompt\\\",tocTemplate)\\n\\\\import $:/aggregation/macros/general\\n\\\\whitespace trim\\n\\\\function pid() [<state>addprefix[$:/paras/]]\\n\\\\function aggregateTitle() [<pid>addsuffix[/Aggregated]]\\n\\\\function currentText() [<aggregateTitle>get[text]]\\n\\\\function storeTitle() [<state>addprefix[$:/temp/search/]]\\n\\\\function userInput() [<storeTitle>get[text]]\\n\\\\function configTiddler() [<state>addprefix[$:/config/xp/aggregation-paragraphs/]addsuffix[/SearchScope]]\\n\\\\function templateTiddler() [<state>addprefix[$:/config/xp/aggregation-paragraphs/]addsuffix[/TiddlerTemplate]]\\n\\\\function readingMode() [<state>addprefix[$:/config/xp/aggregation-paragraphs/]addsuffix[/ReadingMode]]\\n\\\\function sourceMode() [<state>addprefix[$:/config/xp/aggregation-paragraphs/]addsuffix[/sourceMode]]\\n\\\\function tocState() [<state>addprefix[$:/state/xp/]addsuffix[/toc]]\\n\\\\function selectedTiddler() [<state>addprefix[$:/temp/toc/selectedTiddler/]]\\n\\\\function SubStoryList() [<pid>]\\n\\\\function SubHistoryList() [<pid>addsuffix[/SubHistoryList]]\\n\\\\function searchRun() [<configTiddler>has[text]get[text]] ~\\\"+[search:*<userInput>]\\\"\\n\\\\procedure storylist() [list<SubStoryList>]\\n\\\\function searchFilter() [<storylist>addsuffix[ ]addsuffix<searchRun>]\\n\\n\\\\procedure new-paragraph-button(below)\\n\\\\procedure actions()\\n<$reveal state=<<storeTitle>> type=\\\"nomatch\\\" text=\\\"\\\">\\n<$action-deletetiddler $tiddler=<<storeTitle>>/>\\n</$reveal>\\n<$reveal state=<<readingMode>> type=\\\"match\\\" text=\\\"on\\\">\\n<$action-setfield $tiddler=<<readingMode>> text=\\\"off\\\"/>\\n</$reveal>\\n<$let\\n  number={{{ [tag<pid>!is[draft]sortan[]last[]split[/]last[]] }}}\\n  number1={{{ [<number>add[1]] }}}\\n  newNumber1={{{ [<number1>addprefix[00]] }}}\\n  newNumber2={{{ [<number1>addprefix[0]] }}}\\n  filter1=\\\"[compare:number:lteq[9]then<newNumber1>]\\\"\\n  filter2=\\\"[compare:number:gt[9]compare:number:lteq[99]then<newNumber2>]\\\"\\n  filter3=\\\"[compare:number:gt[99]then<number1>]\\\"\\n  newNumber={{{ [<number1>] :cascade[<filter1>append<filter2>append<filter3>] }}}\\n>\\n<$set name=\\\"newTitle\\\" filter=\\\"[tag<pid>]\\\" value={{{ [<pid>addsuffix[/]addsuffix<newNumber>] }}} emptyValue={{{ [<pid>addsuffix[/001]] }}}>\\n<$let newTitleDraft={{{ [<newTitle>addprefix[Draft of ']addsuffix[']] }}}>\\n<$list filter=\\\"[<below>match[yes]]\\\" variable=ignore>\\n<$action-listops $tiddler=<<pid>> $subfilter=\\\"+[insertafter<newTitleDraft>,<currentTiddler>]\\\"/>\\n</$list>\\n</$let>\\n<$action-sendmessage\\n  $message=\\\"tm-new-tiddler\\\"\\n  title=<<newTitle>>\\n  tags=<<pid>>\\n  caption=\\\"A paragraph\\\"\\n  text={{$:/config/new-paragraph/Text}}\\n  type=<<type>>\\n/>\\n</$set>\\n</$let>\\n\\\\end actions\\n<$button tooltip={{{ [<below>match[yes]then[Create a new paragraph below]] ~[[Create a new paragraph]] }}} aria-label=\\\"new paragraph\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n<<actions>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n<span class=\\\"tc-btn-icon\\\">{{$:/core/images/new-button}}</span>\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=\\\"new paragraph\\\"/>\\n</span>\\n</$list>\\n</$button>\\n\\\\end new-paragraph-button\\n\\n\\\\procedure navigation-button() \\n<span class=\\\"tc-popup-keep\\\">\\n<$button popup=<<qualify \\\"$:/state/xp/aggregation-paragraphs/navigation\\\">> tooltip=\\\"Navigation\\\" class=\\\"tc-btn-invisible\\\">\\n{{$:/core/images/list-number}}\\n</$button>\\n</span>\\n\\n<$reveal state=<<qualify \\\"$:/state/xp/aggregation-paragraphs/navigation\\\">> type=\\\"popup\\\" position=\\\"below\\\" animate=\\\"yes\\\">\\n<<substory-navigator \\\"\\\"\\\"\\n<div class=\\\"tc-block-dropdown-wrapper\\\">\\n<div class=\\\"tc-block-dropdown tc-edit-type-dropdown\\\" style=\\\"border-radius:4px;\\\">\\n//<small class=\\\"tc-muted tc-big-gap\\\">Drag and drop to change the ordering</small>//\\n<$reveal state=<<readingMode>> type=\\\"nomatch\\\" text=\\\"on\\\" default=\\\"off\\\">\\n<$linkcatcher actions=\\\"<$action-deletetiddler $tiddler=<<storeTitle>>/><$action-navigate $to=<<navigateTo>>/>\\\">\\n<$macrocall $name=\\\"list-links-draggable\\\" tiddler=<<SubStoryList>> type=\\\"ol\\\" class=\\\"tc-muted\\\"/>\\n</$linkcatcher>\\n</$reveal>\\n<$reveal state=<<readingMode>> type=\\\"match\\\" text=\\\"on\\\" default=\\\"off\\\">\\n<$linkcatcher actions=\\\"<$action-setfield $tiddler=<<selectedTiddler>> text=<<navigateTo>>/>\\\">\\n<$macrocall $name=\\\"list-links-draggable\\\" tiddler=<<SubStoryList>> type=\\\"ol\\\" class=\\\"tc-muted\\\"/>\\n</$linkcatcher>\\n</$reveal>\\n</div>\\n</div>\\n\\\"\\\"\\\">>\\n</$reveal>\\n\\\\end navigation-button\\n\\n\\\\procedure template-button(evenodd:\\\"$:/templates/transclusion-paragraph-evenodd\\\") \\n\\\\whitespace trim\\n<$button tooltip=\\\"Switching Views\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n{{$:/xp/images/switch}}\\n<$reveal state=<<templateTiddler>> type=\\\"nomatch\\\" text=<<evenodd>>>\\n<$action-setfield $tiddler=<<templateTiddler>> text=<<evenodd>>/>\\n</$reveal>\\n<$reveal state=<<templateTiddler>> type=\\\"match\\\" text=<<evenodd>>>\\n<$action-setfield $tiddler=<<templateTiddler>> text=\\\"$:/templates/transclusion-paragraph\\\"/>\\n</$reveal>\\n</$button>\\n\\\\end template-button\\n\\n\\\\procedure aggregate-button()\\n\\\\procedure actions()\\n<$action-createtiddler $overwrite=\\\"yes\\\" $basetitle=<<aggregateTitle>>>\\n<$list filter=\\\"[list<SubStoryList>prefix<pid>is[tiddler]!is[draft]]\\\" variable=\\\"listItem\\\">\\n<$set name=\\\"caption\\\" filter=\\\"[<type>search[markdown]]\\\" value={{{ [<listItem>get[caption]addprefix[# ]] }}} emptyValue={{{ [<listItem>get[caption]addprefix[! ]] }}}>\\n<$let text={{{ [<listItem>get[text]] }}}>\\n<$action-setfield $tiddler=<<aggregateTitle>> text={{{ [<currentText>addsuffix<caption>addsuffix[\\n\\n]addsuffix<text>addsuffix[\\n\\n]] }}} type=<<type>>/>\\n</$let>\\n</$set>\\n</$list>\\n<$action-navigate $to=<<aggregateTitle>>/>\\n</$action-createtiddler>\\n\\\\end actions\\n<$button tooltip=\\\"Aggregating paragraphs into a single tiddler\\\" aria-label=\\\"aggregating paragraphs\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n<<actions>>\\n<span class=\\\"tc-btn-icon\\\">{{$:/xp/images/aggregation}}</span>\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=aggregate/>\\n</span>\\n</$button>\\n\\\\end aggregate-button\\n\\n\\\\procedure export-button()\\n\\\\procedure actions()\\n<$action-confirm $message=\\\"Are you sure you wish to export this paragraph aggregation?\\\">\\n<$action-sendmessage $message=\\\"tm-download-file\\\" $param=\\\"$:/core/templates/exporters/JsonFile\\\" exportFilter={{{ [<currentTiddler>] [prefix<pid>] +[format:titlelist[]join[ ]] }}} filename={{{ [<currentTiddler>addsuffix[.paras.json]] }}}/>\\n</$action-confirm>\\n\\\\end actions\\n<$button dragFilter=\\\"[<currentTiddler>] [prefix<pid>]\\\" tooltip=\\\"Export this paragraph aggregation\\\" aria-label=\\\"export this paragraph aggregation\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n<<actions>>\\n<span class=\\\"tc-btn-icon\\\">{{$:/core/images/export-button}}</span>\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=export/>\\n</span>\\n</$button>\\n\\\\end export-button\\n\\n\\\\procedure delete-button()\\n\\\\procedure actions()\\n<$action-confirm $message=\\\"Are you sure you wish to delete this paragraph aggregation?\\\">\\n<$action-deletetiddler $filter=\\\"[prefix<pid>] [<configTiddler>] [<readingMode>] [<sourceMode>]\\\"/>\\n</$action-confirm>\\n\\\\end actions\\n<$button tooltip=\\\"Delete this paragraph aggregation\\\" aria-label=\\\"delete this paragraph aggregation\\\" class=\\\"tc-btn-invisible tc-btn-mini\\\">\\n<<actions>>\\n<span class=\\\"tc-btn-icon\\\">{{$:/core/images/delete-button}}</span>\\n<span class=\\\"tc-btn-text\\\">\\n<$text text={{$:/language/Buttons/Delete/Caption}}/>\\n</span>\\n</$button>\\n\\\\end delete-button\\n\\n\\\\procedure more-actions-button()\\n<$button popup=<<qualify \\\"$:/state/paras/popup/more\\\">> tooltip={{$:/language/Buttons/More/Hint}} aria-label={{$:/language/Buttons/More/Caption}} class=<<tv-config-toolbar-class>> selectedClass=\\\"tc-selected\\\">\\n<span class=\\\"tc-btn-icon\\\">{{$:/core/images/down-arrow}}</span>\\n</$button>\\n<$reveal state=<<qualify \\\"$:/state/paras/popup/more\\\">> type=\\\"popup\\\" position=\\\"below\\\" animate=\\\"yes\\\">\\n\\n<div class=\\\"tc-drop-down\\\">\\n<<aggregate-button>>\\n<<export-button>>\\n<<delete-button>>\\n</div>\\n\\n</$reveal>\\n\\\\end more-actions-button\\n\\n\\n<div class=\\\"tc-sidebar-lists xp-float-right\\\">\\n<<substory-navigator \\\"<$let tv-config-toolbar-text=yes > <<new-paragraph-button>> </$let>\\\">>\\n</div>\\n\\n<$list filter=\\\"[list<SubStoryList>limit[1]]\\\" emptyMessage={{{ [<promptTiddler>get[text]] }}} variable=\\\"ignore\\\">\\n\\n<span class={{{ [[xp-search ]addsuffix<searchClass>] }}}>\\nSearch &#32;\\n<$select\\n  tiddler=<<configTiddler>>\\n  default=\\\"+[search:*<userInput>]\\\"\\n  tooltip=\\\"Choosing the Search Scope\\\"\\n  class=\\\"xp-aggregation-select\\\">\\n  <option value=\\\"+[search:*<userInput>]\\\"> all fields</option>\\n  <option value=\\\"+[search:*:literal,casesensitive<userInput>]\\\"> all exact match</option>\\n  <option value=\\\"+[search:-text<userInput>]\\\"> all except text</option>\\n  <option value=\\\"+[search<userInput>]\\\"> title text tags</option>\\n  <option value=\\\"+[search:title,caption<userInput>]\\\"> title caption</option>\\n</$select>\\n<i class='tc-small-gap-left'/>\\n<$macrocall\\n  $name=\\\"keyboard-driven-input\\\"\\n  tiddler=<<storeTitle>>\\n  type=\\\"search\\\"\\n  tag=\\\"input\\\"\\n  focus={{$:/config/xp/aggregation/SearchAutoFocus}}\\n  inputCancelActions=\\\"<$action-deletetiddler $tiddler=<<storeTitle>>/>\\\"\\n/>\\n</span>\\n<i class='tc-tiny-gap-left'/>\\n<span class=\\\"xp-search\\\">\\n<$reveal state=<<storeTitle>> type=\\\"nomatch\\\" text=\\\"\\\">\\n<$button class=\\\"tc-btn-invisible\\\">\\n<$action-deletetiddler $tiddler=<<storeTitle>>/>\\n{{$:/core/images/close-button}}\\n</$button>\\n</$reveal>\\n<<navigation-button>>\\n<<template-button>>\\n<<aggrbtn-reading-mode>>\\n<<aggrbtn-source>>\\n<$macrocall $name=\\\"aggrbtn-toc\\\" filter=<<searchFilter>>/>\\n<<more-actions-button>>\\n</span>\\n<$reveal state=<<storeTitle>> type=\\\"nomatch\\\" text=\\\"\\\">\\n<$let resultCount={{{ [subfilter<searchFilter>count[]] }}}>\\n<span class=\\\"xp-search-results\\\">{{$:/language/Search/System/Matches}}</span>\\n</$let>\\n</$reveal>\\n\\n<!-- Paragraph List -->\\n<$reveal state=<<readingMode>> type=\\\"nomatch\\\" text=\\\"on\\\" default=\\\"off\\\">\\n\\n<$transclude\\n  $variable=\\\"substory-navigator\\\"\\n  text=\\\"\\\"\\\"\\n<div class=\\\"tc-link-info\\\">\\n\\n<$list\\n  filter=<<searchFilter>>\\n  history=<<SubHistoryList>>\\n  template={{{ [<templateTiddler>has[text]get[text]] ~[[$:/templates/transclusion-paragraph]] }}}\\n  editTemplate={{{ [[$:/config/xp/aggregation-paragraphs/EditTemplate]has[text]get[text]] ~[{$:/config/ui/EditTemplate}] }}}\\n  storyview={{$:/config/xp/aggregation-paragraphs/view}}\\n/>\\n\\n</div>\\n\\\"\\\"\\\"\\n  catchlink=yes\\n  filter=\\\"[tag<pid>]\\\"\\n/>\\n\\n</$reveal>\\n\\n<!-- Reading Mode -->\\n<$reveal state=<<readingMode>> type=\\\"match\\\" text=\\\"on\\\" default=\\\"off\\\">\\n<$list filter=\\\"[subfilter<searchFilter>limit[1]]\\\" variable=\\\"ignore\\\">\\n\\n<$macrocall\\n  $name=\\\"aggregation-toc\\\"\\n  filter=<<searchFilter>>\\n  selectedTiddler=<<selectedTiddler>>\\n  template=<<tocTemplate>>\\n  sourceMode=<<sourceMode>>\\n  tocState=<<tocState>>\\n  navTiddler=<<currentTiddler>>\\n/>\\n\\n</$list>\\n</$reveal>\\n\\n</$list>\\n\\\\end paras\\n\"},\"$:/plugins/xp/aggregation-paragraphs/readme\":{\"title\":\"$:/plugins/xp/aggregation-paragraphs/readme\",\"text\":\"!! 段落聚合\\n\\n将段落聚合为一篇长文。通过这种「化零为整」的文章形式，让你能快速定位到一个目标段落。\\n\\n\\n!! 使用说明\\n\\n创建段落聚合的两种方式：\\n\\n# 使用创建按钮 $:/xp/ui/Buttons/new-paragraphs-tiddler。\\n# 调用 `paras` 宏。\\n#* 比如：`<<paras \\\"<state>\\\">>`。state 的值必须唯一，推荐使用时间戳（比如条目的创建时间）。\\n#* 可以指定文本类型：`<<paras \\\"<state>\\\" \\\"text/markdown\\\">>`。该段落聚合将使用 Markdown 格式。\\n\\n搜索框和控制按钮：\\n\\n<div style=\\\"line-height: 1.75;\\\">\\n\\n|Item |Description |h\\n|!<<.icon $:/core/images/advanced-search-button>> 搜索框 |根据需要，在前面的下拉框中选择搜索范围。 |\\n|!<<.icon $:/core/images/list-number>> 导航按钮 |导航到目标段落。可拖拽对段落进行排序。 |\\n|!<<.icon $:/xp/images/switch>> 视图按钮 |在两种视图之间切换。 |\\n|!<<.icon $:/core/images/preview-open>> 阅读模式 |开启阅读模式。右侧会出现两个按钮：<<.icon $:/xp/images/sourcemode>> Source 按钮阅读源代码；<<.icon $:/core/images/preview-open>> 浏览按钮隐藏 TOC。 |\\n|!<<.icon $:/xp/images/aggregation>> 聚合按钮 |将段落聚合为一个条目。 |\\n|!<<.icon $:/core/images/delete-button>> 删除按钮 |删除该段落聚合（不会删除宏调用）。 |\\n\\n</div>\\n\\n搜索全部段落：\\n\\n* 使用筛选表达式进行搜索，比如搜索 swaywm：`[prefix[$:/paras/]search:*:literal,casesensitive[swaywm]]`。\\n\\n\\n!! 实现思路\\n\\n* 通过 [[创建子故事|https://tiddlywiki.com/static/Creating%2520SubStories.html]] 实现交互界面。\\n* 使用 [[LinkCatcherWidget|https://tiddlywiki.com/static/LinkCatcherWidget.html]] 处理子故事中的链接：\\n** 非聚合条目将在主故事河中打开;\\n** 聚合条目则根据情况，在子故事或者主故事河中打开。\\n\\n\\n!! See also\\n\\nhttps://github.com/kookma/TW-Section\\n\"},\"$:/plugins/xp/aggregation-paragraphs/settings\":{\"title\":\"$:/plugins/xp/aggregation-paragraphs/settings\",\"text\":\"; Story View\\n: <$select\\n  tiddler=\\\"$:/config/xp/aggregation-paragraphs/view\\\"\\n  default=\\\"pop\\\"\\n  tooltip=\\\"Choosing the Story View\\\"\\n  class=\\\"xp-aggregation-select\\\">\\n  <option value=\\\"classic\\\"> classic</option>\\n  <option value=\\\"pop\\\"> pop</option>\\n</$select>\\n\\n\"},\"$:/xp/Snippets/stack\":{\"title\":\"$:/xp/Snippets/stack\",\"caption\":\"Stack\",\"tags\":\"$:/tags/TextEditor/Snippet\",\"text\":\"<<stack \\\"3\\\" state:\\\"state\\\"\\n\\n1:\\\"First\\\" 11:\\\"\\\"\\\"\\n\\n\\\"\\\"\\\"\\n\\n2:\\\"Second\\\" 22:\\\"\\\"\\\"\\n\\n\\\"\\\"\\\"\\n\\n3:\\\"Third\\\" 33:\\\"\\\"\\\"\\n\\n\\\"\\\"\\\"\\n>>\\n\"},\"$:/xp/Stylesheet/stack\":{\"title\":\"$:/xp/Stylesheet/stack\",\"tags\":\"$:/tags/XP $:/tags/Stylesheet\",\"text\":\".xp-stack {\\n\\t/* background: <<colour page-background>>; */\\n}\\n\\n.xp-stack-tabs {\\n}\\n\\n.xp-stack-radio {\\n}\\n\\n.xp-stack-btn {\\n\\tfont-size: .9em;\\n\\tbackground: <<colour tab-background>>;\\n\\tcolor: <<colour tab-foreground>>;\\n\\tfill: <<colour tab-foreground>>;\\n\\tborder: 1px solid <<colour tab-border>>;\\n\\tborder-radius: 3px 2em;\\n\\tpadding: 2px 1em;\\n\\tmargin-right: 2px;\\n}\\n\\n.xp-stack-selected-btn {\\n\\tbackground: <<colour tab-background-selected>>;\\n\\tcolor: <<colour tab-foreground-selected>>;\\n\\tfill: <<colour tab-foreground-selected>>;\\n}\\n\"},\"$:/xp/procedures/stack\":{\"title\":\"$:/xp/procedures/stack\",\"code-body\":\"yes\",\"tags\":\"$:/tags/Global\",\"text\":\"\\\\procedure stack(number,state:\\\"stack\\\",1,11,2,22,3,33,4,44,5,55,6,66)\\n\\\\whitespace trim\\n\\\\function id() [<currentTiddler>get[created]]\\n\\\\function stateTitle() [[$:/temp/stack/]addsuffix<id>addsuffix[/]addsuffix<state>]\\n\\\\function stateCode() [<stateTitle>get[text]] ~1\\n\\n\\\\procedure show-radio()\\n\\\\whitespace notrim\\n<div class=\\\"xp-stack-radio\\\">\\n<$tiddler tiddler=<<stateTitle>>>\\n<$list filter='[range<number>]' variable=num>\\n<$radio value=<<num>> default=1> <$text text={{{ [<num>getvariable[]] }}}/></$radio>\\n</$list>\\n</$tiddler>\\n</div>\\n\\\\end show-radio\\n\\n\\\\procedure show-btn()\\n<div class=\\\"xp-stack-tabs\\\">\\n<$list filter='[range<number>]' variable=num>\\n<$button class={{{ xp-stack-btn [<num>match<stateCode>then[xp-stack-selected-btn]] +[join[ ]] }}}>\\n<$text text={{{ [<num>getvariable[]] }}}/>\\n<$action-setfield $tiddler=<<stateTitle>> text=<<num>>/>\\n</$button>\\n</$list>\\n</div>\\n\\\\end show-btn\\n\\n<div class=\\\"xp-stack\\\">\\n<!-- Title -->\\n<<show-btn>>\\n\\n<!-- Body -->\\n<% if [<stateCode>match[1]] %>\\n\\n<<11>>\\n\\n<% elseif [<stateCode>match[2]] %>\\n\\n<<22>>\\n\\n<% elseif [<stateCode>match[3]] %>\\n\\n<<33>>\\n\\n<% elseif [<stateCode>match[4]] %>\\n\\n<<44>>\\n\\n<% elseif [<stateCode>match[5]] %>\\n\\n<<55>>\\n\\n<% elseif [<stateCode>match[6]] %>\\n\\n<<66>>\\n\\n<% endif %>\\n</div>\\n\\\\end stack\\n\"},\"$:/xp/aggregation-paragraphs/styles\":{\"title\":\"$:/xp/aggregation-paragraphs/styles\",\"tags\":\"$:/tags/Stylesheet\",\"text\":\"[data-tags*={{$:/config/xp/aggregation-paragraphs/Tags}}] {\\n\\tbackground: <<colour page-background>>;\\n\\tborder: 1px solid <<colour page-background>>;\\n\\t<<box-shadow \\\"none\\\">>\\n}\\n\\n[data-tags*={{$:/config/xp/aggregation-paragraphs/Tags}}] .tc-titlebar,\\n[data-tags*={{$:/config/xp/aggregation-paragraphs/Tags}}] .tc-tiddler-edit-title {\\n\\tbackground: <<colour page-background>>;\\n}\\n\"},\"$:/templates/transclusion-paragraph-evenodd\":{\"title\":\"$:/templates/transclusion-paragraph-evenodd\",\"text\":\"\\\\whitespace trim\\n\\\\define viewCodeState() $:/state/view-code/$(currentTiddler)$\\n\\n<div class=\\\"xp-aggregation-evenodd\\\">\\n\\n<h2>\\n<$let tv-wikilinks=\\\"no\\\">\\n<span class=\\\"tc-tiddler-title-icon\\\" style=\\\"fill:#bbb;\\\">\\n{{||$:/core/ui/TiddlerIcon}}\\n</span>\\n<$transclude field=\\\"caption\\\"><$view field=\\\"title\\\"/></$transclude>\\n</$let>\\n<span class=\\\"tc-tiddler-controls xp-aggregation-controls xp-aggregation-controls-phone\\\">\\n<<navigation-button>>\\n{{||$:/xp/ui/Buttons/view-code_Aggregation}}\\n{{||$:/core/ui/Buttons/delete}}\\n<$let tv-config-toolbar-text= > <<new-paragraph-button yes>> </$let>\\n{{||$:/core/ui/Buttons/edit}}\\n<$list filter=\\\"[all[current]!tag<pid>]\\\">{{||$:/core/ui/Buttons/close}}</$list>\\n</span>\\n</h2>\\n\\n<$reveal state=<<viewCodeState>> type=\\\"nomatch\\\" text=\\\"show\\\" retain=\\\"yes\\\" animate=\\\"yes\\\">\\n\\n<$transclude mode=\\\"block\\\"><p>Missing tiddler.</p></$transclude>\\n\\n</$reveal>\\n<$reveal state=<<viewCodeState>> type=\\\"match\\\" text=\\\"show\\\" animate=\\\"yes\\\" retain=\\\"yes\\\">\\n\\n<div style=\\\"position:relative;\\\">\\n<div class=\\\"tc-page-controls\\\" style=\\\"position:absolute;bottom:0;right:0;top:0;font-size:14px;margin:0;\\\">\\n<$button class=\\\"tc-btn-boxed\\\" style=\\\"padding:3px;border:none;\\\" message=\\\"tm-copy-to-clipboard\\\" param={{!!text}} tooltip={{$:/language/Buttons/CopyToClipboard/Hint}}>\\n{{$:/core/images/copy-clipboard}}\\n</$button>\\n</div>\\n</div>\\n{{||$:/core/ui/ViewTemplate/body/code}}\\n\\n</$reveal>\\n\\n</div>\"},\"$:/templates/transclusion-paragraph\":{\"title\":\"$:/templates/transclusion-paragraph\",\"text\":\"\\\\whitespace trim\\n\\\\define viewCodeState() $:/state/view-code/$(currentTiddler)$\\n\\n<div class=\\\"xp-aggregation-card\\\">\\n\\n<h2>\\n<$let tv-wikilinks=\\\"no\\\">\\n<span class=\\\"tc-tiddler-title-icon\\\" style=\\\"fill:#bbb;\\\">\\n{{||$:/core/ui/TiddlerIcon}}\\n</span>\\n<$transclude field=\\\"caption\\\"><$view field=\\\"title\\\"/></$transclude>\\n</$let>\\n<span class=\\\"tc-tiddler-controls xp-aggregation-controls xp-aggregation-controls-phone\\\">\\n<<navigation-button>>\\n{{||$:/xp/ui/Buttons/view-code_Aggregation}}\\n{{||$:/core/ui/Buttons/delete}}\\n<$let tv-config-toolbar-text= > <<new-paragraph-button yes>> </$let>\\n{{||$:/core/ui/Buttons/edit}}\\n<$list filter=\\\"[all[current]!tag<pid>]\\\">{{||$:/core/ui/Buttons/close}}</$list>\\n</span>\\n</h2>\\n\\n<$reveal state=<<viewCodeState>> type=\\\"nomatch\\\" text=\\\"show\\\" retain=\\\"yes\\\" animate=\\\"yes\\\">\\n\\n<$transclude mode=\\\"block\\\"><p>Missing tiddler.</p></$transclude>\\n\\n</$reveal>\\n<$reveal state=<<viewCodeState>> type=\\\"match\\\" text=\\\"show\\\" animate=\\\"yes\\\" retain=\\\"yes\\\">\\n\\n<div style=\\\"position:relative;\\\">\\n<div class=\\\"tc-page-controls\\\" style=\\\"position:absolute;bottom:0;right:0;top:0;font-size:14px;margin:0;\\\">\\n<$button class=\\\"tc-btn-boxed\\\" style=\\\"padding:3px;border:none;\\\" message=\\\"tm-copy-to-clipboard\\\" param={{!!text}} tooltip={{$:/language/Buttons/CopyToClipboard/Hint}}>\\n{{$:/core/images/copy-clipboard}}\\n</$button>\\n</div>\\n</div>\\n{{||$:/core/ui/ViewTemplate/body/code}}\\n\\n</$reveal>\\n\\n</div>\"},\"$:/xp/ui/Buttons/new-paragraphs-tiddler\":{\"title\":\"$:/xp/ui/Buttons/new-paragraphs-tiddler\",\"caption\":\"{{$:/core/images/new-button}} new paragraphs tiddler\",\"description\":\"Create a paragraphs tiddler\",\"text\":\"\\\\whitespace trim\\n<$button tooltip=\\\"Create a paragraphs tiddler\\\" aria-label=\\\"new paragraphs tiddler\\\" class=<<tv-config-toolbar-class>>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n{{$:/core/images/new-button}}\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">\\nnew paragraphs tiddler\\n</span>\\n</$list>\\n<$action-sendmessage $message=\\\"tm-new-tiddler\\\"\\ntags={{$:/config/xp/aggregation-paragraphs/Tags}}\\ntext={{{ [<now \\\"[UTC]YYYY0MM0DD0hh0mm0ssXXX\\\">addprefix[<<paras \\\"]addsuffix[\\\">>]] }}}\\n/>\\n</$button>\\n\"},\"$:/xp/aggregation-paragraphs/ui/EditTemplate/fields\":{\"title\":\"$:/xp/aggregation-paragraphs/ui/EditTemplate/fields\",\"text\":\"\\\\define lingo-base() $:/language/EditTemplate/\\n\\n\\\\define hidden-fields()\\nbag caption created creator draft.of draft.title modified modifier revision tags text title tmap.id type\\n\\\\end\\n\\n<!-- Beware this is duplicated from EditTemplate.tid. For details see bug #7054 -->\\n\\\\define get-field-value-tiddler-filter() [subfilter<get-field-editor-filter>sha256[16]addprefix[/]addprefix<newFieldValueTiddlerPrefix>]\\n\\\\define get-field-editor-filter() [<newFieldNameTiddler>get[text]else[]] :cascade[all[shadows+tiddlers]tag[$:/tags/FieldEditorFilter]!is[draft]get[text]] :and[!is[blank]else{$:/core/ui/EditTemplate/fieldEditor/default}]\\n\\n\\\\define current-tiddler-new-field-selector()\\n[data-tiddler-title=\\\"$(currentTiddlerCSSescaped)$\\\"] .tc-edit-field-add-name-wrapper input\\n\\\\end\\n\\n\\\\define new-field-actions()\\n\\\\whitespace trim\\n<$action-sendmessage $message=\\\"tm-add-field\\\" $name={{{ [<newFieldNameTiddler>get[text]] }}} $value={{{ [<newFieldNameTiddler>get[text]] :map[subfilter<get-field-value-tiddler-filter>get[text]] }}}/>\\n<$set name=\\\"safeNewFieldValueTiddlerPrefix\\\" value=<<newFieldValueTiddlerPrefix>> emptyValue=<<qualify \\\"$:/temp/NewFieldValue\\\">> >\\n\\t<$action-deletetiddler $filter=\\\"[<newFieldNameTiddler>] [prefix[$:/temp/NewFieldValue]prefix<safeNewFieldValueTiddlerPrefix>] [<storeTitle>] [<searchListState>]\\\"/>\\n</$set>\\n<$action-sendmessage $message=\\\"tm-focus-selector\\\" $param=<<current-tiddler-new-field-selector>>/>\\n\\\\end\\n\\n\\\\define delete-state-tiddlers() <$action-deletetiddler $filter=\\\"[<newFieldNameTiddler>] [<storeTitle>] [<searchListState>]\\\"/>\\n\\n\\\\define cancel-search-actions-inner()\\n\\\\whitespace trim\\n<$list\\n\\tfilter=\\\"[<storeTitle>has[text]] [<newFieldNameTiddler>has[text]]\\\"\\n\\tvariable=\\\"ignore\\\"\\n\\temptyMessage=\\\"<<cancel-delete-tiddler-actions 'cancel'>>\\\">\\n<<delete-state-tiddlers>>\\n</$list>\\n\\\\end\\n\\n\\\\define cancel-search-actions()\\n\\\\whitespace trim\\n<$set name=\\\"userInput\\\" value={{{ [<storeTitle>get[text]] }}}>\\n<$list\\n\\tfilter=\\\"[<newFieldNameTiddler>get[text]!match<userInput>]\\\"\\n\\temptyMessage=\\\"<<cancel-search-actions-inner>>\\\">\\n<$action-setfield $tiddler=<<newFieldNameTiddler>> text=<<userInput>>/><$action-setfield $tiddler=<<refreshTitle>> text=\\\"yes\\\"/>\\n</$list>\\n</$set>\\n\\\\end\\n\\n\\\\define new-field()\\n\\\\whitespace trim\\n<$vars name={{{ [<newFieldNameTiddler>get[text]] }}}>\\n<$reveal type=\\\"nomatch\\\" text=\\\"\\\" default=<<name>>>\\n<$button tooltip=<<lingo Fields/Add/Button/Hint>>>\\n<$action-sendmessage $message=\\\"tm-add-field\\\"\\n$name=<<name>>\\n$value={{{ [subfilter<get-field-value-tiddler-filter>get[text]] }}}/>\\n<$set name=\\\"safeNewFieldValueTiddlerPrefix\\\" value=<<newFieldValueTiddlerPrefix>> emptyValue=<<qualify \\\"$:/temp/NewFieldValue\\\">> >\\n\\t<$action-deletetiddler $filter=\\\"[<newFieldNameTiddler>] [prefix[$:/temp/NewFieldValue]prefix<safeNewFieldValueTiddlerPrefix>] [<storeTitle>] [<searchListState>]\\\"/>\\n</$set>\\n<<lingo Fields/Add/Button>>\\n</$button>\\n</$reveal>\\n<$reveal type=\\\"match\\\" text=\\\"\\\" default=<<name>>>\\n<$button>\\n<<lingo Fields/Add/Button>>\\n</$button>\\n</$reveal>\\n</$vars>\\n\\\\end\\n\\\\whitespace trim\\n\\n<$set name=\\\"newFieldValueTiddlerPrefix\\\" value=<<newFieldValueTiddlerPrefix>> emptyValue=<<qualify \\\"$:/temp/NewFieldValue\\\">> >\\n<div class=\\\"tc-edit-fields\\\">\\n<table class={{{ [all[current]fields[]remove<hidden-fields>] +[count[]!match[0]] +[then[tc-edit-fields]] ~[[tc-edit-fields tc-edit-fields-small]] }}}>\\n<tbody>\\n<$list filter=\\\"[all[current]fields[]remove<hidden-fields>] +[sort[title]]\\\" variable=\\\"currentField\\\" storyview=\\\"pop\\\">\\n<tr class=\\\"tc-edit-field\\\">\\n<td class=\\\"tc-edit-field-name\\\">\\n<$text text=<<currentField>>/>:</td>\\n<td class=\\\"tc-edit-field-value\\\">\\n<$keyboard key=\\\"((delete-field))\\\" actions=\\\"\\\"\\\"<$action-deletefield $field=<<currentField>>/><$set name=\\\"currentTiddlerCSSescaped\\\" value={{{ [<currentTiddler>escapecss[]] }}}><$action-sendmessage $message=\\\"tm-focus-selector\\\" $param=<<current-tiddler-new-field-selector>>/></$set>\\\"\\\"\\\">\\n<$transclude tiddler={{{ [<currentField>] :cascade[all[shadows+tiddlers]tag[$:/tags/FieldEditorFilter]!is[draft]get[text]] :and[!is[blank]else{$:/core/ui/EditTemplate/fieldEditor/default}] }}} />\\n</$keyboard>\\n</td>\\n<td class=\\\"tc-edit-field-remove\\\">\\n<$button class=\\\"tc-btn-invisible\\\" tooltip={{$:/language/EditTemplate/Field/Remove/Hint}} aria-label={{$:/language/EditTemplate/Field/Remove/Caption}}>\\n<$action-deletefield $field=<<currentField>>/><$set name=\\\"currentTiddlerCSSescaped\\\" value={{{ [<currentTiddler>escapecss[]] }}}><$action-sendmessage $message=\\\"tm-focus-selector\\\" $param=<<current-tiddler-new-field-selector>>/></$set>\\n{{$:/core/images/delete-button}}\\n</$button>\\n</td>\\n</tr>\\n</$list>\\n</tbody>\\n</table>\\n</div>\\n\\n<$fieldmangler>\\n<div class=\\\"tc-edit-field-add\\\">\\n<em class=\\\"tc-edit tc-small-gap-right\\\">\\n<<lingo Fields/Add/Prompt>>\\n</em>\\n<$vars refreshTitle=<<qualify \\\"$:/temp/fieldname/refresh\\\">> storeTitle=<<newFieldNameInputTiddler>> searchListState=<<newFieldNameSelectionTiddler>>>\\n<div class=\\\"tc-edit-field-add-name-wrapper\\\">\\n<$macrocall $name=\\\"keyboard-driven-input\\\" tiddler=<<newFieldNameTiddler>> storeTitle=<<storeTitle>> refreshTitle=<<refreshTitle>>\\n\\t\\tselectionStateTitle=<<searchListState>> tag=\\\"input\\\" default=\\\"\\\" placeholder={{$:/language/EditTemplate/Fields/Add/Name/Placeholder}}\\n\\t\\tfocusPopup=<<qualify \\\"$:/state/popup/field-dropdown\\\">> class=\\\"tc-edit-texteditor tc-popup-handle\\\" tabindex={{$:/config/EditTabIndex}}\\n\\t\\tfocus={{{ [{$:/config/AutoFocus}match[fields]then[true]] ~[[false]] }}} cancelPopups=\\\"yes\\\"\\n\\t\\tconfigTiddlerFilter=\\\"[[$:/config/EditMode/fieldname-filter]]\\\" inputCancelActions=<<cancel-search-actions>> />\\n<$button popup=<<qualify \\\"$:/state/popup/field-dropdown\\\">> class=\\\"tc-btn-invisible tc-btn-dropdown tc-small-gap\\\" tooltip={{$:/language/EditTemplate/Field/Dropdown/Hint}} aria-label={{$:/language/EditTemplate/Field/Dropdown/Caption}}>{{$:/core/images/down-arrow}}</$button>\\n<$reveal state=<<qualify \\\"$:/state/popup/field-dropdown\\\">> type=\\\"nomatch\\\" text=\\\"\\\" default=\\\"\\\">\\n<div class=\\\"tc-block-dropdown tc-edit-type-dropdown\\\">\\n<$set name=\\\"tv-show-missing-links\\\" value=\\\"yes\\\">\\n<$linkcatcher to=<<newFieldNameTiddler>>>\\n<div class=\\\"tc-dropdown-item\\\">\\n<<lingo Fields/Add/Dropdown/User>>\\n</div>\\n<$set name=\\\"newFieldName\\\" value={{{ [<storeTitle>get[text]] }}}>\\n<$list filter=\\\"[!is[shadow]!is[system]fields[]search:title<newFieldName>sort[]] -created -creator -draft.of -draft.title -modified -modifier -tags -text -title -type\\\"  variable=\\\"currentField\\\">\\n<$list filter=\\\"[<currentField>addsuffix[-primaryList]] -[<searchListState>get[text]]\\\" emptyMessage=\\\"\\\"\\\"<$link to=<<currentField>> class=\\\"tc-list-item-selected\\\"><$text text=<<currentField>>/></$link>\\\"\\\"\\\">\\n<$link to=<<currentField>>>\\n<$text text=<<currentField>>/>\\n</$link>\\n</$list>\\n</$list>\\n<div class=\\\"tc-dropdown-item\\\">\\n<<lingo Fields/Add/Dropdown/System>>\\n</div>\\n<$list filter=\\\"[fields[]search:title<newFieldName>sort[]] -[!is[shadow]!is[system]fields[]]\\\" variable=\\\"currentField\\\">\\n<$list filter=\\\"[<currentField>addsuffix[-secondaryList]] -[<searchListState>get[text]]\\\" emptyMessage=\\\"\\\"\\\"<$link to=<<currentField>> class=\\\"tc-list-item-selected\\\"><$text text=<<currentField>>/></$link>\\\"\\\"\\\">\\n<$link to=<<currentField>>>\\n<$text text=<<currentField>>/>\\n</$link>\\n</$list>\\n</$list>\\n</$set>\\n</$linkcatcher>\\n</$set>\\n</div>\\n</$reveal>\\n</div>\\n<$let currentTiddlerCSSescaped={{{ [<currentTiddler>escapecss[]] }}} currentTiddler={{{ [subfilter<get-field-value-tiddler-filter>] }}} currentField=\\\"text\\\" currentFieldName={{{ [<newFieldNameTiddler>get[text]] }}}>\\n<span class=\\\"tc-edit-field-add-value tc-small-gap-right\\\">\\n<$keyboard key=\\\"((add-field))\\\" actions=<<new-field-actions>>>\\n<$transclude tiddler={{{ [subfilter<get-field-editor-filter>] }}} />\\n</$keyboard>\\n</span>\\n<span class=\\\"tc-edit-field-add-button\\\">\\n<$macrocall $name=\\\"new-field\\\"/>\\n</span>\\n</$let>\\n</$vars>\\n</div>\\n</$fieldmangler>\\n</$set>\"},\"$:/xp/aggregation-paragraphs/ui/EditTemplate\":{\"title\":\"$:/xp/aggregation-paragraphs/ui/EditTemplate\",\"code-body\":\"yes\",\"text\":\"\\\\define delete-edittemplate-state-tiddlers()\\n<$set name=\\\"safeNewFieldValueTiddlerPrefix\\\" value=<<newFieldValueTiddlerPrefix>> emptyValue=<<qualify \\\"$:/temp/NewFieldValue\\\">> >\\n\\t<$action-deletetiddler $filter=\\\"[<newFieldNameTiddler>] [prefix[$:/temp/NewFieldValue]prefix<safeNewFieldValueTiddlerPrefix>] [<newFieldNameInputTiddler>] [<newFieldNameSelectionTiddler>] [<newTagNameTiddler>] [<newTagNameInputTiddler>] [<newTagNameSelectionTiddler>] [<typeInputTiddler>] [<typeSelectionTiddler>]\\\"/>\\n</$set>\\n\\\\end\\n\\n<!-- Beware this is duplicated from fields.tid. For details see bug #7054 -->\\n\\\\define get-field-value-tiddler-filter() [subfilter<get-field-editor-filter>sha256[16]addprefix[/]addprefix<newFieldValueTiddlerPrefix>]\\n\\\\define get-field-editor-filter() [<newFieldNameTiddler>get[text]else[]] :cascade[all[shadows+tiddlers]tag[$:/tags/FieldEditorFilter]!is[draft]get[text]] :and[!is[blank]else{$:/core/ui/EditTemplate/fieldEditor/default}]\\n\\n\\\\define save-tiddler-actions()\\n\\\\whitespace trim\\n<$action-sendmessage $message=\\\"tm-add-tag\\\" $param={{{ [<newTagNameTiddler>get[text]] }}}/>\\n<$action-sendmessage $message=\\\"tm-add-field\\\" $name={{{ [<newFieldNameTiddler>get[text]] }}} $value={{{ [<newFieldNameTiddler>get[text]] :map[subfilter<get-field-value-tiddler-filter>get[text]] }}}/>\\n<<delete-edittemplate-state-tiddlers>>\\n<$action-sendmessage $message=\\\"tm-save-tiddler\\\"/>\\n\\\\end\\n\\n\\\\define cancel-delete-tiddler-actions(message)\\n\\\\whitespace trim\\n<<delete-edittemplate-state-tiddlers>>\\n<$action-sendmessage $message=\\\"tm-$message$-tiddler\\\"/>\\n\\\\end\\n\\n\\\\whitespace trim\\n<div\\n\\tdata-tiddler-title=<<currentTiddler>>\\n\\tdata-tags={{!!tags}}\\n\\tclass={{{ [all[shadows+tiddlers]tag[$:/tags/ClassFilters/TiddlerTemplate]!is[draft]] :map:flat[subfilter{!!text}] tc-tiddler-frame tc-tiddler-edit-frame [<currentTiddler>is[tiddler]then[tc-tiddler-exists]] [<currentTiddler>is[missing]!is[shadow]then[tc-tiddler-missing]] [<currentTiddler>is[shadow]then[tc-tiddler-exists tc-tiddler-shadow]] [<currentTiddler>is[system]then[tc-tiddler-system]] [{!!class}] [<currentTiddler>tags[]encodeuricomponent[]addprefix[tc-tagged-]] +[join[ ]] }}}\\n\\trole=\\\"region\\\"\\n\\taria-label={{$:/language/EditTemplate/Caption}}>\\n<$fieldmangler>\\n<$vars\\n\\tstoryTiddler=<<currentTiddler>>\\n\\tnewTagNameTiddler=<<qualify \\\"$:/temp/NewTagName\\\">>\\n\\tnewFieldNameTiddler=<<qualify \\\"$:/temp/NewFieldName\\\">>\\n\\tnewFieldValueTiddlerPrefix=<<qualify \\\"$:/temp/NewFieldValue\\\">>\\n\\tnewFieldNameInputTiddler=<<qualify \\\"$:/temp/NewFieldName/input\\\">>\\n\\tnewFieldNameSelectionTiddler=<<qualify \\\"$:/temp/NewFieldName/selected-item\\\">>\\n\\tnewTagNameInputTiddler=<<qualify \\\"$:/temp/NewTagName/input\\\">>\\n\\tnewTagNameSelectionTiddler=<<qualify \\\"$:/temp/NewTagName/selected-item\\\">>\\n\\ttypeInputTiddler=<<qualify \\\"$:/temp/Type/input\\\">>\\n\\ttypeSelectionTiddler=<<qualify \\\"$:/temp/Type/selected-item\\\">>>\\n<$keyboard key=\\\"((cancel-edit-tiddler))\\\" actions=<<cancel-delete-tiddler-actions \\\"cancel\\\">> tag=\\\"div\\\">\\n<$keyboard key=\\\"((save-tiddler))\\\" actions=<<save-tiddler-actions>> tag=\\\"div\\\">\\n<$list filter=\\\"$:/core/ui/EditTemplate/controls\\n$:/xp/aggregation/ui/EditTemplate/caption\\n$:/core/ui/EditTemplate/shadow\\n$:/core/ui/ViewTemplate/classic\\n$:/core/ui/EditTemplate/body\\n$:/xp/aggregation-paragraphs/ui/EditTemplate/fields\\n\\\" variable=\\\"listItem\\\">\\n<$transclude tiddler=<<listItem>>/>\\n</$list>\\n</$keyboard>\\n</$keyboard>\\n</$vars>\\n</$fieldmangler>\\n</div>\\n\"}}}"}