{"author":"LinOnetwo","core-version":">=5.1.22","dependents":"","description":"Tree style tag picker","list":"readme tree","plugin-type":"plugin","text":"{\"tiddlers\":{\"$:/plugins/linonetwo/tag-tree-picker-macro/readme\":{\"title\":\"$:/plugins/linonetwo/tag-tree-picker-macro/readme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"!! Macro usage\\n\\nThis traditional tag list will show tags in a line:\\n\\n```tw5\\n<$vars currentTiddler=\\\"$:/plugins/linonetwo/tw-calendar/settings/frequently-used-tags\\\" tagField=\\\"text\\\">\\n\\t{{||$:/core/ui/EditTemplate/tags}}\\n</$vars>\\n```\\n\\nBut this plugin provides a `tag-tree-picker` macro to show tags in a tree:\\n\\n```tw5\\n<$transclude\\n\\t$variable=\\\"tag-tree-picker\\\"\\n\\ttags={{TiddlerWithListOfTags}}\\n/>\\n```\\n\\n`tags` parameter receive a list of tiddler name, if those tiddlers have tree relationship, show then as tree.\\n\\nTo make click-on-it work, you need to define `tag-tree-button-action` macro in the context, this is work as a `onClick` callback action:\\n\\n```tw5\\n<!-- Use this to make tags work as link -->\\n\\\\define tag-tree-button-action(tagName)\\n<$action-navigate $to=\\\"$tagName$\\\" />\\n\\\\end\\n\\n<!-- Use this to make it work as normal tag picker, using targetTiddler variable. -->\\n\\\\define tag-tree-button-action(tagName)\\n<$action-listops $tags=\\\"[[$tagName$]]\\\" $tiddler=\\\"\\\"\\\"$(targetTiddler)$\\\"\\\"\\\" />\\n\\\\end\\n\\n<!-- Same tag picker as above, but add tags to Index tiddler. -->\\n\\\\define tag-tree-button-action(tagName)\\n<$action-listops $tags=\\\"[[$tagName$]]\\\" $tiddler=\\\"Index\\\" />\\n\\\\end\\n```\\n\\nNote that tags in this tree are buttons, so action is not \\\"add tag to currentTiddler\\\" by default, you need to define the onClick action you want.\\n\\n!! Example\\n\\nA tag picker\\n\\n```tw5\\n\\\\define tag-tree-button-action(tagName)\\n<$action-listops $tags=\\\"[[$tagName$]]\\\" $tiddler=\\\"\\\"\\\"$(targetTiddler)$\\\"\\\"\\\" />\\n\\\\end\\n\\n\\\\define empty-list-help-text()\\n<p class=\\\"tw-calendar-empty-list-help-text\\\">\\nYou can goto <a href=\\\"/#%24%3A%2Fplugins%2Flinonetwo%2Ftw-calendar%2Ftiddlywiki-ui%2FControlPanel%2FSettings\\\">Plugin Setting</a> in control panel or plugin page, add frequently used tags here.\\n</p>\\n\\\\end\\n\\n<div class=\\\"tw-calendar-frequently-used-tags\\\">\\n  <$let targetTiddler=<<currentTiddler>> >\\n    <$list filter=\\\"[list[$:/plugins/linonetwo/tw-calendar/settings/frequently-used-tags!!text]first[]then[yes]]\\\" storyview=\\\"pop\\\" emptyMessage=<<empty-list-help-text>>>\\n      <div class=\\\"tc-edit-tags\\\">\\n        <$transclude\\n          $variable=\\\"input-only-tag-tree\\\"\\n          tags={{$:/plugins/linonetwo/tw-calendar/settings/frequently-used-tags}}\\n        />\\n      </div>\\n    </$list>\\n  </$let>\\n</div>\\n```\\n\\n[img[Screenshot1.png]]\\n\\n[img[Screenshot2.png]]\\n\"},\"$:/plugins/linonetwo/tw-calendar/style.css\":{\"title\":\"$:/plugins/linonetwo/tw-calendar/style.css\",\"creator\":\"LinOnetwo\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\".linonetwo-tag-tree-picker-macro button {\\n  border: 0;\\n  cursor: pointer;\\n}\"},\"$:/plugins/linonetwo/tag-tree-picker-macro/tree\":{\"title\":\"$:/plugins/linonetwo/tag-tree-picker-macro/tree\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<<tree prefix:\\\"$:/plugins/linonetwo/tag-tree-picker-macro/\\\">>\"},\"$:/plugins/linonetwo/tag-tree-picker-macro/tagTreeMacro.js\":{\"title\":\"$:/plugins/linonetwo/tag-tree-picker-macro/tagTreeMacro.js\",\"type\":\"application/javascript\",\"module-type\":\"macro\",\"tags\":\"$:/tags/Macro\",\"Modern.TiddlyDev#Origin\":\"tagTreeMacro.ts\",\"text\":\"\\\"use strict\\\";exports.name=\\\"tag-tree-picker\\\",exports.params=[{name:\\\"tags\\\"}];var textMacros=`\\n\\\\\\\\define tag-styles()\\nbackground-color:$(backgroundColor)$;\\nfill:$(foregroundColor)$;\\ncolor:$(foregroundColor)$;\\n\\\\\\\\end\\n\\n\\\\\\\\define tag-body-inner(colour,fallbackTarget,colourA,colourB,icon)\\n\\\\\\\\whitespace trim\\n<$vars foregroundColor=<<contrastcolour target:\\\"\\\"\\\"$colour$\\\"\\\"\\\" fallbackTarget:\\\"\\\"\\\"$fallbackTarget$\\\"\\\"\\\" colourA:\\\"\\\"\\\"$colourA$\\\"\\\"\\\" colourB:\\\"\\\"\\\"$colourB$\\\"\\\"\\\">> backgroundColor=\\\"\\\"\\\"$colour$\\\"\\\"\\\">\\n  <$button class=\\\"tc-tag-label\\\" style=<<tag-styles>>>\\n    <$transclude $variable=\\\"tag-tree-button-action\\\" tagName=<<currentTiddler>> />\\n    <$transclude tiddler=\\\"\\\"\\\"$icon$\\\"\\\"\\\"/>\\n    <$transclude field=\\\"caption\\\">\\n      <$view field=\\\"title\\\"/>\\n    </$transclude>\\n  </$button>\\n</$vars>\\n\\\\\\\\end\\n`;function buildTocWithOfferedTiddlers(r,l){var e=$tw.wiki.filterTiddlers(`[tag[${r}]]`),t=null!=(t=$tw.wiki.getTiddlerText(\\\"$:/palette\\\"))?t:\\\"$:/palettes/Vanilla\\\",t=`\\n  <$let\\n    currentTiddler=\\\"${r}\\\"\\n    icon={{{ [[${r}]] :cascade[all[shadows+tiddlers]tag[$:/tags/TiddlerIconFilter]!is[draft]get[text]] }}}\\n    fallbackTarget={{${t}##tag-background}}\\n    colourA={{${t}##foreground}}\\n    colourB={{${t}##background}}\\n    colour={{{ [[${r}]] :cascade[all[shadows+tiddlers]tag[$:/tags/TiddlerColourFilter]!is[draft]get[text]] }}}\\n  >\\n    <$macrocall $name=\\\"tag-body-inner\\\" colour=<<colour>> fallbackTarget=<<fallbackTarget>> colourA=<<colourA>> colourB=<<colourB> icon=<<icon>>/>\\n  </$let>`;return 0===e.length?t:t+`\\n  <ul>\\n\\t${e.filter(r=>l.includes(r)).map(r=>`<li>${buildTocWithOfferedTiddlers(r,l)}</li>`).join(\\\"\\\")}\\n\\t</ul>`}exports.run=function(r=\\\"\\\"){const e=$tw.utils.parseStringArray(r).filter(r=>0<r.length);var l=e.filter(r=>{var l=$tw.wiki.getTiddler(r);return void 0===l||!(null!=(l=l.fields.tags)?l:[]).some(r=>e.includes(r))});return 0===l.length?\\\"\\\":`${textMacros}<ul class=\\\"linonetwo-tag-tree-picker-macro\\\">\\n    ${l.map(r=>buildTocWithOfferedTiddlers(r,e)).map(r=>`<li>${r}</li>`).join(\\\"\\\")}\\n    </ul>`};\"}}}","title":"$:/plugins/linonetwo/tag-tree-picker-macro","type":"application/json","version":"0.0.1","Modern.TiddlyDev#SHA256-Hashed":"67c583d89b6cb209e4fb1d8f83b90062a304a9b297497f96eb3ed557f4c72c38","name":"tag-tree-picker-macro"}