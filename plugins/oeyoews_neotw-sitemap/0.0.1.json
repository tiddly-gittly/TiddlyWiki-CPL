{"title":"$:/plugins/oeyoews/neotw-sitemap","description":"neotw-sitemap","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"neotw-sitemap","meat#disabled":"yes","qrcode":"yes","created":"2024-03-16","dependents":"","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-sitemap/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-sitemap/readme\",\"text\":\"<!-- plugin template readme -->\\n\\n> based on dullroar/sitemap tiddlywiki plugin, fix filter typo, and standard plugin\\n\\n## Recipes\\n\\n```html\\n<!-- tiddlywiki.info -->\\nsitemap: [\\n    '--output',\\n    'public',\\n    '--render',\\n    '$:/plugins/oeyoews/neotw-sitemap/sitemap',\\n    'sitemap.xml',\\n    'text/plain',\\n    <!-- optional -->\\n    <!-- 'exportFilter',\\n    '[!is[system]]' -->\\n  ]\\n```\\n\\n\\n## Motivation\\n\\n<!-- your plugin motivation, or why you write this plugin -->\\n\",\"type\":\"text/markdown\",\"description\":\"neotw-sitemap\"},\"$:/plugins/oeyoews/neotw-sitemap/sitemapentries.js\":{\"title\":\"$:/plugins/oeyoews/neotw-sitemap/sitemapentries.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-sitemap/sitemapentries.js\\ntype: application/javascript\\nmodule-type: macro\\n\\nMacro to output tiddlers matching a filter to sitemap.xml entries.\\nhttp://www.sitemaps.org/protocol.html\\n\\n\\\\*/\\n\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  exports.name = 'sitemapentries';\\n\\n  exports.params = [{ name: 'filter' }];\\n\\n  let XML = {};\\n\\n  XML.escapify = function (input) {\\n    return input\\n      .replace(/</gm, '&lt;')\\n      .replace(/>/gm, '&gt;')\\n      .replace(/&/gm, '&amp;')\\n      .replace(/\\\"/gm, '&quot;')\\n      .replace(/'/gm, '&apos;');\\n  };\\n\\n  XML.twDateToWebDate = function (twDate) {\\n    return $tw.utils.formatDateString(twDate, 'YYYY-0MM-0DD');\\n  };\\n\\n  XML.stringify = function (data) {\\n    let x = '';\\n    data.forEach(function (element, index, array) {\\n      x += '\\\\t<url>\\\\n';\\n      const server = $tw.wiki.getTiddlerText(\\n        '$:/plugins/oeyoews/neotw-sitemap/site',\\n      );\\n      if (!server) {\\n        console.info(\\n          'sitemapentries.js: $:/plugins/oeyoews/neotw-sitemap/site not set',\\n        );\\n      }\\n      x += `\\\\t\\\\t<loc>${server}#:${element.title.replace(/ /g, '%2520')}</loc>\\\\n`;\\n      if (element.modified) {\\n        x +=\\n          '\\\\t\\\\t<lastmod>' +\\n          XML.twDateToWebDate($tw.utils.parseDate(element.modified)) +\\n          '</lastmod>\\\\n';\\n      }\\n      x += '\\\\t\\\\t<changefreq>';\\n      if (\\n        element.title.toLowerCase() === 'index' ||\\n        element.title.toLowerCase() === 'home'\\n      ) {\\n        x += 'weekly';\\n      } else {\\n        x += 'monthly';\\n      }\\n      x += '</changefreq>\\\\n';\\n      x += '\\\\t\\\\t<priority>';\\n      if (\\n        element.title.toLowerCase() === 'index' ||\\n        element.title.toLowerCase() === 'home'\\n      ) {\\n        x += '1.0';\\n      } else if (element.color !== undefined) {\\n        x += '0.8';\\n      } else {\\n        x += '0.5';\\n      }\\n      x += '</priority>\\\\n';\\n      x += '\\\\t</url>\\\\n';\\n    });\\n    return x;\\n  };\\n\\n  exports.run = function (filter) {\\n    const tiddlers = this.wiki.filterTiddlers(filter);\\n    const data = [];\\n    for (let t = 0; t < tiddlers.length; t++) {\\n      const tiddler = this.wiki.getTiddler(tiddlers[t]);\\n      if (tiddler) {\\n        const fields = {};\\n        for (const field in tiddler.fields) {\\n          fields[field] = XML.escapify(tiddler.getFieldString(field));\\n        }\\n        data.push(fields);\\n      }\\n    }\\n    return XML.stringify(data);\\n  };\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"macro\"},\"$:/plugins/oeyoews/neotw-sitemap/render\":{\"title\":\"$:/plugins/oeyoews/neotw-sitemap/render\",\"extension\":\".xml\",\"text\":\"<!-- tags: $:/tags/Exporter -->\\n\\n\\\\define renderContent()\\n<$text text=<<sitemapentries filter:\\\"\\\"\\\"$(exportFilter)$\\\"\\\"\\\">>/>\\n\\\\end\\n<<renderContent>>\"},\"$:/plugins/oeyoews/neotw-sitemap/site\":{\"title\":\"$:/plugins/oeyoews/neotw-sitemap/site\",\"text\":\"https://tiddlywiki-starter-kit.oeyoews.top\"},\"$:/plugins/oeyoews/neotw-sitemap/sitemap\":{\"title\":\"$:/plugins/oeyoews/neotw-sitemap/sitemap\",\"hide-body\":\"yes\",\"text\":\"\\\\define tv-wikilink-template() #$uri_encoded$\\n\\\\define tv-config-toolbar-icons() no\\n\\\\define tv-config-toolbar-text() no\\n\\\\define tv-config-toolbar-class() tc-btn-invisible\\n\\n`<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<urlset xmlns=\\\"http://www.sitemaps.org/schemas/sitemap/0.9\\\">`\\n<$set name=\\\"exportFilter\\\" value=\\\"[!is[system]!title[Table of Contents]!sort[modified]]\\\">\\n{{$:/plugins/oeyoews/neotw-sitemap/render}}\\n</$set>`\\n</urlset>`\"}}}"}