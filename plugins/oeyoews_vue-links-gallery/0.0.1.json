{"title":"$:/plugins/oeyoews/vue-links-gallery","description":"vue-links-gallery","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"vue-links-gallery","meat#disabled":"yes","qrcode":"yes","created":"2024-03-06","dependents":"","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/vue-links-gallery/readme\":{\"title\":\"$:/plugins/oeyoews/vue-links-gallery/readme\",\"text\":\"<!-- plugin template readme -->\\n\\n## Motivation\\n\\n<!-- your plugin motivation, or why you write this plugin -->\\n\",\"type\":\"text/markdown\",\"description\":\"vue-links-gallery\"},\"$:/plugins/oeyoews/vue-links-gallery/component.js\":{\"title\":\"$:/plugins/oeyoews/vue-links-gallery/component.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/vue-links-gallery/component.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\n\\nconst { reactive, toRaw, computed, ref } = window.Vue;\\n\\nconst randomString = () => {\\n  return Math.random().toString(36).substring(2, 11);\\n};\\n\\nconst type = 'application/x-tiddler-dictionary';\\nconst getTemplate = () => {\\n  let template = $tw.wiki\\n    .getTiddlerText('$:/plugins/oeyoews/vue-links-gallery/widget.vue')\\n    .trim(); // trim to remove linebreak\\n\\n  if (template.startsWith('<template>') && template.endsWith('</template>')) {\\n    template = template.slice(10, -11);\\n  }\\n\\n  return template;\\n};\\n\\nconst links = (json = 'list-links.json') => {\\n  const component = {\\n    setup() {\\n      // obj --> array\\n      const data = ref(Object.entries($tw.wiki.getTiddlerData(json, {})));\\n\\n      const newLink = ref('');\\n      const newDesc = ref('');\\n\\n      const edit = ref(false);\\n      const prettyLink = (link) => {\\n        try {\\n          return new URL(link).origin;\\n        } catch (e) {\\n          console.error(e.message);\\n          return link;\\n        }\\n      };\\n\\n      const prettyLinkData = computed(() => {\\n        if (!data.value) return [];\\n\\n        return data.value.map((item) => {\\n          return {\\n            desc: item[0],\\n            link: item[1],\\n            prettyLink: prettyLink(item[1]),\\n          };\\n        });\\n      });\\n\\n      const chartdata = reactive({\\n        nodes: [\\n          {\\n            id: '0',\\n            name: 'Myriel',\\n            symbolSize: 19.12381,\\n            x: -266.82776,\\n            y: 299.6904,\\n            value: 28.685715,\\n            category: 0,\\n          },\\n          {\\n            id: '1',\\n            name: 'Napoleon',\\n            symbolSize: 2.6666666666666665,\\n            x: -418.08344,\\n            y: 446.8853,\\n            value: 4,\\n            category: 0,\\n          },\\n          {\\n            id: '2',\\n            name: 'MlleBaptistine',\\n            symbolSize: 6.323809333333333,\\n            x: -212.76357,\\n            y: 245.29176,\\n            value: 9.485714,\\n            category: 1,\\n          },\\n        ],\\n        links: [\\n          {\\n            source: '1',\\n            target: '0',\\n          },\\n          {\\n            source: '2',\\n            target: '0',\\n          },\\n          {\\n            source: '3',\\n            target: '0',\\n          },\\n          {\\n            source: '3',\\n            target: '2',\\n          },\\n          {\\n            source: '4',\\n            target: '0',\\n          },\\n          {\\n            source: '5',\\n            target: '0',\\n          },\\n          {\\n            source: '6',\\n            target: '0',\\n          },\\n        ],\\n        categories: [\\n          {\\n            name: 'A',\\n          },\\n          {\\n            name: 'B',\\n          },\\n          {\\n            name: 'C',\\n          },\\n          {\\n            name: 'D',\\n          },\\n        ],\\n      });\\n\\n      const options = computed(() => ({\\n        title: {\\n          text: 'Les Miserables',\\n          subtext: 'Default layout',\\n          top: 'bottom',\\n          left: 'right',\\n        },\\n        tooltip: {},\\n        legend: [\\n          {\\n            // selectedMode: 'single',\\n            data: chartdata.categories.map(function (a) {\\n              return a.name;\\n            }),\\n          },\\n        ],\\n        animationDuration: 1500,\\n        animationEasingUpdate: 'quinticInOut',\\n        series: [\\n          {\\n            name: 'Les Miserables',\\n            type: 'graph',\\n            layout: 'none',\\n            data: chartdata.nodes,\\n            links: chartdata.links,\\n            categories: chartdata.categories,\\n            roam: true,\\n            label: {\\n              position: 'right',\\n              formatter: '{b}',\\n            },\\n            lineStyle: {\\n              color: 'source',\\n              curveness: 0.3,\\n            },\\n            emphasis: {\\n              focus: 'adjacency',\\n              lineStyle: {\\n                width: 10,\\n              },\\n            },\\n          },\\n        ],\\n      }));\\n\\n      const chartapp = ref();\\n\\n      return {\\n        chartapp,\\n        chartdata,\\n        options,\\n        prettyLink,\\n        prettyLinkData,\\n        data,\\n        newLink,\\n        edit,\\n        newDesc,\\n      };\\n    },\\n\\n    mounted() {\\n      this.initChart();\\n      // this.chartapp.showLoading();\\n      this.updateChart();\\n      // this.chartapp.hideLoading();\\n    },\\n\\n    watch: {\\n      options: {\\n        handler() {\\n          this.updateChart();\\n        },\\n      },\\n    },\\n\\n    methods: {\\n      initChart() {\\n        this.chartapp = echarts.init(this.$refs.chart);\\n      },\\n      addData() {\\n        this.chartdata.categories.push({\\n          name: randomString(),\\n        });\\n\\n        this.chartdata.nodes.push({\\n          id: this.chartdata.nodes.length,\\n          name: randomString(),\\n          symbolSize: 19.12381 + Math.random() * 10,\\n          x: -266.82776 + Math.random() * 100,\\n          y: 299.6904 + Math.random() * 100,\\n          value: 28.685715 + Math.random() * 10,\\n          category: 'A',\\n        });\\n        // this.updateChart();\\n      },\\n\\n      /** @see: https://echarts.apache.org/handbook/zh/how-to/data/dynamic-data */\\n      updateChart() {\\n        this.chartapp.setOption(this.options);\\n      },\\n      toEdit: function () {\\n        this.edit = !this.edit;\\n      },\\n\\n      resetStatus: function () {\\n        this.newDesc = '';\\n        this.newLink = '';\\n      },\\n      updateData: function () {\\n        if ($tw.wiki.getTiddler(json)?.fields.type !== type) {\\n          $tw.wiki.setText(json, 'type', null, type);\\n        }\\n        $tw.wiki.setTiddlerData(\\n          json,\\n          Object.fromEntries(toRaw(this.data)),\\n          null,\\n          {\\n            suppressTimestamp: true,\\n          },\\n        );\\n      },\\n      removeLink: function (site) {\\n        // this.data.splice(index, 1);\\n        this.data = this.data.filter(([desc, link]) => {\\n          return link !== site;\\n        });\\n        this.updateData();\\n      },\\n\\n      // TODO: 验证是否为网址\\n      addNewLink: function () {\\n        if (!this.newLink || !this.newDesc) {\\n          console.error('缺少链接或描述');\\n          return;\\n        }\\n        if (this.prettyLinkData.find((item) => item.link === this.newLink)) {\\n          console.error('链接已存在');\\n          return;\\n        } else if (this.newLink && this.newDesc) {\\n          this.data.unshift([this.newDesc, this.newLink]);\\n          this.updateData();\\n        }\\n        this.resetStatus();\\n      },\\n    },\\n\\n    template: getTemplate(),\\n  };\\n  return component;\\n};\\n\\nmodule.exports = links;\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/vue-links-gallery/styles.css\":{\"title\":\"$:/plugins/oeyoews/vue-links-gallery/styles.css\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\",\"text\":\".list-enter-active,\\n.list-leave-active {\\n  transition: all 0.5s ease;\\n}\\n.list-enter-from,\\n.list-leave-to {\\n  opacity: 0;\\n  transform: translateX(30px);\\n}\\n\"},\"$:/plugins/oeyoews/vue-links-gallery/widget.js\":{\"title\":\"$:/plugins/oeyoews/vue-links-gallery/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/vue-links-gallery/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nvue-links-gallery widget\\n\\n\\\\*/\\n\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass VueLinkGalleryWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const createElement = $tw.utils.domMaker;\\n\\n    const domNode = createElement('div', {});\\n\\n    const vuelib = '$:/plugins/oeyoews/neotw-vue3/vue.global.prod.js';\\n    const logger = new $tw.utils.Logger('neotw-vue-todo');\\n\\n    if (!window.Vue) {\\n      window.Vue = require(vuelib);\\n    }\\n\\n    if (!window.Vue) {\\n      logger.alert(\\n        `${vuelib} is missing, Please install neotw-vue plugin by @oeyoews`,\\n      );\\n      return;\\n    }\\n\\n    const { createApp } = window.Vue;\\n    const { json } = this.attributes;\\n\\n    const todoComponent = require('./component.js');\\n\\n    try {\\n      const app = createApp(todoComponent(json));\\n\\n      app.config.errorHandler = (err) => {\\n        const text = `[Vue3](${app.version}): ` + err;\\n        console.error(text);\\n        domNode.textContent = text;\\n        domNode.style.color = 'red';\\n      };\\n\\n      app.mount(domNode);\\n\\n      parent.insertBefore(domNode, nextSibling);\\n      this.domNodes.push(domNode);\\n    } catch (e) {\\n      console.error(e.message);\\n    }\\n  }\\n\\n  refresh() {\\n    return false;\\n  }\\n}\\n\\n/** @description neotw-vue-links-gallery widget */\\nexports['vue-links-gallery'] = VueLinkGalleryWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/vue-links-gallery/widget.vue\":{\"title\":\"$:/plugins/oeyoews/vue-links-gallery/widget.vue\",\"text\":\"<template>\\n  <form @submit.prevent=\\\"addNewLink\\\" class=\\\"my-1\\\">\\n    <div class=\\\"flex gap-2 items-center shrink-0\\\">\\n      <input\\n        type=\\\"text\\\"\\n        v-model.trim=\\\"newDesc\\\"\\n        required\\n        placeholder=\\\"desc\\\"\\n        class=\\\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-xs sm:text-sm border-gray-300 rounded-md\\\"\\n      />\\n      <input\\n        type=\\\"text\\\"\\n        v-model.trim=\\\"newLink\\\"\\n        required\\n        placeholder=\\\"links\\\"\\n        class=\\\"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-xs sm:text-sm border-gray-300 rounded-md\\\"\\n      />\\n    </div>\\n    <button\\n      type=\\\"submit\\\"\\n      class=\\\"px-4 py-2 bg-blue-500 text-white rounded-sm hover:bg-blue-700\\\"\\n    >\\n      添加\\n    </button>\\n    <button\\n      type=\\\"button\\\"\\n      @click.stop=\\\"toEdit\\\"\\n      class=\\\"px-4 py-2 bg-gray-500 text-white rounded-sm hover:bg-gray-700\\\"\\n    >\\n      切换编辑模式\\n    </button>\\n  </form>\\n\\n  <div v-show=\\\"false\\\">\\n    <h2>chart</h2>\\n    <button @click=\\\"addData\\\">update chart</button>\\n    <div ref=\\\"chart\\\" style=\\\"width: 900px; height: 400px\\\"></div>\\n  </div>\\n\\n  <table>\\n    <thead>\\n      <tr>\\n        <th>序号</th>\\n        <th>描述</th>\\n        <th>网址</th>\\n        <Transition>\\n          <th v-show=\\\"edit\\\">操作</th>\\n        </Transition>\\n      </tr>\\n    </thead>\\n    <TransitionGroup name=\\\"list\\\" tag=\\\"tbody\\\" v-if=\\\"prettyLinkData.length\\\">\\n      <tr v-for=\\\"(item, index) in prettyLinkData\\\" :key=\\\"item.prettyLink\\\">\\n        <td>{{ index + 1 }}</td>\\n        <td>{{ item.desc }}</td>\\n        <td>\\n          <a\\n            :href=\\\"item.link\\\"\\n            target=\\\"_blank\\\"\\n            class=\\\"hover:underline\\\"\\n            :title=\\\"item.desc\\\"\\n          >\\n            {{ item.prettyLink }}\\n          </a>\\n        </td>\\n        <Transition>\\n          <td @click=\\\"removeLink(item.link)\\\" v-show=\\\"edit\\\">\\n            <a\\n              href=\\\"#\\\"\\n              @click.prevent=\\\"removeLink(index)\\\"\\n              class=\\\"hover:underline\\\"\\n              title=\\\"remove\\\"\\n              >删除</a\\n            >\\n          </td>\\n        </Transition>\\n      </tr>\\n    </TransitionGroup>\\n    <tbody v-else>\\n      <tr>\\n        <td :colspan=\\\"edit ? 4 : 3\\\" class=\\\"text-center\\\">\\n          <div class=\\\"h-24 flex items-center justify-center\\\">暂无数据</div>\\n        </td>\\n      </tr>\\n    </tbody>\\n    <!-- <tfoot > foot </tfoot> -->\\n  </table>\\n</template>\\n\",\"type\":\".vue\"}}}"}