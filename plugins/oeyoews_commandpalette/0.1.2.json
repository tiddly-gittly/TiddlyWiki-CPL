{"title":"$:/plugins/oeyoews/commandpalette","name":"commandpalette","author":"oeyoews","core-version":">=5.3.0","description":"Command palette","plugin-type":"plugin","version":"0.1.2","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/commandpalette/readme\":{\"title\":\"$:/plugins/oeyoews/commandpalette/readme\",\"text\":\"!! 改于 $:/plugins/souk21/commandpalette\\n\\n* https://github.com/Souk21/TW-commandpalette\\n\\n!! Readme\\n\\n* 使用 tailwindcss, 重写部分样式\\n* use tailwindcss, rewrite some styles\\n\\n[img[https://i.imgur.com/JNF1NKg.png]]\\n\\n!! TODO\\n\\n<!-- * suitable dark:invert -->\\n* ctrl-shift-I 不起作用\\n* support create tiddlers with tag\\n<!-- * add masklayer -->\\n* prevent stop scrollable\\n<!-- * add search plugins -->\\n<!-- * right search tips -->\\n* suitable mobile style\\n* support icons\"},\"$:/plugins/oeyoews/commandpalette/cmd\":{\"title\":\"$:/plugins/oeyoews/commandpalette/cmd\",\"tags\":\"$:/tags/PageControls\",\"list-before\":\"$:/core/ui/Buttons/more-page-actions\",\"description\":\"Cmd\",\"caption\":\"CMD\",\"text\":\"\\\\whitespace trim\\n<$button tooltip=\\\"open-command-palette\\\" aria-label=\\\"cmd\\\" message=\\\"open-command-palette\\\" class=<<tv-config-toolbar-class>>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n{{$:/plugins/oeyoews/commandpalette/icon}}\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=\\\"CMd\\\"/>\\n</span>\\n</$list>\\n</$button>\"},\"$:/plugins/oeyoews/cmp/commandpalettewidget.js\":{\"title\":\"$:/plugins/oeyoews/cmp/commandpalettewidget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/cmp/commandpalettewidget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nCommand Palette Widget\\n\\\\*/\\nconst{widget:t}=require(\\\"$:/core/modules/widgets/widget.js\\\"),e=require(\\\"./lib/getTiddlersWithTag\\\"),i=$tw.utils.domMaker,s=require(\\\"./lib/getActiveElement\\\"),r=require(\\\"./lib/focusAtCaretPosition\\\"),n=require(\\\"./lib/getCurrentSelection\\\");exports.commandpalettewidget=class extends t{constructor(t,e){super(t,e),this.initialise(t,e),this.currentSelection=0,this.symbolProviders={},this.actions=[],this.triggers=[],this.prefixes=[],this.blockProviderChange=!1,this.composing=!1,this.defaultSettings={maxResults:15,maxResultHintSize:45,neverBasic:!1,showHistoryOnOpen:!0,escapeGoesBack:!0,alwaysPassSelection:!0,theme:\\\"$:/plugins/oeyoews/commandpalette/Compact.css\\\"},this.settings={},this.commandHistoryPath=\\\"$:/plugins/oeyoews/commandpalette/CommandPaletteHistory\\\",this.settingsPath=\\\"$:/plugins/oeyoews/commandpalette/CommandPaletteSettings\\\",this.searchStepsPath=\\\"$:/plugins/oeyoews/commandpalette/CommandPaletteSearchSteps\\\",this.customCommandsTag=\\\"$:/tags/CommandPaletteCommand\\\",this.themesTag=\\\"$:/tags/CommandPaletteTheme\\\",this.typeField=\\\"command-palette-type\\\",this.nameField=\\\"command-palette-name\\\",this.hintField=\\\"command-palette-hint\\\",this.modeField=\\\"command-palette-mode\\\",this.userInputField=\\\"command-palette-user-input\\\",this.caretField=\\\"command-palette-caret\\\",this.immediateField=\\\"command-palette-immediate\\\",this.triggerField=\\\"command-palette-trigger\\\",this.prefixField=\\\"command-palette-prefix\\\"}actionStringBuilder(t){return e=>this.invokeActionString(t,this,e)}actionStringInput(t,e,i){this.blockProviderChange=!0,this.allowInputFieldSelection=!0,this.searchHint.innerText=e,this.searchContainer.value=\\\"\\\",this.currentProvider=()=>{},this.currentResolver=e=>{this.invokeActionString(t,this,e,{commandpaletteinput:this.searchContainer.value}),this.closePalette()},this.showResults([]),this.onInput(this.searchContainer.value)}invokeFieldMangler(t,e,i,s){let r=`<$fieldmangler tiddler=\\\"${t}\\\">\\\\n\\\\t\\\\t\\\\t<$action-sendmessage $message=\\\"${e}\\\" $param=\\\"${i}\\\"/>\\\\n\\\\t\\\\t\\\\t</$fieldmangler>`;this.invokeActionString(r,this,s)}tagOperation(t,e,i,s,r,n){this.blockProviderChange=!0,r&&(this.allowInputFieldSelection=!0),this.currentProvider=this.historyProviderBuilder(e),this.currentResolver=t=>{if(0===this.currentSelection)return;let e=this.currentResults[this.currentSelection-1].result.name;this.currentProvider=t=>{this.currentSelection=0,this.searchHint.innerText=i;let r=s(e,t);r=r.map((t=>({name:t}))),this.showResults(r)},this.searchContainer.value=\\\"\\\",this.onInput(this.searchContainer.value),this.currentResolver=t=>{if(!r&&0===this.currentSelection)return;let i=this.searchContainer.value;0!==this.currentSelection&&(i=this.currentResults[this.currentSelection-1].result.name),this.invokeFieldMangler(e,n,i,t),t.getModifierState(\\\"Shift\\\")?this.onInput(this.searchContainer.value):this.closePalette()}},this.searchContainer.value=\\\"\\\",this.onInput(this.searchContainer.value)}refreshThemes(t){this.themes=e(this.themesTag);let i=!1;for(let e of this.themes){let s=e.fields.title;s===this.settings.theme?(i=!0,this.addTagIfNecessary(s,\\\"$:/tags/Stylesheet\\\",t)):this.invokeFieldMangler(s,\\\"tm-remove-tag\\\",\\\"$:/tags/Stylesheet\\\",t)}i||this.addTagIfNecessary(this.defaultSettings.theme,\\\"$:/tags/Stylesheet\\\",t)}addTagIfNecessary(t,e,i){this.hasTag(t,e)||this.invokeFieldMangler(t,\\\"tm-add-tag\\\",e,i)}hasTag(t,e){return $tw.wiki.getTiddler(t).fields.tags.includes(e)}refreshCommands(){this.actions=[],this.actions.push({name:\\\"Refresh Command Palette\\\",action:t=>{this.refreshCommandPalette(),this.promptCommand(\\\"\\\")},keepPalette:!0}),this.actions.push({name:\\\"Explorer\\\",action:t=>this.explorer(t),keepPalette:!0}),this.actions.push({name:\\\"See History\\\",action:t=>this.showHistory(t),keepPalette:!0}),this.actions.push({name:\\\"New Command Wizard\\\",action:t=>this.newCommandWizard(t),keepPalette:!0}),this.actions.push({name:\\\"Add tag to tiddler\\\",action:t=>this.tagOperation(t,\\\"Pick tiddler to tag\\\",\\\"Pick tag to add (⇧⏎ to add multiple)\\\",((t,e)=>$tw.wiki.filterTiddlers(`[!is[system]tags[]] [is[system]tags[]] -[[${t}]tags[]] +[search[${e}]]`)),!0,\\\"tm-add-tag\\\"),keepPalette:!0}),this.actions.push({name:\\\"Remove tag\\\",action:t=>this.tagOperation(t,\\\"Pick tiddler to untag\\\",\\\"Pick tag to remove (⇧⏎ to remove multiple)\\\",((t,e)=>$tw.wiki.filterTiddlers(`[[${t}]tags[]] +[search[${e}]]`)),!1,\\\"tm-remove-tag\\\"),keepPalette:!0});let t=e(this.customCommandsTag);for(let e of t){if(void 0===!e.fields[this.typeField])continue;let t=e.fields[this.typeField],i=e.fields.text;void 0===i&&(i=\\\"\\\");let s=i.match(/^.*/)[0],r=e.fields[this.hintField];if(void 0===r&&(r=e.fields[this.nameField]),void 0===r&&(r=\\\"\\\"),\\\"shortcut\\\"===t){let t=e.fields[this.triggerField];if(void 0===t)continue;this.triggers.push({trigger:t,text:i,hint:r});continue}if(void 0===!e.fields[this.nameField])continue;let n=e.fields[this.nameField];if(\\\"prompt\\\"!==t)if(\\\"prompt-basic\\\"!==t)if(\\\"message\\\"!==t)if(\\\"actionString\\\"!==t)if(\\\"history\\\"!==t);else{let t=e.fields[this.modeField];this.actions.push({name:n,action:e=>this.commandWithHistoryPicker(s,r,t).handler(e),keepPalette:!0})}else void 0!==e.fields[this.userInputField]&&\\\"true\\\"===e.fields[this.userInputField]?this.actions.push({name:n,action:t=>this.actionStringInput(i,r,t),keepPalette:!0}):this.actions.push({name:n,action:t=>this.actionStringBuilder(i)(t)});else this.actions.push({name:n,action:t=>this.tmMessageBuilder(s)(t)});else{let t=e.fields[this.caretField],i={name:n,action:()=>this.promptCommandBasic(s,t,r),keepPalette:!0},a=e.fields[this.prefixField];void 0!==a&&(this.symbolProviders[a]={provider:this.prefixedBasicProviderBuilder(s,t,r),resolver:void 0},this.prefixes.push({prefix:a,hint:r})),this.actions.push(i)}else{let t=!!e.fields[this.immediateField],i=e.fields[this.caretField],r={name:n,action:()=>this.promptCommand(s,i),keepPalette:!t,immediate:t};this.actions.push(r)}}}newCommandWizard(){this.blockProviderChange=!0,this.searchContainer.value=\\\"\\\",this.searchHint.innerText=\\\"Command Name\\\";let t=\\\"\\\",e=\\\"\\\",i=\\\"\\\",s=()=>{this.searchContainer.value=\\\"\\\",this.searchHint.innerText=\\\"Enter Message\\\",this.currentResolver=s=>{this.tmMessageBuilder(\\\"tm-new-tiddler\\\",{title:\\\"$:/\\\"+t,tags:this.customCommandsTag,[this.typeField]:e,[this.nameField]:t,[this.hintField]:i,text:this.searchContainer.value})(s),this.closePalette()}},r=()=>{this.searchContainer.value=\\\"\\\",this.searchHint.innerText=\\\"Enter hint\\\",this.currentResolver=t=>{i=this.searchContainer.value,s()}},n=()=>{this.searchContainer.value=\\\"\\\",this.searchHint.innerText=\\\"Enter type (prompt, prompt-basic, message, actionString, history)\\\",this.currentResolver=i=>{e=this.searchContainer.value,\\\"history\\\"===e?r():(this.tmMessageBuilder(\\\"tm-new-tiddler\\\",{title:\\\"$:/\\\"+t,tags:this.customCommandsTag,[this.typeField]:e,[this.nameField]:t})(i),this.closePalette())}};this.currentProvider=t=>{},this.currentResolver=e=>{0!==this.searchContainer.value.length&&(t=this.searchContainer.value,n())},this.showResults([])}explorer(t){this.blockProviderChange=!0,this.searchContainer.value=\\\"$:/\\\",this.lastExplorerInput=\\\"$:/\\\",this.searchHint.innerText=\\\"Explorer\\\",this.currentProvider=t=>this.explorerProvider(\\\"$:/\\\",t),this.currentResolver=t=>{0!==this.currentSelection&&this.currentResults[this.currentSelection-1].result.action(t)},this.onInput()}explorerProvider(t,e){let i=t=>{this.searchContainer.value=t,this.lastExplorerInput=this.searchContainer.value,this.currentProvider=e=>this.explorerProvider(t,e),this.onInput()};this.searchContainer.value.startsWith(t)||(this.searchContainer.value=this.lastExplorerInput),this.lastExplorerInput=this.searchContainer.value,this.currentSelection=0;let s,r=this.searchContainer.value.substr(t.length),n=$tw.wiki.filterTiddlers(`[removeprefix[${t}]splitbefore[/]sort[]search[${r}]]`),a=[],o=[];for(let e of n)e.endsWith(\\\"/\\\")?a.push({name:e,action:s=>i(`${t}${e}`)}):o.push({name:e,action:i=>{this.navigateTo(`${t}${e}`),i.getModifierState(\\\"Shift\\\")||this.closePalette()}});if(\\\"$:/\\\"!==t){let e=t.split(\\\"/\\\");e.splice(e.length-2);let r=e.join(\\\"/\\\")+\\\"/\\\";return s={name:\\\"..\\\",action:t=>i(r)},void this.showResults([s,...a,...o])}this.showResults([...a,...o])}setSetting(t,e){\\\"string\\\"==typeof e&&(\\\"true\\\"===e&&(e=!0),\\\"false\\\"===e&&(e=!1)),this.settings[t]=e,$tw.wiki.setTiddlerData(this.settingsPath,this.settings)}refreshSettings(){this.settings=$tw.wiki.getTiddlerData(this.settingsPath,{...this.defaultSettings});for(let t in this.defaultSettings)this.defaultSettings.hasOwnProperty(t)&&void 0===this.settings[t]&&(this.settings[t]=this.defaultSettings[t]);for(let t in this.settings)this.settings.hasOwnProperty(t)&&\\\"string\\\"==typeof this.settings[t]&&(\\\"true\\\"===this.settings[t].toLowerCase()&&(this.settings[t]=!0),\\\"false\\\"===this.settings[t].toLowerCase()&&(this.settings[t]=!1))}render(t,e){this.parentDomNode=t,this.execute(),this.history=$tw.wiki.getTiddlerData(this.commandHistoryPath,{history:[]}).history,$tw.rootWidget.addEventListener(\\\"open-command-palette\\\",(t=>this.openPalette(t))),$tw.rootWidget.addEventListener(\\\"open-command-palette-selection\\\",(t=>this.openPaletteSelection(t))),$tw.rootWidget.addEventListener(\\\"insert-command-palette-result\\\",(t=>this.insertSelectedResult(t)));let s=i(\\\"div\\\",{class:\\\"flex justify-center items-center p-2\\\"});this.mask=i(\\\"div\\\",{class:\\\"opacity-0 backdrop-blur-lg z-[9998] fixed inset-0 bg-black/20 transition-all pointer-events-none cursor-pointer\\\"}),this.container=i(\\\"div\\\",{class:\\\"hidden bg-white flex-col z-[9999] transform shadow-lg p-2 mt-4 fixed left-1/2 -translate-x-1/2 w-1/2 rounded transition-all dark:invert w-3/4 md:w-1/2\\\"}),\\n// if add type: \\\"text\\\", google-chrome always tip\\nthis.searchContainer=i(\\\"input\\\",{type:\\\"\\\",class:\\\"w-full shadow-none border-none !bg-transparent\\\",attributes:{placeholder:\\\"🔥 Search ...\\\"}}),this.searchHint=i(\\\"div\\\",{class:\\\"commandpalettehint commandpalettehintmain\\\"}),s.append(this.searchHint,this.searchContainer),this.scrollDiv=i(\\\"div\\\",{class:\\\"cp-scroll\\\"}),this.container.append(s,this.scrollDiv),this.searchContainer.addEventListener(\\\"keydown\\\",(t=>this.onKeyDown(t))),this.searchContainer.addEventListener(\\\"input\\\",this.debounce((()=>{this.onInput(this.searchContainer.value)}))),this.searchContainer.addEventListener(\\\"compositionstart\\\",(()=>{this.composing=!0})),this.searchContainer.addEventListener(\\\"compositionend\\\",(()=>{this.composing=!1,this.onInput(this.searchContainer.value)})),document.documentElement.addEventListener(\\\"click\\\",(t=>this.onClick(t))),t.insertBefore(this.mask,e),t.insertBefore(this.container,e),this.refreshCommandPalette(),this.symbolProviders[\\\">\\\"]={provider:t=>this.actionProvider(t),resolver:t=>this.actionResolver(t)},this.symbolProviders[\\\"#\\\"]={provider:t=>this.tagListProvider(t),resolver:t=>this.tagListResolver(t)},this.symbolProviders[\\\"@\\\"]={provider:t=>this.tagProvider(t),resolver:t=>this.defaultResolver(t)},this.symbolProviders[\\\"?\\\"]={provider:t=>this.helpProvider(t),resolver:t=>this.helpResolver(t)},this.symbolProviders[\\\"[\\\"]={provider:(t,e)=>this.filterProvider(t,e),resolver:t=>this.filterResolver(t)},this.symbolProviders[\\\"+\\\"]={provider:t=>this.createTiddlerProvider(t),resolver:t=>this.createTiddlerResolver()},this.symbolProviders[\\\"|\\\"]={provider:t=>this.settingsProvider(t),resolver:t=>this.settingsResolver()},this.currentResults=[],this.currentProvider={}}refreshSearchSteps(){this.searchSteps=[];let t=$tw.wiki.getTiddlerData(this.searchStepsPath);t=t.steps;for(let e of t)this.searchSteps.push(this.searchStepBuilder(e.filter,e.caret,e.hint))}refreshCommandPalette(){this.refreshSettings(),this.refreshThemes(),this.refreshCommands(),this.refreshSearchSteps()}updateCommandHistory(t){this.history=Array.from(new Set([t.name,...this.history])),$tw.wiki.setTiddlerData(this.commandHistoryPath,{history:this.history})}historyProviderBuilder(t,e){return i=>{let s;this.currentSelection=0,this.searchHint.innerText=t,s=void 0!==e&&\\\"drafts\\\"===e?$tw.wiki.filterTiddlers(\\\"[has:field[draft.of]]\\\"):void 0!==e&&\\\"story\\\"===e?$tw.wiki.filterTiddlers(\\\"[list[$:/StoryList]]\\\"):this.getHistory(),s=s.map((t=>({name:t}))),this.showResults(s)}}commandWithHistoryPicker(t,e,i){let s=this.historyProviderBuilder(e,i),r=e=>{if(0===this.currentSelection)return;let i=this.currentResults[this.currentSelection-1].result.name;this.parentWidget.dispatchEvent({type:t,param:i,tiddlerTitle:i}),this.closePalette()};return{handler:t=>{this.blockProviderChange=!0,this.allowInputFieldSelection=!0,this.currentProvider=s,this.currentResolver=r,this.searchContainer.value=\\\"\\\",this.onInput(this.searchContainer.value)},provider:s,resolver:r}}onInput(t){if(this.composing)return;if(this.blockProviderChange)return this.currentProvider(t),void this.setSelectionToFirst();let{resolver:e,provider:i,terms:s}=this.parseCommand(t);this.currentResolver=e,this.currentProvider=i,this.currentProvider(s),this.setSelectionToFirst()}parseCommand(t){let e,i,s=\\\"\\\",r=this.triggers.find((e=>t.startsWith(e.trigger)));if(void 0!==r)e=t=>{let e=this.searchContainer.value.slice(r.trigger.length);this.invokeActionString(r.text,this,t,{commandpaletteinput:e}),this.closePalette()},i=t=>{this.searchHint.innerText=r.hint,this.showResults([])};else{let r;for(let e in this.symbolProviders)t.startsWith(e)&&(void 0===r||r.length<e.length)&&(r=e);void 0===r?(e=this.defaultResolver,i=this.defaultProvider,s=t):(i=this.symbolProviders[r].provider,e=this.symbolProviders[r].resolver,s=t.substring(r.length))}return{resolver:e,provider:i,terms:s}}onClick(t){this.isOpened&&!this.container.contains(t.target)&&this.closePalette()}openPaletteSelection(t){let e=n();t.param=e,this.openPalette(t)}openPalette(t){this.isOpened=!0,this.allowInputFieldSelection=!1,this.goBack=void 0,this.blockProviderChange=!1;let e=s();this.previouslyFocused={element:e,start:e.selectionStart,end:e.selectionEnd,caretPos:e.selectionEnd},this.searchContainer.value=\\\"\\\",void 0!==t.param&&(this.searchContainer.value=t.param),this.settings.alwaysPassSelection&&(this.searchContainer.value+=n()),this.currentSelection=0,this.onInput(this.searchContainer.value),this.container.classList.add(\\\"flex\\\"),this.container.classList.remove(\\\"hidden\\\"),this.mask.classList.remove(\\\"pointer-events-none\\\"),this.mask.classList.add(\\\"opacity-100\\\"),this.mask.addEventListener(\\\"scroll\\\",(t=>t.stopPropagation())),document.body.style.overflow=\\\"hidden\\\",this.searchContainer.focus()}insertSelectedResult(){if(!this.isOpened)return;if(0===this.currentSelection)return;let t=this.previouslyFocused,e=t.element.value;if(void 0===e)return;let i=this.currentResults[this.currentSelection-1].result.name;t.start!==t.end?this.previouslyFocused.element.value=e.substring(0,t.start)+i+e.substring(t.end):this.previouslyFocused.element.value=e.substring(0,t.start)+i+e.substring(t.start),this.previouslyFocused.caretPos=t.start+i.length,this.closePalette()}closePalette(){this.mask.classList.remove(\\\"opacity-100\\\"),this.mask.classList.add(\\\"pointer-events-none\\\"),this.container.classList.remove(\\\"flex\\\"),this.container.classList.add(\\\"hidden\\\"),this.isOpened=!1,r(this.previouslyFocused.element,this.previouslyFocused.caretPos),document.body.style.overflow=\\\"\\\"}onKeyDown(t){if(\\\"Escape\\\"===t.key)this.settings.escapeGoesBack&&void 0!==this.goBack?(this.goBack(),this.goBack=void 0):this.closePalette();else if(\\\"ArrowUp\\\"===t.key){t.preventDefault(),t.stopPropagation();let e=this.currentSelection-1;0===e?this.allowInputFieldSelection||(e=this.currentResults.length):e<0&&(e=this.currentResults.length),this.setSelection(e)}else if(\\\"ArrowDown\\\"===t.key){t.preventDefault(),t.stopPropagation();let e=(this.currentSelection+1)%(this.currentResults.length+1);this.allowInputFieldSelection||0!==e||0===this.currentResults.length||(e=1),this.setSelection(e)}else\\\"Enter\\\"===t.key&&(t.preventDefault(),t.stopPropagation(),this.validateSelection(t))}addResult(t,e){let s=i(\\\"div\\\",{class:\\\"commandpaletteresult py-2 rounded\\\",text:t.name});if(void 0!==t.hint){let e=i(\\\"div\\\",{class:\\\"commandpalettehint text-neutral-600\\\",text:t.hint});s.append(e)}s.result=t,this.currentResults.push(s),s.addEventListener(\\\"click\\\",(t=>{this.setSelection(e+1),this.validateSelection(t)})),this.scrollDiv.append(s)}validateSelection(t){this.currentResolver(t)}defaultResolver(t){if(t.getModifierState(\\\"Shift\\\"))return this.searchContainer.value=\\\"+\\\"+this.searchContainer.value,void this.createTiddlerResolver(t);if(0===this.currentSelection)return;let e=this.currentResults[this.currentSelection-1].result.name;this.closePalette(),this.navigateTo(e)}navigateTo(t){this.parentWidget.dispatchEvent({type:\\\"tm-navigate\\\",param:t,navigateTo:t})}showHistory(){this.searchHint.innerText=\\\"History\\\",this.currentProvider=t=>{let e;e=0===t.length?this.getHistory():this.getHistory().filter((e=>e.includes(t))),e=e.map((t=>({name:t,action:()=>{this.navigateTo(t),this.closePalette()}}))),this.showResults(e)},this.currentResolver=t=>{0!==this.currentSelection&&this.currentResults[this.currentSelection-1].result.action(t)},this.searchContainer.value=\\\"\\\",this.blockProviderChange=!0,this.onInput(this.searchContainer.value)}setSelectionToFirst(){let t=1;(this.allowInputFieldSelection||0===this.currentResults.length)&&(t=0),this.setSelection(t)}setSelection(t){this.currentSelection=t;for(let t=0;t<this.currentResults.length;t++){let e=this.currentSelection===t+1;this.currentResults[t].className=e?\\\"commandpaletteresult commandpaletteresultselected py-2 bg-neutral-200 text-neutral-900 rounded-sm\\\":\\\"commandpaletteresult py-2 dark:invert\\\"}if(0===this.currentSelection)return void(this.scrollDiv.scrollTop=0);let e=this.scrollDiv.offsetHeight,i=this.scrollDiv.scrollTop,s=this.currentResults[this.currentSelection-1].offsetTop,r=this.currentResults[this.currentSelection-1].offsetHeight;if(s<i||s>=i+e){let t=s,n=s-e+r;t=Math.abs(t-i),n=Math.abs(n-i),this.scrollDiv.scrollTop=t<n?s:s-e+r}}getHistory(){let t=$tw.wiki.getTiddlerData(\\\"$:/HistoryList\\\");return void 0===t&&(t=[]),t=[...t.reverse().map((t=>t.title)),...$tw.wiki.filterTiddlers(\\\"[list[$:/StoryList]]\\\")],Array.from(new Set(t.filter((t=>this.tiddlerOrShadowExists(t)))))}tiddlerOrShadowExists(t){return $tw.wiki.tiddlerExists(t)||$tw.wiki.isShadowTiddler(t)}defaultProvider(t){let e;this.searchHint.innerText=\\\"🔍\\\",this.searchHint.className=\\\"mr-2\\\",t.startsWith(\\\"\\\\\\\\\\\")&&(t=t.substr(1)),0===t.length?e=this.settings.showHistoryOnOpen?this.getHistory().map((t=>({name:t,hint:\\\"history\\\"}))):[]:(e=this.searchSteps.reduce(((e,i)=>[...e,...i(t)]),[]),e=Array.from(new Set(e))),this.showResults(e)}searchStepBuilder(t,e,i){return s=>{let r=t.substr(0,e)+s+t.substr(e);return $tw.wiki.filterTiddlers(r).map((t=>({name:t,hint:i})))}}tagListProvider(t){let e;this.currentSelection=0,this.searchHint.innerText=\\\"Search tags\\\",e=0===t.length?$tw.wiki.filterTiddlers(\\\"[!is[system]tags[]][is[system]tags[]][all[shadows]tags[]]\\\"):$tw.wiki.filterTiddlers(\\\"[all[]tags[]!is[system]search[\\\"+t+\\\"]][all[]tags[]is[system]search[\\\"+t+\\\"]][all[shadows]tags[]search[\\\"+t+\\\"]]\\\"),e=e.map((t=>({name:t}))),this.showResults(e)}tagListResolver(t){if(0===this.currentSelection){let t=this.searchContainer.value.substr(1);if(!$tw.wiki.filterTiddlers(\\\"[tag[\\\"+t+\\\"]]\\\"))return;return void(this.searchContainer.value=\\\"@\\\"+t)}let e=this.currentResults[this.currentSelection-1];this.searchContainer.value=\\\"@\\\"+e.innerText,this.onInput(this.searchContainer.value)}tagProvider(t){this.currentSelection=0,this.searchHint.innerText=\\\"Search tiddlers with @tag(s)\\\";let e=[];if(0!==t.length){let{tags:t,searchTerms:i,tagsFilter:s}=this.parseTags(this.searchContainer.value),r=$tw.wiki.filterTiddlers(s);if(0!==r.length){if(1===t.length){let s=t[0];this.tiddlerOrShadowExists(s)&&i.some((t=>s.includes(t)))&&e.push(s)}e=[...e,...r]}}e=e.map((t=>({name:t}))),this.showResults(e)}parseTags(t){let e=t.split(\\\" \\\").filter((t=>\\\"\\\"!==t)),i=[],s=[];for(let t=0;t<e.length;t++)e[t].startsWith(\\\"@\\\")?i.push(e[t].substr(1)):s.push(e[t]);let r=`[all[tiddlers+system+shadows]${i.reduce(((t,e)=>t+\\\"tag[\\\"+e+\\\"]\\\"),\\\"\\\")}]`;return 0!==s.length&&(r=r.substr(0,r.length-1),r+=`search[${s.join(\\\" \\\")}]]`),{tags:i,searchTerms:s,tagsFilter:r}}settingsProvider(t){this.currentSelection=0,this.searchHint.innerText=\\\"Select the setting you want to change\\\";let e=t=>0!==t.length&&null===t.match(/\\\\D/gm),i=t=>0!==t.length&&null!==t.match(/(true\\\\b)|(false\\\\b)/gim);this.showResults([{name:\\\"Theme (currently \\\"+this.settings.theme.match(/[^\\\\/]*$/)+\\\")\\\",action:()=>this.promptForThemeSetting()},this.settingResultBuilder(\\\"Max results\\\",\\\"maxResults\\\",\\\"Choose the maximum number of results\\\",e,\\\"Error: value must be a positive integer\\\"),this.settingResultBuilder(\\\"Show history on open\\\",\\\"showHistoryOnOpen\\\",\\\"Chose whether to show the history when you open the palette\\\",i,\\\"Error: value must be 'true' or 'false'\\\"),this.settingResultBuilder(\\\"Escape to go back\\\",\\\"escapeGoesBack\\\",\\\"Chose whether ESC should go back when possible\\\",i,\\\"Error: value must be 'true' or 'false'\\\"),this.settingResultBuilder(\\\"Use selection as search query\\\",\\\"alwaysPassSelection\\\",\\\"Chose your current selection is passed to the command palette\\\",i,\\\"Error: value must be 'true' or 'false'\\\"),this.settingResultBuilder(\\\"Never Basic\\\",\\\"neverBasic\\\",\\\"Chose whether to override basic prompts to show filter operation\\\",i,\\\"Error: value must be 'true' or 'false'\\\"),this.settingResultBuilder(\\\"Field preview max size\\\",\\\"maxResultHintSize\\\",\\\"Choose the maximum hint length for field preview\\\",e,\\\"Error: value must be a positive integer\\\")])}settingResultBuilder(t,e,i,s,r){return{name:t+\\\" (currently \\\"+this.settings[e]+\\\")\\\",action:()=>this.promptForSetting(e,i,s,r)}}settingsResolver(t){0!==this.currentSelection&&(this.goBack=()=>{this.searchContainer.value=\\\"|\\\",this.blockProviderChange=!1,this.onInput(this.searchContainer.value)},this.currentResults[this.currentSelection-1].result.action())}promptForThemeSetting(){this.blockProviderChange=!0,this.allowInputFieldSelection=!1,this.currentProvider=t=>{this.currentSelection=0,this.searchHint.innerText=\\\"Choose a theme\\\";let e=this.defaultSettings.theme,i=[{name:\\\"Revert to default value: \\\"+e.match(/[^\\\\/]*$/),action:()=>{this.setSetting(\\\"theme\\\",e),this.refreshThemes()}}];for(let t of this.themes){let e=t.fields.title,s=e.match(/[^\\\\/]*$/),r=()=>{this.setSetting(\\\"theme\\\",e),this.refreshThemes()};i.push({name:s,action:r})}this.showResults(i)},this.currentResolver=t=>{this.currentResults[this.currentSelection-1].result.action(t)},this.searchContainer.value=\\\"\\\",this.onInput(this.searchContainer.value)}promptForSetting(t,e,i,s){this.blockProviderChange=!0,this.allowInputFieldSelection=!0,this.currentProvider=r=>{this.currentSelection=0,this.searchHint.innerText=e;let n=this.defaultSettings[t],a=[{name:\\\"Revert to default value: \\\"+n,action:()=>this.setSetting(t,n)}];i(r)||a.push({name:s}),this.showResults(a)},this.currentResolver=e=>{if(0===this.currentSelection){let e=this.searchContainer.value;i(e)&&(this.setSetting(t,e),this.goBack=void 0,this.blockProviderChange=!1,this.allowInputFieldSelection=!1,this.promptCommand(\\\"|\\\"))}else{let t=this.currentResults[this.currentSelection-1].result.action;t&&(t(),this.goBack=void 0,this.blockProviderChange=!1,this.allowInputFieldSelection=!1,this.promptCommand(\\\"|\\\"))}},this.searchContainer.value=this.settings[t],this.onInput(this.searchContainer.value)}showResults(t){for(let t of this.currentResults)t.remove();this.currentResults=[];let e=0;for(let i of t)if(this.addResult(i,e),e++,e>=this.settings.maxResults)break}tmMessageBuilder(t,e={}){return i=>{let s={type:t,paramObject:e,event:i};this.parentWidget.dispatchEvent(s)}}actionProvider(t){let e;this.currentSelection=0,this.searchHint.innerText=\\\"💻\\\",e=0===t.length?this.getCommandHistory():this.actions.filter((e=>e.name.toLowerCase().includes(t.toLowerCase()))),this.showResults(e)}helpProvider(t){this.currentSelection=0,this.searchHint.innerText=\\\"🐚\\\";let e=[{name:\\\"... Search\\\",action:()=>this.promptCommand(\\\"\\\")},{name:\\\"> Commands\\\",action:()=>this.promptCommand(\\\">\\\")},{name:\\\"+ Create tiddler with title\\\",action:()=>this.promptCommand(\\\"+\\\")},{name:\\\"# Search tags\\\",action:()=>this.promptCommand(\\\"#\\\")},{name:\\\"@ List tiddlers with tag\\\",action:()=>this.promptCommand(\\\"@\\\")},{name:\\\"[ Filter operation\\\",action:()=>this.promptCommand(\\\"[\\\")},{name:\\\"| Command Palette Settings\\\",action:()=>this.promptCommand(\\\"|\\\")},{name:\\\"\\\\\\\\ Escape first character\\\",action:()=>this.promptCommand(\\\"\\\\\\\\\\\")},{name:\\\"? Help\\\",action:()=>this.promptCommand(\\\"?\\\")}];this.prefixes.forEach((t=>e.push({name:t.prefix+\\\" \\\"+t.hint,action:()=>this.promptCommand(t.prefix)}))),this.showResults(e)}filterProvider(t,e){this.currentSelection=0,this.searchHint.innerText=void 0===e?\\\"Filter operation\\\":e,t=\\\"[\\\"+t;let i=$tw.wiki.filterTiddlers(\\\"[fields[]]\\\"),s=$tw.wiki.filterTiddlers(t).map((t=>({name:t}))),r=(t,e)=>s.splice(t+1,0,e);for(let t=0;t<s.length;t++){let e=s[t],n=!1,a=\\\"Invalid Date\\\";if(17===e.name.length&&(a=$tw.utils.parseDate(e.name).toLocaleString()),\\\"Invalid Date\\\"!==a&&(s[t].hint=a,s[t].action=()=>{},n=!0),0!==$tw.wiki.getTiddlersWithTag(e.name).length&&(n&&(r(t,{...s[t]}),t+=1),s[t].action=()=>this.promptCommand(\\\"@\\\"+e.name),s[t].hint=\\\"Tag\\\",n=!0),this.tiddlerOrShadowExists(e.name)&&(n&&(r(t,{...s[t]}),t+=1),s[t].action=()=>{this.navigateTo(e.name),this.closePalette()},s[t].hint=\\\"Tiddler\\\",n=!0),i.includes(e.name)){let i;n&&(r(t,{...s[t]}),t+=1);try{i=$tw.wiki.parseFilter(this.searchContainer.value)}catch(t){}let a=[];for(let t of i||[])2===t.operators.length&&\\\"title\\\"===t.operators[0].operator&&\\\"fields\\\"===t.operators[1].operator&&a.push(t.operators[0].operand);let o=\\\"Field\\\";if(1===a.length){o=$tw.wiki.getTiddler(a[0]).fields[e.name],o instanceof Date&&(o=o.toLocaleString()),o=o.toString().replace(/(\\\\r\\\\n|\\\\n|\\\\r)/gm,\\\"\\\");let t=this.settings.maxResultHintSize-3;o.length>t&&(o=o.substring(0,t),o+=\\\"...\\\")}s[t].hint=o,s[t].action=()=>{},n=!0}\\n// let isContentType = terms.includes('content-type');\\n}this.showResults(s)}filterResolver(t){0!==this.currentSelection&&(this.currentResults[this.currentSelection-1].result.action(),t.stopPropagation())}helpResolver(t){0!==this.currentSelection&&(this.currentResults[this.currentSelection-1].result.action(),t.stopPropagation())}createTiddlerProvider(t){this.currentSelection=0,this.searchHint.innerText=\\\"🟦\\\",this.showResults([])}createTiddlerResolver(t){let{tags:e,searchTerms:i}=this.parseTags(this.searchContainer.value.substr(1)),s=i.join(\\\" \\\");e=e.join(\\\" \\\"),this.tmMessageBuilder(\\\"tm-new-tiddler\\\",{title:s,tags:e})(t),this.closePalette()}promptCommand(t,e){this.blockProviderChange=!1,this.searchContainer.value=t,this.searchContainer.focus(),void 0!==e&&this.searchContainer.setSelectionRange(e,e),this.onInput(this.searchContainer.value)}promptCommandBasic(t,e,i){\\\"true\\\"!==this.settings.neverBasic&&!0!==this.settings.neverBasic?(this.searchContainer.value=\\\"\\\",this.blockProviderChange=!0,this.currentProvider=this.basicProviderBuilder(t,e,i),this.onInput(this.searchContainer.value)):this.promptCommand(t,e)}basicProviderBuilder(t,e,i){let s=t.substr(0,e),r=t.substr(e);return t=>{let{resolver:e,provider:n,terms:a}=this.parseCommand(s+t+r);n(a,i),this.currentResolver=e}}prefixedBasicProviderBuilder(t,e,i,s){let r=t.substr(0,e),n=t.substr(e);return t=>{t=t.substring(s);let{resolver:e,provider:a,terms:o}=this.parseCommand(r+t+n);a(o,i),this.currentResolver=e}}getCommandHistory(){this.history=this.history.filter((t=>this.actions.some((e=>e.name===t))));let t=this.history.map((t=>this.actions.find((e=>e.name===t))));for(;t.length<=this.settings.maxResults;){let e=this.actions.find((e=>!t.includes(e)));if(void 0===e)break;t.push(e)}return t}actionResolver(t){if(0===this.currentSelection)return;let e=this.actions.find((t=>t.name===this.currentResults[this.currentSelection-1].innerText));if(e.keepPalette){let t=this.searchContainer.value;this.goBack=()=>{this.searchContainer.value=t,this.blockProviderChange=!1,this.onInput(this.searchContainer.value)}}this.updateCommandHistory(e),e.action(t),t.stopPropagation(),e.immediate?this.validateSelection(t):e.keepPalette||this.closePalette()}refresh(){return!1}debounce(t,e=$tw.wiki.getTiddlerText(\\\"$:/config/Drafts/TypingTimeout\\\")){let i=null;return function(...s){i&&clearTimeout(i),i=setTimeout((()=>{t(...s)}),e)}}};\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/commandpalette/Browser Refresh\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Browser Refresh\",\"command-palette-name\":\"Browser Refresh\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-browser-refresh\\n\"},\"$:/plugins/oeyoews/commandpalette/Cancel Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Cancel Tiddler\",\"command-palette-hint\":\"Choose Draft to cancel\",\"command-palette-mode\":\"drafts\",\"command-palette-name\":\"Cancel Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-cancel-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Clone Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Clone Tiddler\",\"command-palette-hint\":\"Chose tiddler to clone\",\"command-palette-name\":\"Clone Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-new-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Close All Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Close All Tiddlers\",\"command-palette-name\":\"Close All Tiddlers\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-close-all-tiddlers\\n\"},\"$:/plugins/oeyoews/commandpalette/Close Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Close Tiddler\",\"command-palette-hint\":\"Choose tiddler to close\",\"command-palette-name\":\"Close Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-close-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Close other Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Close other Tiddlers\",\"command-palette-hint\":\"Choose tiddler to keep\",\"command-palette-name\":\"Close other Tiddlers\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-close-other-tiddlers\\n\"},\"$:/plugins/oeyoews/commandpalette/CommandPaletteCommandMode\":{\"title\":\"$:/plugins/oeyoews/commandpalette/CommandPaletteCommandMode\",\"key\":\"((open-command-palette-command-mode))\",\"tags\":\"$:/tags/KeyboardShortcut\",\"text\":\"<$action-sendmessage $message=\\\"open-command-palette\\\" $param=\\\">\\\"/>\"},\"$:/plugins/oeyoews/commandpalette/CommandPaletteSelection\":{\"title\":\"$:/plugins/oeyoews/commandpalette/CommandPaletteSelection\",\"key\":\"((open-command-palette-selection))\",\"tags\":\"$:/tags/KeyboardShortcut\",\"text\":\"<$action-sendmessage $message=\\\"open-command-palette-selection\\\"/>\"},\"$:/plugins/oeyoews/commandpalette/Command Palette Settings\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Command Palette Settings\",\"command-palette-name\":\"Command Palette Settings\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"|\\n\"},\"$:/plugins/oeyoews/commandpalette/Edit Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Edit Tiddler\",\"command-palette-hint\":\"Choose tiddler to edit\",\"command-palette-name\":\"Edit Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-edit-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/InsertCommandPaletteResult\":{\"title\":\"$:/plugins/oeyoews/commandpalette/InsertCommandPaletteResult\",\"key\":\"((insert-command-palette-result))\",\"tags\":\"$:/tags/KeyboardShortcut\",\"text\":\"<$action-sendmessage $message=\\\"insert-command-palette-result\\\"/>\"},\"$:/core/ui/KeyboardShortcuts/CommandPalette\":{\"title\":\"$:/core/ui/KeyboardShortcuts/CommandPalette\",\"key\":\"((open-command-palette))\",\"tags\":\"$:/tags/KeyboardShortcut\",\"text\":\"<$action-sendmessage $message=\\\"open-command-palette\\\"/>\"},\"$:/plugins/oeyoews/commandpalette/Save Wiki\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Save Wiki\",\"command-palette-name\":\"Save Wiki\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-save-wiki\\n\"},\"$:/plugins/oeyoews/commandpalette/See Story List\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Story List\",\"command-palette-caret\":\"26\",\"command-palette-name\":\"See Story List\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[list[$:/StoryList]search[]]\"},\"$:/plugins/oeyoews/commandpalette/See Themes\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Themes\",\"command-palette-caret\":\"40\",\"command-palette-name\":\"See Themes\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[!has[draft.of]plugin-type[theme]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See untagged tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See untagged tiddlers\",\"command-palette-caret\":\"29\",\"command-palette-name\":\"See untagged Tiddlers\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[untagged[]!is[system]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/Show help\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Show help\",\"command-palette-name\":\"Show help\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"?\\n\"},\"$:/plugins/oeyoews/commandpalette/Toggle Fullscreen\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Toggle Fullscreen\",\"command-palette-name\":\"Toggle Fullscreen\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-full-screen\\n\"},\"$:/plugins/oeyoews/commandpalette/Unfold All Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Unfold All Tiddlers\",\"command-palette-name\":\"Unfold All Tiddlers\",\"command-palette-type\":\"actionString\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"<$action-sendmessage $message=\\\"tm-unfold-all-tiddlers\\\" foldedStatePrefix=\\\"$:/state/folded/\\\"/>\\n\"},\"$:/plugins/oeyoews/commandpalette/View\":{\"title\":\"$:/plugins/oeyoews/commandpalette/View\",\"tags\":\"$:/tags/AboveStory\",\"text\":\"<$commandpalettewidget/>\\n\"},\"$:/plugins/oeyoews/commandpalette/Delete Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Delete Tiddler\",\"command-palette-hint\":\"Choose tiddler to delete\",\"command-palette-name\":\"Delete Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-delete-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Permalink\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Permalink\",\"command-palette-hint\":\"Choose tiddler to permaling\",\"command-palette-name\":\"Permalink\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-permalink\\n\"},\"$:/plugins/oeyoews/commandpalette/Version\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Version\",\"command-palette-caret\":\"49\",\"command-palette-name\":\"Version\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[[$:/plugins/oeyoews/commandpalette]get[version]]\"},\"$:/plugins/oeyoews/commandpalette/Filter operation\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Filter operation\",\"command-palette-name\":\"Filter operation\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[\\n\"},\"$:/plugins/oeyoews/commandpalette/Fold All Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Fold All Tiddlers\",\"command-palette-name\":\"Fold All Tiddlers\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-fold-all-tiddlers\\n\"},\"$:/plugins/oeyoews/commandpalette/Home\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Home\",\"command-palette-name\":\"Home\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-home\\n\"},\"$:/plugins/oeyoews/commandpalette/New Journal Command\":{\"title\":\"$:/plugins/oeyoews/commandpalette/New Journal Command\",\"command-palette-name\":\"New Journal\",\"command-palette-type\":\"actionString\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"{{$:/core/ui/Actions/new-journal}}\\n\"},\"$:/plugins/oeyoews/commandpalette/New Tiddler with title\":{\"title\":\"$:/plugins/oeyoews/commandpalette/New Tiddler with title\",\"command-palette-name\":\"New Tiddler with title\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"+\\n\"},\"$:/plugins/oeyoews/commandpalette/New Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/New Tiddler\",\"command-palette-name\":\"New Tiddler\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-new-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Permaview\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Permaview\",\"command-palette-name\":\"Permaview\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-permaview\\n\"},\"$:/plugins/oeyoews/commandpalette/Print\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Print\",\"command-palette-name\":\"Print\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-print\\n\"},\"$:/plugins/oeyoews/commandpalette/Recent Tiddlers Command\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Recent Tiddlers Command\",\"command-palette-caret\":\"33\",\"command-palette-hint\":\"Recent\",\"command-palette-name\":\"Recent Tiddlers\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[!is[system]!sort[created]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/Refresh Server\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Refresh Server\",\"command-palette-name\":\"Refresh Server\",\"command-palette-type\":\"message\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-server-refresh\\n\"},\"$:/plugins/oeyoews/commandpalette/Save Tiddler\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Save Tiddler\",\"command-palette-hint\":\"Choose Draft to save\",\"command-palette-mode\":\"drafts\",\"command-palette-name\":\"Save Tiddler\",\"command-palette-type\":\"history\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"tm-save-tiddler\\n\"},\"$:/plugins/oeyoews/commandpalette/Search fields\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Search fields\",\"command-palette-caret\":\"16\",\"command-palette-name\":\"Search fields\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[fields[]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/Search tiddlers with tag\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Search tiddlers with tag\",\"command-palette-name\":\"Search tiddlers with tag\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"@\\n\"},\"$:/plugins/oeyoews/commandpalette/Search Tags\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Search Tags\",\"command-palette-name\":\"Search Tags\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"#\\n\"},\"$:/plugins/oeyoews/commandpalette/Search\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Search\",\"command-palette-name\":\"Search\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\"},\"$:/plugins/oeyoews/commandpalette/See all content-types\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See all content-types\",\"command-palette-caret\":\"48\",\"command-palette-name\":\"See all content-type\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[all[tiddlers+shadows]each[type]get[type]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Drafts\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Drafts\",\"command-palette-caret\":\"27\",\"command-palette-name\":\"See Drafts\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[has:field[draft.of]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Languages\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Languages\",\"command-palette-caret\":\"43\",\"command-palette-name\":\"See Languages\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[!has[draft.of]plugin-type[language]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Missing Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Missing Tiddlers\",\"command-palette-caret\":\"20\",\"command-palette-name\":\"See Missing Tiddlers\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[all[missing]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Orphans Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Orphans Tiddlers\",\"command-palette-caret\":\"20\",\"command-palette-name\":\"See Orphans Tiddlers\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[all[orphans]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Plugins\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Plugins\",\"command-palette-caret\":\"41\",\"command-palette-name\":\"🧩 See Plugins\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[!has[draft.of]plugin-type[plugin]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/See Shadows Tiddlers\":{\"title\":\"$:/plugins/oeyoews/commandpalette/See Shadows Tiddlers\",\"command-palette-caret\":\"20\",\"command-palette-name\":\"See Shadows Tiddlers\",\"command-palette-type\":\"prompt-basic\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"[all[shadows]search[]]\\n\"},\"$:/plugins/oeyoews/commandpalette/ControlPanel Command\":{\"title\":\"$:/plugins/oeyoews/commandpalette/ControlPanel Command\",\"command-palette-name\":\"Show Control Panel\",\"command-palette-type\":\"actionString\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"<$action-navigate $to=\\\"$:/ControlPanel\\\"/>\"},\"$:/plugins/oeyoews/commandpalette/show tiddler commands\":{\"title\":\"$:/plugins/oeyoews/commandpalette/show tiddler commands\",\"command-palette-name\":\"Show CommandTiddlers\",\"command-palette-type\":\"prompt\",\"tags\":\"$:/tags/CommandPaletteCommand\",\"text\":\"@$:/tags/CommandPaletteCommand\\n\"},\"$:/plugins/oeyoews/commandpalette/icon\":{\"title\":\"$:/plugins/oeyoews/commandpalette/icon\",\"type\":\"image/svg+xml\",\"text\":\"<svg stroke=\\\"currentColor\\\" fill=\\\"currentColor\\\" stroke-width=\\\"0\\\" viewBox=\\\"0 0 20 20\\\" aria-hidden=\\\"true\\\" height=\\\"1em\\\" width=\\\"1em\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z\\\" clip-rule=\\\"evenodd\\\"></path></svg>\\n\"},\"$:/plugins/oeyoews/commandpalette/CommandPaletteSearchSteps\":{\"text\":\"{\\n  \\\"steps\\\": [\\n    {\\n      \\\"filter\\\": \\\"[!is[system]search:title[]]\\\",\\n      \\\"hint\\\": \\\"in title\\\",\\n      \\\"caret\\\": \\\"25\\\"\\n    },\\n    {\\n      \\\"filter\\\": \\\"[all[system+shadows]search:title[]]\\\",\\n      \\\"hint\\\": \\\"in title (system)\\\",\\n      \\\"caret\\\": \\\"33\\\"\\n    },\\n    { \\\"filter\\\": \\\"[search[]]\\\", \\\"hint\\\": \\\"all\\\", \\\"caret\\\": \\\"8\\\" },\\n    { \\\"filter\\\": \\\"[all[shadows]search[]]\\\", \\\"hint\\\": \\\"shadows\\\", \\\"caret\\\": \\\"20\\\" }\\n  ]\\n}\\n\",\"type\":\"application/json\",\"title\":\"$:/plugins/oeyoews/commandpalette/CommandPaletteSearchSteps\"},\"$:/plugins/oeyoews/commandpalette/CommandPaletteSettings\":{\"text\":\"{\\n  \\\"maxResults\\\": \\\"30\\\",\\n  \\\"maxResultHintSize\\\": 45,\\n  \\\"neverBasic\\\": \\\"false\\\",\\n  \\\"smoothScroll\\\": \\\"false\\\"\\n}\\n\",\"type\":\"application/json\",\"title\":\"$:/plugins/oeyoews/commandpalette/CommandPaletteSettings\"},\"$:/plugins/oeyoews/commandpalette/CommandPaletteHistory\":{\"text\":\"{\\n  \\\"history\\\": [\\n    \\\"Explorer\\\",\\n    \\\"Clone Tiddler\\\",\\n    \\\"See Drafts\\\",\\n    \\\"Refresh Server\\\",\\n    \\\"Permaview\\\",\\n    \\\"See Themes\\\",\\n    \\\"Refresh Command Palette\\\",\\n    \\\"See Shadows Tiddlers\\\",\\n    \\\"See Orphans Tiddlers\\\",\\n    \\\"Remove tag\\\",\\n    \\\"Add tag to tiddler\\\",\\n    \\\"Delete Tiddler\\\",\\n    \\\"Close Tiddler\\\",\\n    \\\"Recent Tiddlers\\\",\\n    \\\"New Task with Title\\\",\\n    \\\"Edit Tiddler\\\",\\n    \\\"See Mising Tiddlers\\\",\\n    \\\"Show CommandTiddlers\\\",\\n    \\\"See untagged Tiddlers\\\",\\n    \\\"See Languages\\\",\\n    \\\"🧩 Plugins\\\",\\n    \\\"New Command Wizard\\\",\\n    \\\"Cancel Tiddler\\\",\\n    \\\"Save Tiddler\\\",\\n    \\\"Close other Tiddlers\\\",\\n    \\\"Permalink\\\",\\n    \\\"Create Command\\\",\\n    \\\"Unfold All Tiddlers\\\",\\n    \\\"Fold All Tiddlers\\\",\\n    \\\"Print\\\",\\n    \\\"Close All Tiddlers\\\",\\n    \\\"Save Wiki\\\",\\n    \\\"Home\\\",\\n    \\\"Toggle Fullscreen\\\",\\n    \\\"New Tiddler\\\"\\n  ]\\n}\\n\",\"type\":\"application/json\",\"title\":\"$:/plugins/oeyoews/commandpalette/CommandPaletteHistory\"},\"$:/plugins/oeyoews/cmp/lib/focusAtCaretPosition.js\":{\"title\":\"$:/plugins/oeyoews/cmp/lib/focusAtCaretPosition.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/cmp/lib/focusAtCaretPosition.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports=function(e,t){if(null!==e){if(e.value=e.value,e.createTextRange){var a=e.createTextRange();return a.move(\\\"character\\\",t),a.select(),!0}return e.selectionStart||0===e.selectionStart?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}};\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/cmp/lib/getActiveElement.js\":{\"title\":\"$:/plugins/oeyoews/cmp/lib/getActiveElement.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/cmp/lib/getActiveElement.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports=function(e=document.activeElement){const t=e.shadowRoot,n=e.contentDocument;return t&&t.activeElement?this.getActiveElement(t.activeElement):n&&n.activeElement?this.getActiveElement(n.activeElement):e};\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/cmp/lib/getCurrentSelection.js\":{\"title\":\"$:/plugins/oeyoews/cmp/lib/getCurrentSelection.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/cmp/lib/getCurrentSelection.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports=function(){const e=require(\\\"./getActiveElement\\\");let t=window.getSelection().toString();if(\\\"\\\"!==t)return t;let n=e();return void 0===n||void 0===n.selectionStart?\\\"\\\":n.selectionStart>n.selectionEnd?n.value.substring(n.selectionStart,n.selectionEnd):n.value.substring(n.selectionEnd,n.selectionStart)};\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/cmp/lib/getTiddlersWithTag.js\":{\"title\":\"$:/plugins/oeyoews/cmp/lib/getTiddlersWithTag.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/cmp/lib/getTiddlersWithTag.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports=function(i){return $tw.wiki.getTiddlersWithTag(i).map((i=>$tw.wiki.getTiddler(i)))};\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/config/ShortcutInfo/open-command-palette\":{\"title\":\"$:/config/ShortcutInfo/open-command-palette\",\"text\":\"Open the command palette\"},\"$:/config/ShortcutInfo/open-command-palette-command-mode\":{\"title\":\"$:/config/ShortcutInfo/open-command-palette-command-mode\",\"text\":\"Open the command palette in command mode\"},\"$:/config/ShortcutInfo/insert-command-palette-result\":{\"title\":\"$:/config/ShortcutInfo/insert-command-palette-result\",\"text\":\"Insert the current result in the previously focused element\"},\"$:/config/ShortcutInfo/open-command-palette-selection\":{\"title\":\"$:/config/ShortcutInfo/open-command-palette-selection\",\"text\":\"Open the command palette with current selection\"},\"$:/config/shortcuts/open-command-palette\":{\"title\":\"$:/config/shortcuts/open-command-palette\",\"text\":\"ctrl-P\"},\"$:/config/shortcuts/open-command-palette-command-mode\":{\"title\":\"$:/config/shortcuts/open-command-palette-command-mode\",\"text\":\"ctrl-shift-P\"},\"$:/config/shortcuts/insert-command-palette-result\":{\"title\":\"$:/config/shortcuts/insert-command-palette-result\",\"text\":\"ctrl+shift+I\"},\"$:/config/shortcuts/open-command-palette-selection\":{\"title\":\"$:/config/shortcuts/open-command-palette-selection\",\"text\":\"\"},\"$:/plugins/oeyoews/commandpalette/Compact.css\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Compact.css\",\"tags\":\"$:/tags/CommandPaletteTheme $:/tags/Stylesheet\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline html\\n\\n:root {\\n    --palette-radius: 5px;\\n}\\n.commandpalette {\\n    position: fixed;\\n    background: <<colour background>>;\\n    z-index: 9999999;\\n    left: 50%;\\n    top: 10%;\\n    transform: translate(-50%, 0%);\\n    width: 500px;\\n    display: none;\\n    flex-direction: column;\\n    font-size: 21px;\\n    border-radius: var(--palette-radius);\\n    box-shadow: rgba(0, 0, 0, 0.15) 0px 0px 14px;\\n    border: 2px solid <<colour page-background>>;\\n}\\n.inputhintwrapper {\\n    display: flex;\\n    align-items: center;\\n    <!-- border-bottom: 2px solid <<colour page-background>>; -->\\n}\\n.commandpalette input {\\n    border: 0;\\n    background: 0;\\n    height: 40px;\\n    color: <<colour foreground>>;\\n    border-radius: var(--palette-radius) var(--palette-radius) 0px 0px;\\n    outline: 0;\\n    min-width: 50px;\\n    flex: 1;\\n    padding-left: 7px;\\n}\\n.commandpalettehint {\\n    color:  <<colour foreground>>;\\n    font-size: 13px;\\n    text-align: right;\\n    flex-shrink: 0;\\n    padding-right: 7px;\\n    opacity: 0.6;\\n}\\n.commandpaletteresultselected>.commandpalettehint {\\n    color: <<colour background>>;\\n    opacity: 1;\\n}\\n.commandpalettehintmain {\\n\\n}\\n.commandpaletteresult {\\n    background: <<colour background>>;\\n    font-size: 15px;\\n    color: <<colour foreground>>;\\n    display: flex;\\n    align-items: center;\\n    justify-content: space-between;\\n    padding-left: 6px;\\n    padding-top: 4px;\\n    padding-bottom: 4px;\\n    cursor: pointer;\\n}\\n.commandpaletteresult:not(:last-child) {\\n    <!-- border-bottom: <<colour page-background>> solid 1px; -->\\n    margin: 4px 0;\\n    font-size: 18px;\\n}\\n.commandpaletteresult:hover:not(.commandpaletteresultselected) {\\n    background: <<colour page-background>>;\\n}\\n.commandpaletteresultselected {\\n    background: <<colour primary>>;\\n    color: <<colour page-background>>;\\n}\\n.cp-scroll{\\n    max-height: 50vh;\\n    overflow-y: auto;\\n    position: relative;\\n    border-radius: 0px 0px var(--palette-radius) var(--palette-radius);\\n}\"},\"$:/plugins/oeyoews/commandpalette/Original.css\":{\"title\":\"$:/plugins/oeyoews/commandpalette/Original.css\",\"tags\":\"$:/tags/CommandPaletteTheme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline html\\n:root {\\n    --palette-radius: 5px;\\n}\\n.commandpalette {\\n    position: fixed;\\n    background:<<colour page-background>>;\\n    z-index: 9999999;\\n    left: 50%;\\n    top: 10%;\\n    transform: translate(-50%, 0%);\\n    width: 500px;\\n    display: none;\\n    flex-direction: column;\\n    font-size: 21px;\\n    border-radius: var(--palette-radius);\\n    box-shadow: rgba(0, 0, 0, 0.15) 0px 0px 14px;\\n    border: 4px solid rgba(0, 0, 0, 0);\\n}\\n.commandpalette input {\\n    border: 0;\\n    height: 40px;\\n    color: <<colour foreground>>;\\n    border-radius: var(--palette-radius) var(--palette-radius) 0px 0px;\\n    padding-left: 11px;\\n    padding-right: 11px;\\n    width: 100%;\\n    outline: 0;\\n}\\n.commandpalettehint {\\n    color:  <<colour foreground>>;\\n    font-size: 13px;\\n    text-align: right;\\n    flex-shrink: 0;\\n    padding-right: 7px;\\n    opacity: 0.6;\\n}\\n.commandpaletteresultselected>.commandpalettehint {\\n    color: <<colour background>>;\\n    opacity: 1;\\n}\\n.commandpalettehintmain {\\n}\\n.commandpaletteresult {\\n    background: <<colour background>>;\\n    font-size: 15px;\\n    color: <<colour foreground>>;\\n    display: flex;\\n    align-items: center;\\n    justify-content: space-between;\\n    padding-left: 6px;\\n    padding-top: 4px;\\n    padding-bottom: 4px;\\n    cursor: pointer;\\n}\\n.commandpaletteresult:not(:last-child) {\\n    <!-- border-bottom: <<colour page-background>> solid 1px; -->\\n}\\n.commandpaletteresult:hover:not(.commandpaletteresultselected) {\\n    background: <<colour page-background>>;\\n}\\n.commandpaletteresultselected {\\n    background: <<colour primary>>;\\n    color: <<colour page-background>>;\\n}\\n.cp-scroll{\\n    max-height: 50vh;\\n    overflow-y: auto;\\n    position: relative;\\n    border-radius: 0px 0px var(--palette-radius) var(--palette-radius);\\n}\"}}}"}