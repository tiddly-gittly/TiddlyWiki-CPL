{"title":"$:/plugins/oeyoews/screenlock","description":"screenlock","author":"oeyoews","version":"0.0.1","core-version":">=5.3.4","type":"application/json","plugin-type":"plugin","name":"screenlock","meat#disabled":"yes","qrcode":"yes","created":"20250426","dependents":"","stability":"STABILITY_2_STABLE","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/screenlock/readme\":{\"title\":\"$:/plugins/oeyoews/screenlock/readme\",\"description\":\"screenlock\",\"tags\":\"$:/tags/ControlPanel/Settings\",\"text\":\"\\\\define lingo-base() $:/language/ControlPanel/\\n\\n[[在线文档|https://tiddlywiki-starter-kit.oeyoews.top/docs/plugins/screenlock]]\\n\\n! 锁屏插件\\n\\n这个插件为 TiddlyWiki 提供了锁屏功能，可以保护您的 wiki 内容不被未授权的人查看。\\n\\n!! 使用方法\\n\\n1. 在控制面板的\\\"锁屏设置\\\"中设置您的密码\\n2. 点击页面顶部的锁屏按钮锁定屏幕\\n3. 输入密码解锁\\n\\n!! 锁屏设置\\n\\n|<$link to=\\\"$:/plugins/oeyoews/screenlock/password\\\">锁屏密码</$link> |<$edit-text tiddler=\\\"$:/plugins/oeyoews/screenlock/password\\\" tag=\\\"input\\\" type=\\\"password\\\"/><br/>请记住此密码，否则将无法解锁! |\\n|<$link to=\\\"$:/plugins/oeyoews/screenlock/autolock\\\">自动锁屏</$link> |<$checkbox tiddler=\\\"$:/plugins/oeyoews/screenlock/autolock\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\"> 启动时自动锁屏</$checkbox> |\\n\\n\\n!! 功能\\n\\n* 手动锁屏\\n* 自动锁屏（启动时）\\n* 密码保护\\n* 快捷键支持（Alt+L 锁屏/解锁）\\n* 锁屏状态下禁用所有快捷键（除了 Alt+L）\"},\"$:/plugins/oeyoews/screenlock/button\":{\"title\":\"$:/plugins/oeyoews/screenlock/button\",\"tags\":\"$:/tags/PageControls\",\"caption\":\"{{$:/plugins/oeyoews/screenlock/icon}} 锁屏\",\"description\":\"锁定屏幕\",\"text\":\"<$button message=\\\"tw-lock-screen\\\" tooltip=\\\"锁定屏幕\\\" aria-label=\\\"锁定屏幕\\\" class=<<tv-config-toolbar-class>>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n{{$:/plugins/oeyoews/screenlock/icon}}\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">锁屏</span>\\n</$list>\\n</$button>\"},\"$:/config/shortcuts/screenlock-toggle\":{\"title\":\"$:/config/shortcuts/screenlock-toggle\",\"text\":\"alt-l\"},\"$:/plugins/oeyoews/screenlock/icon\":{\"title\":\"$:/plugins/oeyoews/screenlock/icon\",\"tags\":\"$:/tags/Image\",\"text\":\"<svg width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 128 128\\\">\\n    <path d=\\\"M64,16c-23.5,0-42.7,19.2-42.7,42.7v10.7H32V58.7C32,41.1,46.4,26.7,64,26.7s32,14.4,32,32v10.7h10.7V58.7 C106.7,35.2,87.5,16,64,16z M96,69.3H32v42.7h64V69.3z M64,96c-5.9,0-10.7-4.8-10.7-10.7S58.1,74.7,64,74.7S74.7,79.5,74.7,85.3 S69.9,96,64,96z\\\"/>\\n</svg>\"},\"$:/plugins/oeyoews/screenlock/overlay\":{\"title\":\"$:/plugins/oeyoews/screenlock/overlay\",\"tags\":\"$:/tags/PageTemplate\",\"list-after\":\"$:/core/ui/PageTemplate/story\",\"text\":\"<$list filter=\\\"[{$:/plugins/oeyoews/screenlock/state}match[locked]]\\\">\\n<div class=\\\"tw-screenlock-overlay\\\">\\n<$list filter=\\\"[[$:/plugins/oeyoews/neotw-meteors]is[tiddler]]\\\">\\n  <$neotw-meteors />\\n</$list>\\n  <div class=\\\"tw-screenlock-container\\\">\\n    <h2>{{$:/SiteTitle}}</h2>\\n    <div class=\\\"tw-screenlock-input\\\">\\n      <$edit-text focus=\\\"yes\\\" tiddler=\\\"$:/temp/screenlock/password\\\" tag=\\\"input\\\" type=\\\"password\\\" placeholder=\\\"password...\\\" class=\\\"tw-screenlock-password\\\"/>\\n      <$button class=\\\"tw-screenlock-button\\\">\\n        Unlock\\n        <$action-sendmessage $message=\\\"tw-unlock-screen\\\" password={{$:/temp/screenlock/password}}/>\\n      </$button>\\n    </div>\\n    <$list filter=\\\"[{$:/temp/screenlock/error}!match[]]\\\">\\n      <div class=\\\"tw-screenlock-error\\\">{{$:/temp/screenlock/error}}</div>\\n    </$list>\\n  </div>\\n</div>\\n</$list>\\n\\n\"},\"$:/plugins/oeyoews/screenlock/screenlock.js\":{\"title\":\"$:/plugins/oeyoews/screenlock/screenlock.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/screenlock/screenlock.js\\ntype: application/javascript\\nmodule-type: startup\\n\\\\*/\\n\\nexports.name = 'screenlock-startup';\\nexports.platforms = ['browser'];\\nexports.after = ['startup'];\\nexports.synchronous = true;\\n\\nexports.startup = function () {\\n  var storedPassword = $tw.wiki.getTiddlerText(\\n    '$:/plugins/oeyoews/screenlock/password',\\n  );\\n  if (!storedPassword) return;\\n  // 注册解锁消息处理器\\n  $tw.rootWidget.addEventListener('tw-unlock-screen', function (event) {\\n    var password = event.param || event.paramObject.password;\\n\\n    if (password === storedPassword) {\\n      $tw.wiki.setText(\\n        '$:/plugins/oeyoews/screenlock/state',\\n        'text',\\n        null,\\n        'unlocked',\\n      );\\n      $tw.wiki.deleteTiddler('$:/temp/screenlock/password');\\n      $tw.wiki.deleteTiddler('$:/temp/screenlock/error');\\n    } else {\\n      $tw.wiki.setText('$:/temp/screenlock/error', 'text', null, '密码错误');\\n    }\\n    return false;\\n  });\\n\\n  // 注册锁屏消息处理器\\n  $tw.rootWidget.addEventListener('tw-lock-screen', function (event) {\\n    $tw.wiki.setText(\\n      '$:/plugins/oeyoews/screenlock/state',\\n      'text',\\n      null,\\n      'locked',\\n    );\\n    $tw.wiki.deleteTiddler('$:/temp/screenlock/password');\\n    $tw.wiki.deleteTiddler('$:/temp/screenlock/error');\\n    return false;\\n  });\\n\\n  // 检查是否应该自动锁屏\\n  var autoLock = $tw.wiki.getTiddlerText(\\n    '$:/plugins/oeyoews/screenlock/autolock',\\n  );\\n  if (autoLock === 'yes' && storedPassword) {\\n    $tw.wiki.setText(\\n      '$:/plugins/oeyoews/screenlock/state',\\n      'text',\\n      null,\\n      'locked',\\n    );\\n  }\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/oeyoews/screenlock/shortcuts\":{\"title\":\"$:/plugins/oeyoews/screenlock/shortcuts\",\"tags\":\"$:/tags/KeyboardShortcut\",\"key\":\"((screenlock-toggle))\",\"text\":\"<!-- <$list filter=\\\"[{$:/plugins/oeyoews/screenlock/state}match[locked]]\\\">\\n<$action-sendmessage $message=\\\"tw-unlock-screen\\\" password={{$:/plugins/oeyoews/screenlock/password}}/>\\n</$list> -->\\n<$list filter=\\\"[{$:/plugins/oeyoews/screenlock/state}!match[locked]]\\\">\\n<$action-sendmessage $message=\\\"tw-lock-screen\\\"/>\\n</$list>\\n\"},\"$:/plugins/oeyoews/screenlock/startup.js\":{\"title\":\"$:/plugins/oeyoews/screenlock/startup.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/screenlock/startup.js\\ntype: application/javascript\\nmodule-type: startup\\n\\nscreenlock startup\\n\\n\\\\*/\\n\\nexports.name = 'screenlock-startup-hook';\\nexports.platforms = ['browser'];\\nexports.after = ['startup'];\\nexports.synchronous = true;\\nexports.startup = () => {\\n  // your code here\\n  console.log('screenlock-startup-hook');\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/oeyoews/screenlock/styles\":{\"title\":\"$:/plugins/oeyoews/screenlock/styles\",\"tags\":\"$:/tags/Stylesheet\",\"text\":\".tw-screenlock-overlay {\\n    position: fixed;\\n    top: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: <<colour background>>;\\n    z-index: 9999;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n}\\n\\n.tw-screenlock-container {\\n    text-align: center;\\n    padding: 2em;\\n    border-radius: 8px;\\n    background-color: <<colour tiddler-background>>;\\n    box-shadow: 0 4px 8px rgba(0,0,0,0.2);\\n    max-width: 80%;\\n}\\n\\n.tw-screenlock-input {\\n    margin: 1em 0;\\n    display: flex;\\n    justify-content: center;\\n}\\n\\n.tw-screenlock-password {\\n    padding: 0.5em;\\n    margin-right: 0.5em;\\n    border: 1px solid <<colour tiddler-border>>;\\n    border-radius: 4px;\\n}\\n\\n.tw-screenlock-button {\\n    padding: 0.5em 1em;\\n    background-color: <<colour primary>>;\\n    color: <<colour background>>;\\n    border: none;\\n    border-radius: 4px;\\n    cursor: pointer;\\n}\\n\\n.tw-screenlock-error {\\n    color: #ff0000;\\n    margin-top: 1em;\\n}\"},\"$:/plugins/oeyoews/screenlock/widget.js\":{\"title\":\"$:/plugins/oeyoews/screenlock/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/screenlock/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nscreenlock widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\nclass ScreenlockWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const ssr = this.document.isTiddlyWikiFakeDom;\\n    if (ssr) return;\\n\\n    const createElement = $tw.utils.domMaker;\\n\\n    const btn = createElement('button', {\\n      text: 'Click me',\\n      class: 'rounded p-1',\\n    });\\n\\n    const domNode = createElement('div', {\\n      // text: 'example',\\n      // class: 'underline font-bold',\\n      children: [btn],\\n    });\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n}\\n\\n/** @description screenlock widget */\\nexports['widget-2ici4tcd'] = ScreenlockWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}